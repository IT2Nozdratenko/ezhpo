(self.webpackChunk=self.webpackChunk||[]).push([[773],{6099:(t,e,s)=>{"use strict";var a=s(538),n=s(7907),r=s.n(n),i=s(4648),o=s(3017),l=s(2739),c=(s(5036),s(1151)),d=(s(3825),s(9938)),u=s.n(d);s(6532);s(9147),s(561),a.default.use(i.XG7),a.default.use(o.X),a.default.use(l.ZP),a.default.use(u()),a.default.use(c.ZP,{position:c.Vr.BOTTOM_RIGHT}),a.default.component("multiselect",r());var p=s(5763);p.keys().map((function(t){return a.default.component(t.split("/").pop().split(".")[0],p(t).default)})),(new a.default).$mount("#app")},9147:(t,e,s)=>{window._=s(6486);try{window.Popper=s(8981).default,window.$=window.jQuery=s(9755),s(3734)}catch(t){}window.axios=s(9669),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",window.flatpickr=s(6667),window.swal=s(6455)},1550:(t,e,s)=>{"use strict";s.d(e,{Q:()=>c});var a=s(9669),n=s.n(a);function r(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function i(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?r(Object(s),!0).forEach((function(e){o(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t,e){for(var s=0;s<e.length;s++){var a=e[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.client=n().create({baseURL:location.origin,headers:{Authorization:"Bearer "+API_TOKEN}})}var e,s,a;return e=t,(s=[{key:"updateModelProperty",value:function(t){var e=t.item_model,s=t.item_id,a=t.item_field,n=t.new_value;return this.client.put("/api/update-ddate/".concat(e,"/").concat(s,"/").concat(a),{new_value:n}).then((function(t){return t.data}))}},{key:"saveDoc",value:function(t,e){return this.client.put("/api/update-doc/".concat(t),e).then((function(t){return t.data}))}},{key:"getGraphReport",value:function(t){var e=t.pv_id,s=t.date_from,a=t.date_to,n=t.date_from_time,r=t.date_to_time,i=t.type_anketa,o="";e.forEach((function(t,e){o+="pv_id[".concat(e,"]=").concat(t,"&")}));var l=r&&n?"&date_from_time=".concat(n,"&date_to_time=").concat(r):"";return this.client.get("/api/report/graph_pv?filter=1&".concat(o,"date_from=").concat(s,"&date_to=").concat(a,"&api=1").concat(l,"&type_anketa=").concat(i)).then((function(t){return t.data}))}},{key:"getFieldHTML",value:function(t){var e=t.field,s=t.model,a=t.default_value;return this.client.get("/api/getField/".concat(s,"/").concat(e,"/").concat(a))}},{key:"getFindModel",value:function(t){var e=t.model,s=t.params;return this.client.get("/api/find/".concat(e),{params:i({},s)})}},{key:"saveFieldsVisible",value:function(t){return this.client.post("/api/fields/visible",{params:t})}}])&&l(e.prototype,s),a&&l(e,a),t}()},3723:(t,e,s)=>{"use strict";s.d(e,{e:()=>a});var a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},992:(t,e,s)=>{"use strict";function a(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return n(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==s.return||s.return()}finally{if(l)throw i}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function r(t){var e,s=new URL(window.location.href),n=a(s.searchParams);try{for(n.s();!(e=n.n()).done;){var r=e.value;s.searchParams.delete(r[0])}}catch(t){n.e(t)}finally{n.f()}for(var i in t)null!==t[i]&&void 0!==t[i]&&s.searchParams.set(i,t[i]);history.pushState&&history.pushState(null,null,s.toString())}function i(){var t,e={},s=a(new URL(window.location.href).searchParams);try{for(s.s();!(t=s.n()).done;){var n=t.value;"false"===n[1]?n[1]=!1:"true"===n[1]&&(n[1]=!0),e[n[0]]=n[1]}}catch(t){s.e(t)}finally{s.f()}return e}s.d(e,{F:()=>r,Q:()=>i})},6779:(t,e,s)=>{"use strict";function a(t){for(var e=0,s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];for(var i in t){var o=r.apply(void 0,[t[i]].concat(a));"number"==typeof o&&(e+=o)}return e>0?e:"отсутствует"}function n(t){for(var e=0,s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];for(var r in t){var o=i.apply(void 0,[t[r]].concat(a));"number"==typeof o&&(e+=o)}return e>0?e:null}function r(t){var e=0;if(t.types){for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];var r=function(s){a.forEach((function(a){var n;s.split("/")[0].trim().toLowerCase()===a.toLowerCase()&&(e+=parseInt(null===(n=t.types[s])||void 0===n?void 0:n.total))}))};for(var i in t.types)r(i)}return e>0?e:"отсутствует"}function i(t){var e=0;if(t.types){for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];var r=function(s){a.forEach((function(a){var n;s.split("/")[0].trim().toLowerCase()===a.toLowerCase()&&(e+=parseInt(null===(n=t.types[s])||void 0===n?void 0:n.sum))}))};for(var i in t.types)r(i)}return e>0?e:null}function o(t){var e=0;if(t.types){for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];var r=function(s){a.forEach((function(a){var n;s.split("/")[0].trim().toLowerCase()===a.toLowerCase()&&(e=parseInt(null===(n=t.types[s])||void 0===n?void 0:n.discount))}))};for(var i in t.types)r(i)}return e>0?e:null}function l(t){var e=!1;if(t.types){for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];var r=function(s){a.forEach((function(a){var n;s.split("/")[0].trim().toLowerCase()===a.toLowerCase()&&(e=null===(n=t.types[s])||void 0===n?void 0:n.sync)}))};for(var i in t.types)r(i)}return e}s.d(e,{tx:()=>a,gw:()=>n,NU:()=>r,n0:()=>i,fL:()=>o,Wk:()=>l})},3203:(t,e,s)=>{"use strict";function a(t,e){for(var s=0;s<e.length;s++){var a=e[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}s.d(e,{Z:()=>r});var n=(0,s(1151).NO)({position:"bottom-right",timeout:3e3,closeOnClick:!0,pauseOnFocusLoss:!1,pauseOnHover:!1}),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,s,r;return e=t,r=[{key:"success",value:function(t){n.success(t)}},{key:"error",value:function(t){n.error(t)}}],(s=null)&&a(e.prototype,s),r&&a(e,r),t}()},561:(t,e,s)=>{"use strict";s.r(e);var a=s(7757),n=s.n(a),r=s(9669),i=s.n(r),o=s(6455),l=s.n(o),c=s(5934),d=s(1550);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function p(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function f(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){p(r,a,n,i,o,"next",t)}function o(t){p(r,a,n,i,o,"throw",t)}i(void 0)}))}}function m(t){var e=$("#ANKETA_CLONE_TRIGGER");return!0===t?e.hide():e.show()}function v(t){t.flatpickr({mode:"multiple",dateFormat:"Y-m-d",locale:{weekdays:{shorthand:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],longhand:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},months:{shorthand:["Янв","Фев","Март","Апр","Май","Июнь","Июль","Авг","Сен","Окт","Ноя","Дек"],longhand:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},firstDayOfWeek:1,rangeSeparator:" — ",weekAbbreviation:"Нед.",scrollTitle:"Прокрутите для увеличения",toggleTitle:"Нажмите для переключения",amPM:["ДП","ПП"],yearAriaLabel:"Год",time_24hr:!0}})}s(7604),s(858),s(5099),s(6645),$.fn.select2.amd.require(["select2/selection/search"],(function(t){t.prototype.searchRemoveChoice=function(t,e){this.trigger("unselect",{data:e}),this.$search.val(""),this.handleSearch()}})),$(document).ready((function(){var t=$("input[name='anketa[0][dates]']");t[0]&&v(t[0]),$("div.form-group").each((function(t,e){$(e).has(":input[required]").addClass("required")}));var e=l().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(t){t.addEventListener("mouseenter",l().stopTimer),t.addEventListener("mouseleave",l().resumeTimer)}}),s=!1;switch($("#ANKETA_FORM_VIEW").data("anketa")){case"profile.ankets.tech":var a=$("#point_reys_control");a.length>0&&(m(!("Пройден"===a.val())),$(document).on("change","#point_reys_control",(function(t){m(!("Пройден"===$(t.target).val()))})));break;case"profile.ankets.medic":var r=$("#med_view");r.length>0&&(m(!("В норме"===r.val())),$(document).on("change","#med_view",(function(t){m(!("В норме"===$(t.target).val()))})))}$(document).on("click",".reload-filters",(function(t){var e=$(t.target);if(location.pathname.indexOf("home")>-1){e.disabled=!0,e.children("span.spinner").removeClass("d-none"),$("#filter-group-2-tab").removeClass("active"),$("#filter-group-1-tab").addClass("active");var s=location.origin+location.pathname;s.endsWith("/")||(s+="/"),s+="filters",$.get(s).done((function(t){t&&($("#filter-groupsContent").html(t),h.initChosen())}))}})),$(document).on("input",".select2-search__field",function(){var t=f(n().mark((function t(e){var a,r,i,o,l,c,d,u,f,m,v,_,h;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.target.value,(o=null===(a=$(e.target).parents(".select2"))||void 0===a||null===(r=a.parent())||void 0===r?void 0:r.children(".filled-select2")).length<1&&(d=$(e.target).attr("aria-controls"),o=null===(l=$('.select2-selection[aria-owns="'.concat(d,'"]')).parents(".select2"))||void 0===l||null===(c=l.parent())||void 0===c?void 0:c.children(".filled-select2")),u=o.attr("model"),f=o.attr("field-concat")||!1,m=o.attr("field-concat-name")||"hash_id",v=o.attr("field"),_=o.attr("field-key"),h=!1,o.attr("field-trashed")&&(h=!0),u){t.next=12;break}return t.abrupt("return");case 12:if(!s){t.next=15;break}return s=!1,t.abrupt("return");case 15:return s=!0,t.next=18,p.getFindModel({model:u,params:{search:i,field:v,key:_,trashed:h}}).then((function(t){t.data.forEach((function(t){var e=t[_],s=t[v];f&&(s="["+t[m]+"] "+s);for(var a=o.children("option"),n=0;n<a.length;n++)if(a[n].value==e)return;o.append($("<option>",{value:e,text:s}))}))}));case 18:$(e.target).trigger("input");case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var o,p=new d.Q,_=p.client,h={docFields:window.DOC_FIELDS,initChosen:function(){$(".filled-select2").select2({placeholder:"Выберите значение",language:{noResults:function(t){return"Совпадений не найдено"}},allowClear:!1}),$(".js-chosen").chosen({width:"100%",search_contains:!0,no_results_text:"Совпадений не найдено",placeholder_text_single:"Выберите значение",placeholder_text_multiple:"Выберите значения",reset_search_field_on_update:!1})},initDoc:function(){$(".Doc textarea").each((function(){var t=this.name;$(this).click(f(n().mark((function e(){var s,a,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h.docFields[t]||!this.classList.contains("open-modal")){e.next=7;break}return s=h.docFields[t],e.next=4,l().fire({input:"select",inputOptions:s,inputPlaceholder:"Выберите опцию",showCancelButton:!0,confirmButtonText:"Применить",cancelButtonText:"Отмена"});case 4:a=e.sent,(r=a.value)&&(this.value=s[r]);case 7:case"end":return e.stop()}}),e,this)}))))})),$("#DOC_FORM").each((function(){var t=$(this).data("protokol");if(t)for(var e in t){if("id"!==e)$(this).find('*[name="'.concat(e,'"]')).val(t[e])}$(this).submit((function(t){var e;t.preventDefault();var s={},a=(this.id.value,(null===(e=this.field)||void 0===e?void 0:e.value)||"protokol");$(this).find("input,textarea,select").each((function(){this.name&&(s[this.name]=this.value)})),p.saveDoc(a,s).then((function(t){location.reload()}))}))}))},initAll:function(){h.initDoc(),h.initChosen()}};if(o={},$(".croppie-demo").each((function(){var t=$(this).data("croppieId");o[t]=$(this).croppie({enableOrientation:!0,viewport:{width:170,height:170,type:"circle"},boundary:{width:200,height:200}})})),$('[id*="croppie-input"]').on("change",(function(){var t=new FileReader,e=this.id.replace("croppie-input","");t.onload=function(t){$("#croppie-block"+e).show(),o[e].croppie("bind",{url:t.target.result})},t.readAsDataURL(this.files[0]),this.files=null,this.value=""})),$(".croppie-save").click((function(){var t=$(this).data("croppieId");o[t].croppie("result",{type:"canvas",size:"viewport"}).then((function(e){l().fire({title:"Изображение обрезано",icon:"info"}),$("#croppie-result-base64".concat(t)).val(e),$("#croppie-block"+t).hide()}))})),$(".croppie-delete").click((function(){var t=$(this).data("croppieId"),e=$("#croppie-input".concat(t));e&&t&&(e[0].files=null,e[0].value="",$("#croppie-result-base64".concat(t)).val(""),$("#croppie-block"+t).hide())})),location.pathname.indexOf("home")>-1){var b=location.origin+location.pathname;b.endsWith("/")||(b+="/"),b+="filters"+location.search,$.get(b).done((function(t){t&&($("#filter-groupsContent").html(t),h.initChosen())}))}var g=function(){var t=f(n().mark((function t(e,s,a,r){var i,o,l,d,f,m,v,_,b,g,y;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=30;break}i="CARD_"+e.toUpperCase(),o='<form id="form_'.concat(e,'">'),l=e+"_input",$("#".concat(i)).html('<b class="text-info">Загружаем данные...</b>'),t.t0=n().keys(s);case 4:if((t.t1=t.t0()).done){t.next=23;break}if(d=t.t1.value,!(f=a[d])&&"contract"!==d&&"contracts"!==d){t.next=21;break}if("id"==d||"hash_id"==d){t.next=21;break}if(m="",v="",_=(0,c.Z)(),""===(b=r.blockedFields.includes(d)?"disabled":"")&&(v='<a href="" style="font-size: 10px; color: #c2c2c2;" onclick="$(\'#'.concat(_,"').val('').trigger('change'); return false;\"><i class=\"fa fa-trash\"></i> Очистить</a>")),"contract_id"!==d&&"contract"!==d&&"contracts"!==d){t.next=13;break}return t.abrupt("continue",4);case 13:if("select"!==f.type){t.next=18;break}return t.next=16,p.getFieldHTML({field:d,model:e,default_value:encodeURIComponent(s[d])}).then((function(t){m=t.data}));case 16:t.next=19;break;case 18:"note"===d||"comment"===d||"name"===d?m='<textarea id="'.concat(_,'" ').concat(b,' data-model="').concat(e,'" class="ANKETAS_TEXTAREA form-control" name="').concat(d,'">').concat((s[d]?s[d]:"").trim(),"</textarea>"):"photo"===d?(v="",s[d]&&(m='<img src="/storage/'.concat(s[d],'" width="60%" />'))):m='<input id="'.concat(_,'" ').concat(b,' data-model="').concat(e,'" class="form-control" type="').concat(f.type,"\" value='").concat(s[d]?s[d]:"","' name=\"").concat(d,'" />');case 19:"products_id"!==d&&(o+='\n                                <p style="'.concat("dismissed"===d&&"ДА"===s[d].toUpperCase()?"color: red; font-weight: bold;":"",'" data-field-card="').concat(e,"_").concat(d,'" class="text-small m-0">').concat(f.label,":<br/>\n                                    ").concat(v,'\n                                    <div class="form-group ').concat(l,'">\n                                        ').concat(m,"\n                                    </div>\n                                </p>")),("company_id"===d&&"Driver"===e||"town_id"===d&&"Company"===e)&&(s.contract?(o+='\n                               <p class="text-small m-0">Договор:</p>',0!=s.contract.length?(o+='\n                            <ul class="list-group my-2">\n                                <li style="padding: 0;" class="text-small list-group-item list-group-item-action list-group-item-success">\n                                <b>'.concat(s.contract.name_with_dates,'</b>\n\n                            <ul class="list-group">'),s.contract.services&&s.contract.services.map((function(t){o+='<li style="padding: 0; font-size: 0.8em" class="list-group-item text-small list-group-item-action list-group-item-secondary">'.concat(t.name,"</li>")})),o+="\n                            </ul></li>\n                            </ul>"):o+='\n                               <p class="text-small">-- Отсутствует --</p>'):s.contracts&&(o+='\n                               <p class="text-small m-0">Договор:</p>',0!=s.contracts.length?(o+='<ul class="list-group my-2">',s.contracts.map((function(t){t.services&&(o+='\n\n                                    <li style="padding: 0;" class=" text-small list-group-item list-group-item-action list-group-item-success"><ul class="list-group">\n                                    <b>'.concat(t.name_with_dates,"</b>"),t.services.map((function(t){o+='\n                                    <li style="padding: 0; font-size: 0.8em" class="list-group-item text-small list-group-item-action list-group-item-secondary">\n                                    '.concat(t.name,"</li>")})),o+="</ul></li>")})),o+="</ul>"):o+='\n                               <p class="text-small">-- Отсутствует --</p>'));case 21:t.next=4;break;case 23:if(o+='<button type="submit" class="btn btn-sm btn-success">Сохранить</button></form>',$("#".concat(i)).html(o),h.initChosen(),$("#form_".concat(e)).submit((function(t){t.preventDefault(),confirm("Сохранить?")&&$(this).find(".".concat(l," input, .").concat(l," select, .").concat(l," textarea")).each((function(){var t=this.value,a=this.name;a&&p.updateModelProperty({item_model:e,item_field:a,item_id:s.id,new_value:t})}))})),$(".ANKETAS_TEXTAREA").each((function(){this.style.height=this.scrollHeight+"px"})),(g=r.redDates)&&"object"===u(g)&&!Array.isArray(g))for(y in g)$('*[data-field-card="'.concat(e,"_").concat(y,'"]')).css({color:"red","font-weight":"bold"});case 30:case"end":return t.stop()}}),t)})));return function(e,s,a,n){return t.apply(this,arguments)}}();window.changeFormRequire=function(t,e){var s,a;t.value.length>0?null===(s=$(t).parents(".cloning"))||void 0===s||s.find("."+e).prop("required",!1):null===(a=$(t).parents(".cloning"))||void 0===a||a.find("."+e).prop("required",!0)},window.loadPreviousOdometer=f(n().mark((function t(){var e,s,a,r,i,o,l,c;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$(event.target).parent().parent(),s=e.parent().parent(),void 0!==(a=e.find("input")[0])){t.next=6;break}return console.error("Не найдено поле для предыдущего показания одометра"),t.abrupt("return");case 6:if(t.prev=6,r=a.name.match(/\[([0-9]+)\]/)[0],void 0!==(i=s.find('input[name="anketa'.concat(r,'[car_id]"]'))[0])){t.next=12;break}return a.value="Не найдено поле ID автомобиля",t.abrupt("return");case 12:if(0!==(o=i.value).trim().length){t.next=16;break}return a.value="Не указано ID автомобиля",t.abrupt("return");case 16:if(void 0!==(l=s.find('input[name="anketa'.concat(r,'[date]"]'))[0])){t.next=20;break}return a.value="Не найдено поле Дата и время осмотра",t.abrupt("return");case 20:if(0!==(c=l.value).trim().length){t.next=24;break}return a.value="Не указана Дата и время осмотра",t.abrupt("return");case 24:a.value="Получение данных...",$.ajax({type:"POST",url:"/api/get-previous-odometer",headers:{Authorization:"Bearer "+API_TOKEN},data:{car_id:o,date:c},success:function(t){a.value=t.message},error:function(t){422===t.status?a.value=Object.values(t.responseJSON.errors)[0][0]:a.value="Ошибка получения данных!"}}),t.next=32;break;case 28:t.prev=28,t.t0=t.catch(6),a.value="Ошибка!",console.error(t.t0.message);case 32:case"end":return t.stop()}}),t,null,[[6,28]])}))),window.checkInputProp=f(n().mark((function t(){var e,s,a,r,i,o,l,c=arguments;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c.length>0&&void 0!==c[0]?c[0]:"0",s=c.length>1&&void 0!==c[1]?c[1]:"0",a=c.length>2&&void 0!==c[2]?c[2]:"0",r=c.length>3?c[3]:void 0,i=c.length>4?c[4]:void 0,o=c.length>5?c[5]:void 0,l=i||$(event.target).parent(),o){t.next=15;break}if(a){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,$.ajax({url:"/api/check-prop-one/".concat(e,"/").concat(s,"/").concat(a,"?dateAnketa=").concat($('[name="anketa[0][date]"]').val()),headers:{Authorization:"Bearer "+API_TOKEN},success:function(t){var e=l.find(".app-checker-prop");t.status?(e.removeClass("text-danger").addClass("text-success").text(t.name),l.closest("#ANKETA_FORM").find(".btn-success").prop("disabled",!1)):(e.removeClass("text-success").addClass("text-danger").text("Не найдено"),i.prevObject.attr("company",null),l.closest("#ANKETA_FORM").find(".btn-success").prop("disabled",!0))}});case 12:if(t.sent.status){t.next=15;break}return t.abrupt("return");case 15:$.ajax({url:"/api/check-prop/".concat(e,"/").concat(s,"/").concat(a,"?dateAnketa=").concat($('[name="anketa[0][date]"]').val()),headers:{Authorization:"Bearer "+API_TOKEN},success:function(t){var e=t.data.exists,a=t.data.message;if(("Driver"===s||"Car"===s)&&a.company_hash_id){var n=i.closest("#ANKETA_FORM");n.find('input[name="company_id"]').val(a.company_hash_id);var o=n.find('select[name="company_id"]');if(o.length>0)o.children("option").filter((function(t,e){return e.value===a.company_hash_id})).length<1&&o.append($("<option>",{value:a.company_hash_id,text:a.company_name})),o.select2().val(a.company_hash_id).trigger("change")}if(("Driver"===s||"Car"===s)&&a.company_name){var c=i.closest("#ANKETA_FORM").find('select[name="company_name"]');if(c.length>0)c.children("option").filter((function(t,e){return e.value===a.company_name})).length<1&&c.append($("<option>",{value:a.company_name,text:a.company_name})),c.select2().val(a.company_name).trigger("change")}if(g(s,a,t.data.fieldsValues,t.data),l.length){var d=l.find(".app-checker-prop");e?d.removeClass("text-danger").addClass("text-success").text(a[r]):d.removeClass("text-success").addClass("text-danger").text("Не найдено")}(a&&a.company_id&&($("#ANKETA_FORM").find('input[name="company_id"]').parent().find(".app-checker-prop").removeClass("text-danger").addClass("text-success").text(a.company_name),l.closest("#ANKETA_FORM").find(".btn-success").prop("disabled",!1),checkInputProp("id","Company",a.company_id,"name",$("#ANKETA_FORM").find('input[name="company_id"]').parent())),"Driver"===s&&a.company_hash_id)&&(i.prevObject.attr("company",a.company_hash_id),i.closest("#ANKETA_FORM").find(".car-input").each((function(t,e){var s=$(e).attr("company");if(s&&s!==a.company_hash_id){var n,r,i=null===(n=$(e).parent())||void 0===n?void 0:n.find(".app-checker-prop");(null==i||null===(r=i.find("#company"))||void 0===r?void 0:r.length)<1&&i.append('<br><span id="company" class="text-danger">Компания автомобиля не соответствует компании водителя</span>')}else if(s&&s===a.company_hash_id){var o,l,c=null===(o=$(e).parent())||void 0===o?void 0:o.find(".app-checker-prop");(null==c||null===(l=c.find("#company"))||void 0===l?void 0:l.length)>0&&c.find("#company").remove()}})));if("Car"===s&&a.company_hash_id){var u=i.closest("#ANKETA_FORM").find('input[name="driver_id"]');if(i.prevObject.attr("company",a.company_hash_id),u){var p=u.attr("company");p&&p!==a.company_hash_id&&i.find(".app-checker-prop").append('<br><span id="company" class="text-danger">Компания автомобиля не соответствует компании водителя</span>')}}}});case 16:case"end":return t.stop()}}),t)}))),window.addFieldToHistory=function(t,e){_.post("/api/field-history",{value:t,field:e})},window.exportTable=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t=document.getElementById(t)){t=t.cloneNode(!0),e||$(t).find(".not-export").remove(),$(t).find(".modal").remove();var s="data:application/vnd.ms-excel;base64,",a='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>',n=function(t){return window.btoa(unescape(encodeURIComponent(t)))},r=function(t,e){return t.replace(/{(\w+)}/g,(function(t,s){return e[s]}))},i=t=(t=t.innerHTML).replace(/<(\/*)a[^>]*>/g,"<span>").replace("</a>","</span>"),o={worksheet:name||"",table:i},l=document.createElement("a");l.download="export.xls",l.href=s+n(r(a,o)),l.setAttribute("target","_blank"),l.click(),setTimeout((function(){var t="&exportPrikaz=1&typePrikaz=Dop";if(location.href.indexOf(t)>-1){var e=location.href.replace(t,"");e=e.replace(/(export\=1\&)|(\&export\=1)|(export\=1)/g,""),location.href=e}}),1500)}},$("[data-toggle-show]").click((function(t){t.preventDefault();var e=$(this),s=$(e.data("toggle-show")),a=e.find(".toggle-title"),n="toggle-hidden",r="Показать";s.length&&a.length&&(r=s.hasClass(n)?"Скрыть":r,a.text(r),s.toggleClass(n))})),$(".field").each((function(){var t=$(this),e=t.find("> i"),s=t.find("> input");t.hasClass("field--password")&&e.click((function(){$(this).hasClass("fa-eye")?($(this).removeClass("fa-eye").addClass("fa-eye-slash"),s.attr("type","password")):($(this).removeClass("fa-eye-slash").addClass("fa-eye"),s.attr("type","text"))}))})),$('*[class*="ACTION_"]').click((function(t){var e=this;t.preventDefault();var s={ACTION_DELETE:"Точно хотите удалить?"};this.classList.forEach((function(t){s[t]&&confirm(s[t])&&(location.href=e.href)}))})),$(".TRIGGER_CLICK").trigger("click");var y=1;function C(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=$(t),n=a.find("[required]"),r=[];if(n.each((function(){var t=$(this).val(),e=$(this).data("label");"object"===u(t)?0===t.length&&r.push('Поле "'.concat(e,'" не заполнено')):t||r.push('Поле "'.concat(e,'" не заполнено'))})),r.length)return s&&s.preventDefault(),void e.fire({icon:"error",text:r[0]})}$("#ANKETA_CLONE_TRIGGER").click((function(t){var e="cloning";if(y+1!==32){var s=$("#".concat(e,"-first")),a=$("#".concat(e,"-append")),n=s.clone(),r="ANKETA_DOUBLE_"+y;a.find(".cloning-clone").length&&(n=a.find(".cloning-clone").last().clone()),n.removeAttr("id").addClass("cloning-clone"),n.attr("id",r),a.append(n),n.find("input,select").each((function(){this.name=this.name.replace("anketa["+(y-1)+"]","anketa["+y+"]")})),n.find(".date-range")[0]&&v(n.find(".date-range")[0]),y++,n.find(".anketa-delete").html('<a href="" onclick="'+r+'.remove(); return false;" class="text-danger">Удалить</a>')}else l().fire({title:"Нельзя добавлять более 31 осмотров",icon:"warning"})})),$(".anketa-fields input, .anketa-fields textarea").keydown((function(t){t.ctrlKey&13==t.keyCode&&$(".anketa-fields form").trigger("submit")})),$(".JS_CHANGE_FIELD_MODEL").click((function(t){t.preventDefault();var e=this.href,s=$(this).data("field");if((s=$(s)).length){var a=s.val();_.put(e.replace(location.origin,""),{new_value:a}).then((function(t){t.data.success&&alert("Данные успешно обновлены!")}))}})),$(".card-close a.remove").on("click",(function(t){t.preventDefault(),$(this).parents(".card").fadeOut()})),$('[data-toggle="tooltip"]').tooltip(),$("[rel='tooltip'], .tooltip").tooltip(),$(".dropdown").on("show.bs.dropdown",(function(){$(this).find(".dropdown-menu").first().stop(!0,!0).fadeIn()})),$(".dropdown").on("hide.bs.dropdown",(function(){$(this).find(".dropdown-menu").first().stop(!0,!0).fadeOut()})),$("#toggle-btn").on("click",(function(t){t.preventDefault(),$(this).toggleClass("active"),$(".side-navbar").toggleClass("shrinked"),$(".content-inner").toggleClass("active"),$(document).trigger("sidebarChanged"),$(window).outerWidth()>1183&&($("#toggle-btn").hasClass("active")?($(".navbar-header .brand-small").hide(),$(".navbar-header .brand-big").show()):($(".navbar-header .brand-small").show(),$(".navbar-header .brand-big").hide())),$(window).outerWidth()<1183&&$(".navbar-header .brand-small").show()})),$("[data-btn-collapse]").click((function(t){t.preventDefault();var e=$(this),s=$(e.data("btn-collapse")),a="collapse";e.attr("aria-expanded",s.hasClass(a)),s.length&&s.toggleClass(a)})),$('[id*="elements-modal"] form, [id="elements-modal-add"] form').submit((function(t){C(this,t)})),$('[id*="elements-modal"] button[type="submit"], [id="elements-modal-add"] button[type="submit"]').click((function(t){var e=$(this).parents("form");e.length&&C(e)})),$(".API_FORM_SEND").submit(function(){var t=f(n().mark((function t(e){var s,a,r,o;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),document.querySelector("#page-preloader").classList.remove("hide"),s=$(this).serialize(),a=this.action,r=this.method,new FormData(this),o=(o=$(this).data("successTitle"))||"Успешно!",t.next=6,i()[r](a,s,{headers:{Authorization:"Bearer "+API_TOKEN}}).then((function(t){l().fire({title:o,icon:"info"})}));case 6:document.querySelector("#page-preloader").classList.add("hide");case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()),$("a[data-btn-collapse] + ul a").each((function(){var t=this.href.replace(location.origin,"");location.pathname.indexOf(t)>-1&&$(this).parent().parent().prev().trigger("click")})),$(".App-Timer[data-date]").each((function(){var t=$(this),e=new Date(t.data("date"));setInterval((function(){!function(e,s){var a=(s-e)/1e3;a=Math.abs(Math.floor(a));var n=Math.floor(a/86400),r=a-24*n*60*60,i=Math.floor(r/3600),o=(r-=60*i*60,Math.floor(r/60));r-=60*o,t.html("<b class='text-red'>"+(n<10?"0"+n:n)+":"+(i<10?"0"+i:i)+":"+(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)+"</b>")}(e,new Date)}),1e3)}));var x=$("input.input-material");x.filter((function(){return""!==$(this).val()})).siblings(".label-material").addClass("active"),x.on("focus",(function(){$(this).siblings(".label-material").addClass("active")})),x.on("blur",(function(){$(this).siblings(".label-material").removeClass("active"),""!==$(this).val()?$(this).siblings(".label-material").addClass("active"):$(this).siblings(".label-material").removeClass("active")}));var w=$(".content-inner");function k(){var t=$(".main-footer").outerHeight();w.css("padding-bottom",t+"px")}function M(t,e){t&&e&&t.suggestions({token:"4de76a04c285fbbad3b2dc7bcaa3ad39233d4300",type:"PARTY",onSelect:function(t){if(t.data){var s=t.data.inn;e.val(s)}}})}$(document).on("sidebarChanged",(function(){k()})),$(window).on("resize",(function(){k()})),$(".external").on("click",(function(t){t.preventDefault(),window.open($(this).attr("href"))})),screen.width<=900&&$("#toggle-btn").trigger("click"),$('input[type="checkbox"][data-connect-field]').each((function(){var t=this,e=$(this).data("connectField");e=$('*[name="'.concat(e,'"]'));var s=function(){t.checked?e.removeAttr("disabled"):(e.attr("disabled","disabled"),e.removeAttr("checked"))};$(this).change((function(){s()})),s()})),M($('*[data-field="Company_name"]'),$('#elements-modal-add input[name="inn"]')),$(".header #toggle-btn").each((function(){var t=function(t){localStorage.setItem("sidebar",t)};"0"===localStorage.getItem("sidebar")&&$(this).trigger("click"),$(this).click((function(){$(this).hasClass("active")?t(1):t(0)}))})),h.initAll(),$(".MASK_ID_ELEM").trigger("input"),$("#modalEditor").on("shown.bs.modal",(function(t){var e=$(t.relatedTarget).data("route"),s=$("#modalEditor .modal-content");i().get(e).then((function(t){var e=t.data;s.text("").append(e),h.initAll(),M($('#modalEditor *[data-field="Company_name"]'),$('#modalEditor input[name="inn"]'))}))}));var D=$("*[name=type_product]").chosen();D.change((function(t,e){"Абонентская плата без реестров"===e.selected?(D.closest(".modal-body").find("select[name=type_anketa]").prop("disabled",!0),D.closest(".modal-body").find('select[name="type_view[]"]').prop("disabled",!0),D.closest(".modal-body").find("select[name=type_anketa]").prop("required",!1),D.closest(".modal-body").find('select[name="type_view[]"]').prop("required",!1)):(D.closest(".modal-body").find("select[name=type_anketa]").prop("disabled",!1),D.closest(".modal-body").find('select[name="type_view[]"]').prop("disabled",!1),D.closest(".modal-body").find("select[name=type_anketa]").prop("required",!0),D.closest(".modal-body").find('select[name="type_view[]"]').prop("required",!0))})),$(document).on("change",".filled-select2.filled-select.type_product",(function(t){var e=$(t.target);"Абонентская плата без реестров"===e.val()?(e.closest(".modal-body").find("select[name=type_anketa]").prop("disabled",!0),e.closest(".modal-body").find('select[name="type_view[]"]').prop("disabled",!0),e.closest(".modal-body").find("select[name=type_anketa]").prop("required",!1),e.closest(".modal-body").find('select[name="type_view[]"]').prop("required",!1)):(e.closest(".modal-body").find('select[name="type_view[]"]').prop("disabled",!1),e.closest(".modal-body").find("select[name=type_anketa]").prop("disabled",!1),e.closest(".modal-body").find("select[name=type_anketa]").prop("required",!0),e.closest(".modal-body").find('select[name="type_view[]"]').prop("required",!0))})),$(document).on("change ready",'select[name="company_id"]',(function(t){var e=$(this).val(),s=$('select[name="company_id"]').parent().parent().parent().find("#select_for_contract_driver_car");s.empty(),i().post("/contract/getAvailableForCompany",{company_id:e}).then((function(t){var e=t.data;e.status?(s.append($("<option>",{value:"",text:"Не установлено"})),e.contracts.map((function(t){s.append($("<option>",{value:t.id,text:t.name}))}))):l().fire("Ошибка",e.message,"warning")}))}))}))},7604:(t,e,s)=>{s(6688),s(686);$(window).on("load",(function(){!function(){var t={".MASK_ID_ELEM":"000000000",".MASK_DATETIME":"00.00.0000 00:00",".MASK_UTC":"UTC-#",".MASK_TONOM":"900/00",".MASK_PHONE":"+70000000000"};for(var e in t)$(e).mask(t[e])}()}))},1231:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-card[data-v-8daddd10]{max-height:80vh;overflow:hidden}.table-card>.card-body[data-v-8daddd10]{-ms-scroll-chaining:none;margin:15px!important;overflow:scroll;overscroll-behavior:contain;padding:0!important}",""]);const r=n},4811:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".modal-dialog.modal-xl[data-v-4deeba99]{margin:1.75rem auto;max-width:90%}",""]);const r=n},2951:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".box{align-content:space-between;display:flex;flex-direction:column;flex-wrap:wrap;max-height:400px;width:500px}.modal-dialog.modal-xl{margin:1.75rem auto;max-width:90%}.row-check-in-a-month{background-color:#fbf1d3!important}.row-check-expired{background-color:#fbd3d3!important}.table-card{max-height:80vh;overflow:hidden}.table-card>.card-body{-ms-scroll-chaining:none;margin:15px!important;overflow:scroll;overscroll-behavior:contain;padding:0!important}",""]);const r=n},4095:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".box{align-content:space-between;display:flex;flex-direction:column;flex-wrap:wrap;max-height:400px;width:500px}.modal-dialog.modal-xl{margin:1.75rem auto;max-width:90%}.table-card{max-height:80vh;overflow:hidden}.table-card>.card-body{-ms-scroll-chaining:none;margin:15px!important;overflow:scroll;overscroll-behavior:contain;padding:0!important}",""]);const r=n},113:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-responsive[data-v-e95af580]{-ms-scroll-chaining:none!important;max-height:80vh!important;overscroll-behavior:none!important}",""]);const r=n},9868:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-responsive[data-v-d6be2794]{-ms-scroll-chaining:none!important;max-height:50vh!important;overscroll-behavior:none!important}",""]);const r=n},9275:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-responsive[data-v-3d9ea51a]{-ms-scroll-chaining:none!important;max-height:80vh!important;overscroll-behavior:none!important}",""]);const r=n},5524:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,"thead{background-color:#fff;position:sticky;top:0}",""]);const r=n},7188:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-card[data-v-7ece5de9]{max-height:80vh;overflow:hidden}.table-card>.card-body[data-v-7ece5de9]{-ms-scroll-chaining:none;margin:15px!important;overflow:scroll;overscroll-behavior:contain;padding:0!important}",""]);const r=n},8333:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".table-responsive[data-v-18d34de1]{-ms-scroll-chaining:none!important;max-height:80vh!important;overscroll-behavior:none!important}",""]);const r=n},3122:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var a=s(3645),n=s.n(a)()((function(t){return t[1]}));n.push([t.id,".alert-danger[data-v-2dcb38e0]{font-size:12px}",""]);const r=n},5067:()=>{},6700:(t,e,s)=>{var a={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":238,"./ru.js":238,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":9822,"./vi.js":9822,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function n(t){var e=r(t);return s(e)}function r(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=6700},410:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={data:function(){return{show:!1}},methods:{open:function(t){this.show=!0,this.prompt=t},deleteElement:function(){var t=this;axios.delete("/field/prompt/"+this.prompt.id).then((function(e){e.data;t.show=!1,t.$toast("Подсказка удалена",{type:"error"}),t.$emit("success")})).catch((function(e){console.error(e),t.$toast("Ошибка!",{type:"error"})}))}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-header":"","hide-footer":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",{staticClass:"d-block"},[s("span",{staticClass:"fs-5 d-block fw-bold"},[t._v("Вы уверены, что хотите удалить подсказку?")]),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:t.deleteElement}},[t._v("\n                Удалить\n            ")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"info"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")])],1)])])}),[],!1,null,"5652aa20",null).exports},5868:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});var a=s(7757),n=s.n(a),r=s(2739);function i(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const o={components:{VueEditor:r.bR},props:["types","fields"],data:function(){return{show:!1,saving:!1,prompt:{},customToolbar:[["bold","italic","underline","strike"],[{size:["small",!1,"large"]}],["link",{color:[]}]]}},mounted:function(){var t=r.CX.import("attributors/class/color");r.CX.register(t,!0)},methods:{validate:function(){return!!this.prompt&&(!!this.prompt.name||(this.$toast("Укажите название поля",{type:"error"}),!1))},open:function(t){this.show=!0,this.prompt=Object.assign({},t)},saveElement:function(){var t,e=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.validate()){t.next=2;break}return t.abrupt("return");case 2:return e.saving=!0,t.next=5,axios.put("/field/prompt/"+e.prompt.id,{name:e.prompt.name,content:e.prompt.content}).then((function(t){t.data,e.show=!1,e.$toast("Изменения сохранены"),e.$emit("success",e.prompt)})).catch((function(t){console.error(t),e.$toast("Ошибка!",{type:"error"})}));case 5:e.saving=!1;case 6:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function o(t){i(r,a,n,o,l,"next",t)}function l(t){i(r,a,n,o,l,"throw",t)}o(void 0)}))})()}}};const l=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-footer":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t._v("\n        Добавить подсказку\n    ")]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v(" "),s("div",{staticClass:"d-block"},[s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Название поля")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите название поля"},model:{value:t.prompt.name,callback:function(e){t.$set(t.prompt,"name",e)},expression:"prompt.name"}})],1),t._v(" "),s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Содержимое подсказки")]),t._v(" "),s("vue-editor",{attrs:{"editor-toolbar":t.customToolbar},model:{value:t.prompt.content,callback:function(e){t.$set(t.prompt,"content",e)},expression:"prompt.content"}})],1),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"success",disabled:t.saving},on:{click:t.saveElement}},[t.saving?s("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v("\n                Сохранить\n            ")],1)],1)])])}),[],!1,null,"27f053c8",null).exports},1120:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>h});var a=s(410),n=s(4490),r=s(5868),i=s(992);function o(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function l(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?o(Object(s),!0).forEach((function(e){c(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function d(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}const p={props:["types","fields","permissions","selfprompts"],components:{AdminPromptDeleteModal:a.default,AdminPromptRestoreModal:n.default,AdminPromptEditModal:r.default},data:function(){return{prompts:[],perPage:25,sortBy:"id",sortDesc:!1,loading:!1,total:0,type:null,field:null,filters:{},currentPage:1,column:[{key:"actions",sortable:!1,label:"#",class:"text-right options-column"}],columnTrash:[{key:"deleted_user.name",sortable:!0,label:"Имя удалившего"},{key:"deleted_at",sortable:!0,label:"Время удаления"}]}},mounted:function(){var t=this;this.filters=(0,i.Q)(),this.filters.trash&&this.changeTrash(!0),this.filters.type&&(this.type=this.types.filter((function(e){return e.key===t.filters.type}))[0],this.filters.field&&(this.field=this.fields[this.filters.type].filter((function(e){return e.key===t.filters.field}))[0])),this.currentPage=Number(this.filters.page)||1;var e=[];this.selfprompts.forEach((function(t){var s={key:t.field,label:t.name,sortable:!0,thAttr:{"data-toggle":"tooltip","data-html":!0,"data-trigger":"hover","data-placement":"top",title:t.content}};"content"===s.key&&(s.class="text-center options-column"),e.push(s)})),this.column=[].concat(e,d(this.column)),this.loadData()},methods:{fieldsType:function(){return this.type?this.fields[this.type.key]:[]},changeTrash:function(t){var e,s=this;(this.filters.trash=t,t)?(e=this.column).splice.apply(e,[2,0].concat(d(this.columnTrash))):this.column=this.column.filter((function(t){return!s.columnTrash.includes(t)}));this.loadData()},updatePrompt:function(t){this.fields[t.type]=this.fields[t.type].map((function(e){return e.key===t.field&&(e.name=t.name),e})),this.loadData()},changePage:function(t){this.currentPage=t,this.loadData()},loadData:function(){var t,e,s=this;this.filters.field=null===(t=this.field)||void 0===t?void 0:t.key,this.filters.type=null===(e=this.type)||void 0===e?void 0:e.key;var a=l(l({},this.filters),{},{page:this.currentPage,perPage:this.perPage,sortBy:this.sortBy,sortDesc:this.sortDesc});(0,i.F)(a),axios.post("/field/prompt/filter",a).then((function(t){var e=t.data;s.currentPage=e.current_page,s.total=e.total,s.prompts=e.data}))}}};var f=s(3379),m=s.n(f),v=s(1231),_={insert:"head",singleton:!1};m()(v.Z,_);v.Z.locals;const h=(0,s(1900).Z)(p,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-lg-12"},[s("div",{staticClass:"d-flex buttons flex-wrap"},[s("div",{staticClass:"d-flex justify-content-center flex-wrap"},[t.permissions.permission_to_trash?s("div",[t.filters.trash?s("b-button",{staticClass:"mb-3 ml-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.changeTrash(!1)}}},[t._v("\n                    назад\n                ")]):s("b-button",{staticClass:"mb-3 ml-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.changeTrash(!0)}}},[s("b-icon-trash"),t._v("\n                    Корзина\n                ")],1)],1):t._e()])]),t._v(" "),s("div",{staticClass:"card",staticStyle:{"overflow-x":"inherit"}},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("multiselect",{attrs:{options:t.types,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите журнал",label:"name",taggable:!0},on:{input:function(e){t.field=null},"sort-changed":t.loadData},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Результатов не найдено")])])],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("multiselect",{attrs:{options:t.fieldsType(),disabled:!t.type,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите поле",label:"name",taggable:!0},model:{value:t.field,callback:function(e){t.field=e},expression:"field"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Результатов не найдено")])])],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center"},[s("b-button",{attrs:{variant:"info"},on:{click:t.loadData}},[t._v("\n                        Поиск\n                    ")])],1)])])]),t._v(" "),s("div",{staticClass:"card table-card"},[s("div",{staticClass:"card-body pt-0"},[s("b-table",{attrs:{items:t.prompts,fields:t.column,striped:"",hover:"","no-local-sorting":"","sort-by":t.sortBy,"sort-desc":t.sortDesc,"current-page":t.currentPage,busy:t.loading,"label-sort-asc":"","label-sort-desc":"","label-sort-clear":""},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},"sort-changed":t.loadData},scopedSlots:t._u([{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center text-primary my-2"},[s("b-spinner",{staticClass:"align-middle"})],1)]},proxy:!0},{key:"cell(type)",fn:function(e){var s=e.item;return[t._v("\n                    "+t._s(t.types.filter((function(t){return t.key===s.type}))[0].name)+"\n                ")]}},{key:"cell(content)",fn:function(e){var a=e.item;return[a.content?s("div",{staticClass:"text-center",domProps:{innerHTML:t._s(a.content)}}):s("span",{staticClass:"badge bg-success text-white"},[t._v("Отсутствует")])]}},{key:"cell(actions)",fn:function(e){var a=e.item;return[s("div",{staticClass:"d-flex justify-content-end"},[!t.filters.trash&&t.permissions.permission_to_edit?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"info"},on:{click:function(e){return t.$refs.editModal.open(a)}}},[s("b-icon-pencil")],1):t._e(),t._v(" "),!t.filters.trash&&t.permissions.permission_to_delete&&"field_prompts"!==a.type?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.$refs.deleteModal.open(a)}}},[s("b-icon-trash-fill")],1):t._e(),t._v(" "),t.filters.trash?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.$refs.restoreModal.open(a)}}},[s("i",{staticClass:"fa fa-undo"})]):t._e()],1)]}}])})],1)]),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("b-row",{staticClass:"w-100 d-flex justify-content-start"},[s("b-col",{staticClass:"my-1 d-flex justify-content-start"},[s("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.total,"per-page":t.perPage},on:{change:t.changePage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1)]),t._v(" "),s("AdminPromptDeleteModal",{ref:"deleteModal",on:{success:t.loadData}}),t._v(" "),s("AdminPromptRestoreModal",{ref:"restoreModal",on:{success:t.loadData}}),t._v(" "),s("AdminPromptEditModal",{ref:"editModal",attrs:{types:t.types,fields:t.fields},on:{success:t.updatePrompt}})],1)}),[],!1,null,"8daddd10",null).exports},4490:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={data:function(){return{show:!1}},methods:{open:function(t){this.show=!0,this.prompt=t},restoreElement:function(){var t=this;axios.delete("/field/prompt/"+this.prompt.id).then((function(e){e.data;t.show=!1,t.$toast("Подсказка восстановлена",{type:"success"}),t.$emit("success")})).catch((function(e){console.error(e),t.$toast("Ошибка!",{type:"error"})}))}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-header":"","hide-footer":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",{staticClass:"d-block"},[s("span",{staticClass:"fs-5 d-block fw-bold"},[t._v("Вы уверены, что хотите восстановить подсказку?")]),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"success"},on:{click:t.restoreElement}},[t._v("\n                Восстановить\n            ")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"info"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")])],1)])])}),[],!1,null,"bf2f1508",null).exports},4945:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d});var a=s(7757),n=s.n(a);function r(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function i(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?r(Object(s),!0).forEach((function(e){o(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const c={data:function(){return{show:!1,saving:!1,stamp:{}}},methods:{validate:function(){return this.stamp.name?this.stamp.company_name?!!this.stamp.licence||(this.$toast("Укажите лицензию",{type:"error"}),!1):(this.$toast("Укажите заголовок",{type:"error"}),!1):(this.$toast("Укажите название",{type:"error"}),!1)},open:function(){this.show=!0},saveElement:function(){var t,e=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.validate()){t.next=2;break}return t.abrupt("return");case 2:return e.saving=!0,t.next=5,axios.post("/stamp",i({},e.stamp)).then((function(t){t.data,e.show=!1,e.$toast("Штамп успешно добавлен"),e.$emit("success",e.stamp)})).catch((function(t){console.error(t),e.$toast("Ошибка!",{type:"error"})}));case 5:e.saving=!1;case 6:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){l(r,a,n,i,o,"next",t)}function o(t){l(r,a,n,i,o,"throw",t)}i(void 0)}))})()}}};const d=(0,s(1900).Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-footer":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t._v("\n        Добавить подсказку\n    ")]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v(" "),s("div",{staticClass:"d-block"},[s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Название")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите название"},model:{value:t.stamp.name,callback:function(e){t.$set(t.stamp,"name",e)},expression:"stamp.name"}})],1),t._v(" "),s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Заголовок")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите заголовок"},model:{value:t.stamp.company_name,callback:function(e){t.$set(t.stamp,"company_name",e)},expression:"stamp.company_name"}})],1),t._v(" "),s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Лицензия")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите лицензию"},model:{value:t.stamp.licence,callback:function(e){t.$set(t.stamp,"licence",e)},expression:"stamp.licence"}})],1),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"success",disabled:t.saving},on:{click:t.saveElement}},[t.saving?s("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v("\n                Сохранить\n            ")],1)],1)])])}),[],!1,null,null,null).exports},4517:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={data:function(){return{show:!1,stamp:{}}},methods:{open:function(t){this.show=!0,this.stamp=t},deleteElement:function(){var t=this;axios.delete("/stamp/"+this.stamp.id).then((function(e){e.data;t.show=!1,t.$toast("Штамп удален",{type:"error"}),t.$emit("success")})).catch((function(e){console.error(e),t.$toast("Ошибка!",{type:"error"})}))}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-header":"","hide-footer":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",{staticClass:"d-block"},[s("span",{staticClass:"fs-5 d-block fw-bold text-center"},[t._v("Вы уверены, что хотите удалить штап?")]),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-center"},[s("b-button",{attrs:{variant:"danger"},on:{click:t.deleteElement}},[t._v("\n                Удалить\n            ")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"info"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")])],1)])])}),[],!1,null,"1baa3a8b",null).exports},8566:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>c});var a=s(7757),n=s.n(a);function r(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function i(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const l={data:function(){return{show:!1,saving:!1,stamp:{}}},methods:{validate:function(){return this.stamp.name?this.stamp.company_name?!!this.stamp.licence||(this.$toast("Укажите лицензию",{type:"error"}),!1):(this.$toast("Укажите заголовок",{type:"error"}),!1):(this.$toast("Укажите название",{type:"error"}),!1)},open:function(t){this.show=!0,this.stamp=function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?i(Object(s),!0).forEach((function(e){o(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({},t)},saveElement:function(){var t,e=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.validate()){t.next=2;break}return t.abrupt("return");case 2:return e.saving=!0,t.next=5,axios.put("/stamp/"+e.stamp.id,{name:e.stamp.name,company_name:e.stamp.company_name,licence:e.stamp.licence}).then((function(t){t.data,e.show=!1,e.$toast("Штамп успешно добавлен"),e.$emit("success",e.stamp)})).catch((function(t){console.error(t),e.$toast("Ошибка!",{type:"error"})}));case 5:e.saving=!1;case 6:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var i=t.apply(e,s);function o(t){r(i,a,n,o,l,"next",t)}function l(t){r(i,a,n,o,l,"throw",t)}o(void 0)}))})()}}};const c=(0,s(1900).Z)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-footer":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t._v("\n        Добавить подсказку\n    ")]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v(" "),s("div",{staticClass:"d-block"},[s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Название")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите название"},model:{value:t.stamp.name,callback:function(e){t.$set(t.stamp,"name",e)},expression:"stamp.name"}})],1),t._v(" "),s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Заголовок")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите заголовок"},model:{value:t.stamp.company_name,callback:function(e){t.$set(t.stamp,"company_name",e)},expression:"stamp.company_name"}})],1),t._v(" "),s("div",{staticClass:"form-group mb-3"},[s("label",{staticClass:"mb-1"},[t._v("Лицензия")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите лицензию"},model:{value:t.stamp.licence,callback:function(e){t.$set(t.stamp,"licence",e)},expression:"stamp.licence"}})],1),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"success",disabled:t.saving},on:{click:t.saveElement}},[t.saving?s("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v("\n                Сохранить\n            ")],1)],1)])])}),[],!1,null,null,null).exports},550:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>m});var a=s(992),n=s(4945),r=s(4517),i=s(3009),o=s(8566);function l(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function c(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?l(Object(s),!0).forEach((function(e){d(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function d(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function u(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}const f={props:["fields","permissions"],components:{AdminStampCreateModal:n.default,AdminStampDeleteModal:r.default,AdminStampRestoreModal:i.default,AdminStampEditModal:o.default},data:function(){return{prompts:[],perPage:15,sortBy:"id",sortDesc:!1,loading:!1,total:0,type:null,field:null,filters:{},currentPage:1,column:[{key:"actions",sortable:!1,label:"#",class:"text-right options-column"}],columnTrash:[{key:"deleted_user.name",sortable:!0,label:"Имя удалившего"},{key:"deleted_at",sortable:!0,label:"Время удаления"}]}},mounted:function(){var t=this;this.filters=(0,a.Q)(),this.filters.type&&(this.type=this.types.filter((function(e){return e.key===t.filters.type}))[0],this.filters.field&&(this.field=this.fields[this.filters.type].filter((function(e){return e.key===t.filters.field}))[0])),this.currentPage=Number(this.filters.page)||1;var e=[];this.fields.forEach((function(t){var s={key:t.field,label:t.name,sortable:!0,thAttr:{"data-toggle":"tooltip","data-html":!0,"data-trigger":"hover","data-placement":"top",title:t.content}};"content"===s.key&&(s.class="text-center options-column"),e.push(s)})),this.column=[].concat(e,u(this.column)),this.filters.trash&&this.changeTrash(!0),this.loadData()},methods:{fieldsType:function(){return this.type?this.fields[this.type.key]:[]},changeTrash:function(t){var e,s=this;(this.filters.trash=t,t)?(e=this.column).splice.apply(e,[2,0].concat(u(this.columnTrash))):this.column=this.column.filter((function(t){return!s.columnTrash.includes(t)}));this.loadData()},updatePrompt:function(t){this.fields[t.type]=this.fields[t.type].map((function(e){return e.key===t.field&&(e.name=t.name),e})),this.loadData()},changePage:function(t){this.currentPage=t,this.loadData()},loadData:function(){var t,e,s=this;this.filters.field=null===(t=this.field)||void 0===t?void 0:t.key,this.filters.type=null===(e=this.type)||void 0===e?void 0:e.key;var n=c(c({},this.filters),{},{page:this.currentPage,sortBy:this.sortBy,sortDesc:this.sortDesc});(0,a.F)(n),axios.post("/stamp/filter",n).then((function(t){var e=t.data;s.currentPage=e.current_page,s.total=e.total,s.prompts=e.data}))}}};const m=(0,s(1900).Z)(f,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-lg-12"},[s("div",{staticClass:"d-flex buttons flex-wrap"},[s("div",{staticClass:"d-flex justify-content-center flex-wrap"},[t.permissions.permission_to_create?s("b-button",{staticClass:"mb-3 ml-2",attrs:{variant:"success",size:"sm"},on:{click:function(e){return t.$refs.create.open()}}},[t._v("\n                Добавить\n                "),s("i",{staticClass:"fa fa-plus"})]):t._e(),t._v(" "),t.permissions.permission_to_trash&&!t.filters.trash?s("b-button",{staticClass:"mb-3 ml-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.changeTrash(!0)}}},[s("b-icon-trash"),t._v(" Корзина\n            ")],1):t.permissions.permission_to_trash?s("b-button",{staticClass:"mb-3 ml-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.changeTrash(!1)}}},[t._v("\n                назад\n            ")]):t._e()],1)]),t._v(" "),s("div",{staticClass:"card",staticStyle:{"overflow-x":"inherit"}},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.company_name,expression:"filters.company_name"}],staticClass:"form-control",attrs:{type:"text",name:"company_name",placeholder:"Введите заголовок"},domProps:{value:t.filters.company_name},on:{input:function(e){e.target.composing||t.$set(t.filters,"company_name",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"col-lg-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.licence,expression:"filters.licence"}],staticClass:"form-control",attrs:{type:"text",name:"licence",placeholder:"Введите лицензию"},domProps:{value:t.filters.licence},on:{input:function(e){e.target.composing||t.$set(t.filters,"licence",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"col-lg-2 form-group"},[s("b-button",{attrs:{variant:"info",size:"sm"},on:{click:t.loadData}},[t._v("\n                        Поиск\n                    ")]),t._v(" "),s("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:function(e){t.filters={}}}},[t._v("\n                        Сбросить\n                    ")])],1)])])]),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body pt-0"},[s("b-table",{attrs:{items:t.prompts,fields:t.column,striped:"",hover:"","no-local-sorting":"","sort-by":t.sortBy,"sort-desc":t.sortDesc,"current-page":t.currentPage,busy:t.loading,responsive:"","label-sort-asc":"","label-sort-desc":"","label-sort-clear":""},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},"sort-changed":t.loadData},scopedSlots:t._u([{key:"cell(actions)",fn:function(e){var a=e.item;return[s("div",{staticClass:"d-flex justify-content-end"},[!t.filters.trash&&t.permissions.permission_to_edit?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"info"},on:{click:function(e){return t.$refs.edit.open(a)}}},[s("b-icon-pencil")],1):t._e(),t._v(" "),!t.filters.trash&&t.permissions.permission_to_delete?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.$refs.delete.open(a)}}},[s("b-icon-trash-fill")],1):t._e(),t._v(" "),t.filters.trash?s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"warning"},on:{click:function(e){return t.$refs.restore.open(a)}}},[s("i",{staticClass:"fa fa-undo"})]):t._e()],1)]}}])}),t._v(" "),s("b-row",{staticClass:"w-100 d-flex justify-content-start"},[s("b-col",{staticClass:"my-1 d-flex justify-content-start"},[s("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.total,"per-page":t.perPage},on:{change:t.changePage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1)]),t._v(" "),s("admin-stamp-create-modal",{ref:"create",on:{success:t.loadData}}),t._v(" "),s("admin-stamp-delete-modal",{ref:"delete",on:{success:t.loadData}}),t._v(" "),s("admin-stamp-restore-modal",{ref:"restore",on:{success:t.loadData}}),t._v(" "),s("admin-stamp-edit-modal",{ref:"edit",on:{success:t.loadData}})],1)}),[],!1,null,"cd8005f0",null).exports},3009:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={data:function(){return{show:!1,stamp:{}}},methods:{open:function(t){this.show=!0,this.stamp=t},restoreElement:function(){var t=this;axios.delete("/stamp/"+this.stamp.id).then((function(e){e.data;t.show=!1,t.$toast("Штамп восстановлен",{type:"success"}),t.$emit("success")})).catch((function(e){console.error(e),t.$toast("Ошибка!",{type:"error"})}))}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"hide-header":"","hide-footer":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",{staticClass:"d-block"},[s("span",{staticClass:"fs-5 d-block fw-bold text-center"},[t._v("Вы уверены, что хотите восстановить штап?")]),t._v(" "),s("div",{staticClass:"mt-3 d-flex justify-content-center"},[s("b-button",{attrs:{variant:"success"},on:{click:t.restoreElement}},[t._v("\n                Восстановить\n            ")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"info"},on:{click:function(e){t.show=!1}}},[t._v("Отмена")])],1)])])}),[],!1,null,"0aee5dbf",null).exports},5223:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>p});var a=s(6455),n=s.n(a),r=s(9938),i=s.n(r);s(6532);const o={name:"AdminRolesIndex",props:["roles","all_permissions","current_user_permissions","deleted","fields"],components:{Swal2:n(),vSelect:i()},data:function(){return{allPermissions:[],editModal:!1,permission_collapse:!1,searchPermissions:"",infoModalRole:{id:null,name:null,guard_name:null,permissions:[]},optionsRoles:[],columns:[{key:"delete_btn",label:"#",class:"text-right"}],items:[],perPage:15,sortBy:"id",sortDesc:!1,currentPage:1,total:0,loading:!1}},methods:{saveRole:function(){var t=this;this.loading=!0,this.infoModalRole.id?axios.post("/roles/"+this.infoModalRole.id,{params:this.infoModalRole,_method:"PUT"}).then((function(e){var s=e.data;s.status?(location.reload(),t.editModal=!1,t.resetModal()):n().fire("Ошибка",s.message,"warning")})).finally((function(){t.loading=!1})):(this.infoModalRole.name="role_"+Math.floor(99999*Math.random())+1e3,axios.post("/roles",this.infoModalRole).then((function(e){var s=e.data;s.status?(t.editModal=!1,location.reload(),t.resetModal()):n().fire("Ошибка",s.message,"warning")})).catch((function(t){console.error(t),n().fire("Ошибка!","","warning")})).finally((function(){t.loading=!1})))},deleteRole:function(t){var e=this;n().fire({title:"Вы уверены, что хотите удалить?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена"}).then((function(s){s.isConfirmed&&axios.post("/roles/"+t,{_method:"DELETE"}).then((function(s){var a=s.data;a.status?(n().fire("Удалено","Данные были успешно удалены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):n().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))}))},returnTrash:function(t){var e=this;axios.post("/roles/return_trash",{id:t}).then((function(s){var a=s.data;a.status?(n().fire("Восстановлено","Данные были успешно восстановлены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):n().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))},editRoleData:function(t){this.fetchRoleData(t)},fetchRoleData:function(t){var e=this;this.loading=!0,axios.get("/roles/"+t).then((function(s){var a=s.data;e.infoModalRole.id=t,e.infoModalRole.name=a.name,e.infoModalRole.guard_name=a.guard_name,e.infoModalRole.permissions=a.permissions.map((function(t){return t.id})),e.showModal()})).finally((function(){e.loading=!1}))},resetModal:function(){this.infoModalRole.id=null,this.infoModalRole.name=null,this.infoModalRole.guard_name=null,this.infoModalRole.permissions=[]},showModal:function(){this.editModal=!0},hideModal:function(){this.editModal=!1,this.resetModal()},toggleModal:function(){this.resetModal(),this.$refs.groups_modal.toggle("#toggle-btn")}},mounted:function(){var t=this;this.items=this.roles,this.allPermissions=this.all_permissions,this.fields.forEach((function(e){t.columns.unshift({key:e.field,label:e.name,content:e.content})})),this.deleted&&this.columns.push({key:"deleted_user.name",label:"Имя удалившего"},{key:"deleted_at",label:"Время удаления"},{key:"return_trash",label:"#",class:"text-center"}),this.total=this.roles.length},watch:{searchPermissions:function(t){""!==t?(t=t.toLowerCase(),this.allPermissions=this.all_permissions.filter((function(e){return e.guard_name.toLowerCase().match(t)}))):this.allPermissions=this.all_permissions},editModal:function(t){t||this.resetModal()}}};var l=s(3379),c=s.n(l),d=s(4811),u={insert:"head",singleton:!1};c()(d.Z,u);d.Z.locals;const p=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"my-2"},[t.current_user_permissions.permission_to_create?s("b-button",{attrs:{variant:"success",size:"sm"},on:{click:t.showModal}},[t._v("\n            Добавить роль\n            "),s("i",{staticClass:"fa fa-plus"})]):t._e(),t._v(" "),t.current_user_permissions.permission_to_trash?s("b-button",{attrs:{variant:"warning",size:"sm",href:t.deleted?"/roles":"?deleted=1"}},[t.deleted?t._e():s("i",{staticClass:"fa fa-trash"}),t._v("\n            "+t._s(t.deleted?"Назад":"Корзина")+"\n        ")]):t._e()],1),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body pt-0"},[t.current_user_permissions.permission_to_view?s("b-table",{attrs:{items:t.items,fields:t.columns,"per-page":t.perPage,"current-page":t.currentPage,striped:"",hover:"","no-local-sorting":"",responsive:""},scopedSlots:t._u([{key:"head()",fn:function(e){return[s("span",{staticClass:"user-select-none",attrs:{"data-toggle":"tooltip","data-html":"true","data-trigger":"click hover","data-placement":"top",title:e.field?e.field.content:""}},[t._v("\n                        "+t._s(e.label)+"\n                    ")])]}},{key:"cell(guard_name)",fn:function(e){return[t.current_user_permissions.permission_to_edit?s("a",{attrs:{href:"#"},on:{click:function(s){return t.editRoleData(e.item.id)}}},[t._v("\n                        "+t._s(e.value)+"\n                    ")]):s("span",[t._v("\n                "+t._s(e.value)+"\n            ")])]}},{key:"cell(delete_btn)",fn:function(e){return[t.deleted?t._e():s("b-button",{attrs:{size:"sm",disabled:!t.current_user_permissions.permission_to_delete,variant:"danger"},on:{click:function(s){return t.deleteRole(e.item.id)}}},[s("b-icon",{attrs:{icon:"trash-fill","aria-hidden":"true"}})],1)]}},{key:"cell(return_trash)",fn:function(e){return[s("b-button",{attrs:{size:"sm",disabled:!t.current_user_permissions.permission_to_trash,variant:"warning"},on:{click:function(s){return t.returnTrash(e.item.id)}}},[s("i",{staticClass:"fa fa-undo"})])]}}],null,!1,2341118500)}):t._e(),t._v(" "),s("b-pagination",{attrs:{"total-rows":t.total,"per-page":t.perPage,"aria-controls":"my-table"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)]),t._v(" "),s("b-modal",{ref:"groups_modal",attrs:{size:"xl","hide-footer":"",title:t.infoModalRole.id?"Редактирование роли":"Добавление роли"},model:{value:t.editModal,callback:function(e){t.editModal=e},expression:"editModal"}},[s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"1"}},[s("label",[t._v("Роль:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{placeholder:"Введите роль"},model:{value:t.infoModalRole.guard_name,callback:function(e){t.$set(t.infoModalRole,"guard_name",e)},expression:"infoModalRole.guard_name"}})],1),t._v(" "),s("b-button",{class:t.permission_collapse?null:"collapsed",attrs:{"aria-expanded":t.permission_collapse?"true":"false","aria-controls":"collapse-4",size:"sm"},on:{click:function(e){t.permission_collapse=!t.permission_collapse}}},[t._v("\n                Раскрыть права\n            ")])],1),t._v(" "),s("b-row",{staticClass:"my-1 mt-3"},[s("b-col",[s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-4"},model:{value:t.permission_collapse,callback:function(e){t.permission_collapse=e},expression:"permission_collapse"}},[s("div",{staticClass:"alert alert-success my-3 text-center"},[t._v("\n                        Не все права можно выставить, так как они предусматриваются наличием роли"),s("br"),t._v("\n                        У каждой роли есть набор прав"),s("br"),t._v("\n                        У каждого пользователя есть набор прав и ролей\n                    ")]),t._v(" "),s("div",{staticClass:"mb-1 col-lg-5"},[s("b-form-input",{attrs:{placeholder:"Поиск прав"},model:{value:t.searchPermissions,callback:function(e){t.searchPermissions=e},expression:"searchPermissions"}})],1),t._v(" "),s("b-card",[s("b-form-group",{attrs:{label:"Доступы:"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.ariaDescribedby;return[s("b-form-checkbox-group",{attrs:{"aria-describedby":a,name:"flavour-2"},model:{value:t.infoModalRole.permissions,callback:function(e){t.$set(t.infoModalRole,"permissions",e)},expression:"infoModalRole.permissions"}},[s("b-row",[s("div",{staticClass:"box"},t._l(t.allPermissions,(function(e,a){return s("div",[s("b-col",[s("b-form-checkbox",{key:a,attrs:{value:e.id}},[t._v("\n                                                    "+t._s(e.guard_name)+"\n                                                ")])],1)],1)})),0)])],1)]}}])})],1)],1),t._v(" "),s("div",{staticClass:"row mt-2 mx-2 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"success"},on:{click:t.saveRole}},[t._v("Сохранить")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"danger"},on:{click:t.hideModal}},[t._v("Закрыть")])],1)],1)],1)],1)],1)}),[],!1,null,"4deeba99",null).exports},5022:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>x});var a=s(7757),n=s.n(a),r=s(9938),i=s.n(r),o=(s(6532),s(6455)),l=s.n(o),c=s(3676),d=s(8534);function u(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function f(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function m(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?f(Object(s),!0).forEach((function(e){v(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function v(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const h={name:"AdminTerminalsIndex",props:["users","deleted","roles","points","all_permissions","current_user_permissions","options_company","fields","devicesOptions"],components:{DevicesInput:c.default,Swal2:l(),vSelect:i(),LogsModal:d.default},data:function(){return{allPermissions:[],enableModal:!1,permission_collapse:!1,searchPermissions:"",infoModalUser_roles:[],busy:!1,companies:[],stamps:[],currentPage:1,totalRows:0,perPage:100,sortBy:"",sortDesc:!1,infoModalUser:{id:null,name:null,login:null,email:null,password:null,eds:null,timezone:null,pv:null,blocked:0,company:null,permissions:[],serialNumber:null,dateCheck:null,devices:[]},optionsPvs:[],optionsRoles:[],columns:[],items:[],loading:!1,logsModalShow:!1}},methods:{logsRead:function(t){this.logsModalShow=!0,this.$refs.logsModal.loadData(t)},sortChanged:function(t){this.sortBy=t.sortBy,this.sortDesc=t.sortDesc,this.loadData()},loadConnectionStatus:function(){var t=this;if(0!==this.items.length){var e=this.items.map((function(t){return t.id}));axios.get("/terminals/status",{params:{terminals_id:e}}).then((function(e){e.data.forEach((function(e){t.items.forEach((function(t){t.id===e.id&&(t.connected=e.connected)}))})),t.$forceUpdate()}))}},tableRowClass:function(t,e){var s,a;return t&&"row"===e?null!=t&&null!==(s=t.need_check)&&void 0!==s&&s.in_a_month?"row-check-in-a-month":null!=t&&null!==(a=t.need_check)&&void 0!==a&&a.expired?"row-check-expired":"":null},fetchTerminalsToCheck:function(){var t,e=this;return(t=n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:axios.get("/terminals/to-check").then((function(t){e.items=e.items.map((function(e){return m(m({},e),{},{need_check:{in_a_month:t.data.less_month.includes(e.hash_id),expired:t.data.expired.includes(e.hash_id)}})}))}));case 1:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){_(r,a,n,i,o,"next",t)}function o(t){_(r,a,n,i,o,"throw",t)}i(void 0)}))})()},loadData:function(){var t=this;this.busy=!0,this.loading=!0,axios.get("/terminals"+window.location.search,{params:{sortBy:this.sortBy,sortDesc:this.sortDesc,page:this.currentPage,take:this.perPage,api:1}}).then((function(e){var s=e.data;t.items=s.items,t.currentPage=s.current_page,t.totalRows=s.total_rows,t.busy=!1,t.loadConnectionStatus(),t.fetchTerminalsToCheck()})).finally((function(){t.loading=!1}))},fetchRoleData:function(t){var e=this,s=t.map((function(t){return t.id})),a=[];if(this.infoModalUser.id&&(a=this.items.filter((function(t){return t.id==e.infoModalUser.id}))[0].roles.map((function(t){return t.id}))),JSON.stringify(s)!=JSON.stringify(a)){if(this.allPermissions=this.allPermissions.map((function(t){return t.disable=!1,t.checked=!1,t})),this.infoModalUser.permissions=[],0==s.length)return;axios.get("/users/fetchRoleData",{params:{role_ids:s}}).then((function(t){var s=t.data;e.allPermissions.map((function(t,a){s.includes(t.id)&&(e.allPermissions[a].disable=!0,e.infoModalUser.permissions.push(t.id))})),e.showModal()})).finally((function(){e.loading=!1}))}},deleteUser:function(t){var e=this;l().fire({title:"Вы уверены, что хотите удалить?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена"}).then((function(s){s.isConfirmed&&axios.post("/users",{id:t}).then((function(s){var a=s.data;a.status?(l().fire("Удалено","Данные были успешно удалены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):l().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))}))},returnTrash:function(t){var e=this;axios.post("/terminals/return_trash",{id:t}).then((function(s){var a=s.data;a.status?(l().fire("Восстановлено","Данные были успешно восстановлены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):l().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))},validateDevices:function(){return!!this.infoModalUser.devices.length&&!this.infoModalUser.devices.filter((function(t){return!t.serial_number})).length},saveUser:function(){var t=this;this.loading=!0;var e=this.infoModalUser.devices.map((function(t){return t.serial_number}));this.infoModalUser.name&&this.infoModalUser.timezone&&this.infoModalUser.pv_id&&this.infoModalUser.company_id&&this.infoModalUser.serialNumber&&this.infoModalUser.dateCheck&&this.validateDevices()?u(new Set(e)).length===e.length?axios.post("/terminals",{user_id:this.infoModalUser.id,name:this.infoModalUser.name,timezone:this.infoModalUser.timezone,pv:this.infoModalUser.pv_id,company_id:this.infoModalUser.company_id,blocked:this.infoModalUser.blocked,stamp_id:this.infoModalUser.stamp_id,serial_number:this.infoModalUser.serialNumber,date_check:this.infoModalUser.dateCheck,devices:this.infoModalUser.devices}).then((function(e){var s=e.data;s.status&&(t.items.forEach((function(e,a,n){e.id==s.user_info.id&&(t.items[a]=s.user_info)})),l().fire("Сохранено","Данные были успешно записаны","success"),t.$refs.users_table.refresh(),t.enableModal=!1,location.reload())})).catch((function(t){var e,s,a,n,r,i="Произошла ошибка. Попробуйте, пожалуйста, позже";null!=t&&null!==(e=t.response)&&void 0!==e&&null!==(s=e.data)&&void 0!==s&&null!==(a=s.errors)&&void 0!==a&&a.length?i=null==t||null===(n=t.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.errors.join("\n"):console.error(t);l().fire("Ошибка",i,"error")})).finally((function(){t.loading=!1})):this.$toast("Серийные номера комплектующих не должны совпадать",{type:"error"}):this.$toast("Не все поля указаны",{type:"error"})},editUserData:function(t){var e=m({},t);e.dateCheck=null,e.serialNumber=null,t.terminal_check&&(e.dateCheck=t.terminal_check.date_check,e.serialNumber=t.terminal_check.serial_number),e.devices=[],t.terminal_devices&&(e.devices=t.terminal_devices.map((function(t){return{id:t.device_name,serial_number:t.device_serial_number}}))),this.infoModalUser=e,this.showModal()},resetModal:function(){this.infoModalUser.id=null,this.infoModalUser.name=null,this.infoModalUser.login=null,this.infoModalUser.email=null,this.infoModalUser.password=null,this.infoModalUser.eds=null,this.infoModalUser.timezone=null,this.infoModalUser.pv=null,this.infoModalUser.pv_id=null,this.infoModalUser_roles=[],this.infoModalUser.blocked=0,this.infoModalUser.company=null,this.infoModalUser.permissions=[],this.infoModalUser.serialNumber=null,this.infoModalUser.dateCheck=null,this.infoModalUser.devices=[],this.permission_collapse=!1,this.allPermissions=this.allPermissions.map((function(t){return t.disable=!1,t}))},showModal:function(){this.enableModal=!0},hideModal:function(){this.enableModal=!1},searchCompany:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";axios.get("/api/companies/find",{params:{search:e}}).then((function(e){var s=e.data;s.forEach((function(t){t.name="[".concat(t.hash_id,"] ").concat(t.name)})),t.companies=s}))},searchStamp:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";axios.get("/stamp/find",{params:{search:e}}).then((function(e){var s=e.data;s.forEach((function(t){t.name="[".concat(t.id,"] ").concat(t.name)})),t.stamps=s}))},formatDate:function(t){var e=new Date(t);return"".concat(String(e.getDate()).padStart(2,"0"),".").concat(String(e.getMonth()+1).padStart(2,"0"),".").concat(e.getFullYear())},formatDevices:function(t){var e=this;return t.map((function(t){return{name:e.devicesOptions.filter((function(e){return e.id===t.device_name}))[0].text,serialNumber:t.device_serial_number}}))}},mounted:function(){var t=this;if(this.loadData(),this.searchCompany(),this.searchStamp(),this.optionsPvs=this.points,this.optionsRoles=this.roles.filter((function(t){return![3,9,6].includes(t.id)})),this.allPermissions=this.all_permissions,this.fields.forEach((function(e){t.columns.push({key:e.field,label:e.name,sortable:!0,thAttr:{"data-toggle":"tooltip","data-html":!0,"data-trigger":"hover","data-placement":"top",title:e.content}})})),this.columns.push({key:"buttons",label:"#",class:"text-right"}),this.deleted){var e;(e=this.columns).push.apply(e,[{key:"deleted_user.name",label:"Имя удалившего"},{key:"deleted_at",label:"Время удаления"}])}setInterval(this.loadConnectionStatus,5e3)},watch:{searchPermissions:function(t){""!==t?(t=t.toLowerCase(),this.allPermissions=this.all_permissions.filter((function(e){return e.guard_name.toLowerCase().match(t)}))):this.allPermissions=this.all_permissions},enableModal:function(t){t||this.resetModal()},infoModalUser_roles:function(){this.fetchRoleData(this.infoModalUser_roles)},currentPage:function(){this.loadData()}}};var b=s(3379),g=s.n(b),y=s(2951),C={insert:"head",singleton:!1};g()(y.Z,C);y.Z.locals;const x=(0,s(1900).Z)(h,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("div",{},[s("div",{staticClass:"my-3"},[t.current_user_permissions.permission_to_create?s("b-button",{attrs:{variant:"success",size:"sm"},on:{click:t.showModal}},[t._v("\n                Добавить терминал\n                "),s("i",{staticClass:"fa fa-plus"})]):t._e(),t._v(" "),t.current_user_permissions.permission_to_trash?s("b-button",{attrs:{variant:"warning",size:"sm",href:t.deleted?"/terminals":"?deleted=1"}},[t._v("\n                "+t._s(t.deleted?"Назад":"Корзина")+"\n                "),t.deleted?t._e():s("i",{staticClass:"fa fa-trash"})]):t._e()],1),t._v(" "),t._t("default"),t._v(" "),s("div",{staticClass:"card table-card"},[s("div",{staticClass:"card-body"},[t.current_user_permissions.permission_to_view?s("b-table",{ref:"users_table",attrs:{items:t.items,fields:t.columns,striped:"",hover:"","no-local-sorting":"",busy:t.loading,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"current-page":t.currentPage,"tbody-tr-class":t.tableRowClass},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},"sort-changed":t.sortChanged},scopedSlots:t._u([{key:"cell(name)",fn:function(e){return[t.current_user_permissions.permission_to_edit?[s("a",{attrs:{href:"#"},on:{click:function(s){return t.editUserData(e.item)}}},[t._v("\n                                "+t._s(e.value||"Неизвестно")+"\n                            ")])]:[t._v("\n                            "+t._s(e.value||"Неизвестно")+"\n                        ")]]}},{key:"cell(status)",fn:function(e){return[e.item.connected?s("span",{staticClass:"badge badge-success"},[t._v("on")]):s("span",{staticClass:"badge badge-danger"},[t._v("off")])]}},{key:"cell(pv)",fn:function(e){return[t._v("\n                         "+t._s(e.value.name)+"\n                    ")]}},{key:"cell(town)",fn:function(e){var s=e.item;return[t._v("\n                        "+t._s(s.pv&&s.pv.town?s.pv.town.name:"Неизвестно")+"\n                    ")]}},{key:"cell(company_id)",fn:function(e){var s=e.item;return[t._v("\n                        "+t._s(s.company?s.company.name:"Неизвестно")+"\n                    ")]}},{key:"cell(stamp_id)",fn:function(e){var s=e.item;return[t._v("\n                        "+t._s(s.stamp?s.stamp.name:"Неизвестно")+"\n                    ")]}},{key:"cell(serial_number)",fn:function(e){var s=e.item;return[t._v("\n                        "+t._s(s.terminal_check?s.terminal_check.serial_number:"")+"\n                    ")]}},{key:"cell(date_check)",fn:function(e){var s=e.item;return[t._v("\n                        "+t._s(s.terminal_check?t.formatDate(s.terminal_check.date_check):"")+"\n                    ")]}},{key:"cell(devices)",fn:function(e){var a=e.item;return[a.terminal_devices?s("div",t._l(t.formatDevices(a.terminal_devices),(function(e){return s("div",[t._v("\n                                "+t._s(e.name)+" ("+t._s(e.serialNumber)+")\n                            ")])})),0):t._e()]}},{key:"cell(blocked)",fn:function(e){return[t._v("\n                        "+t._s("1"===e.value?"Да":"Нет")+"\n                    ")]}},{key:"cell(buttons)",fn:function(e){return[s("div",{staticClass:"d-flex"},[t.current_user_permissions.permission_to_logs_read?s("b-button",{attrs:{size:"sm",variant:"primary",title:"Журнал действий"},on:{click:function(s){return t.logsRead(e.item.id)}}},[s("i",{staticClass:"fa fa-book"})]):t._e(),t._v(" "),t.deleted?t._e():s("b-button",{staticClass:"ml-1",attrs:{disabled:!t.current_user_permissions.permission_to_delete,variant:"danger",size:"sm"},on:{click:function(s){return t.deleteUser(e.item.id)}}},[s("i",{staticClass:"fa fa-trash"})]),t._v(" "),t.deleted?s("b-button",{staticClass:"ml-1",attrs:{disabled:!t.current_user_permissions.permission_to_trash,variant:"warning",size:"sm"},on:{click:function(s){return t.returnTrash(e.item.id)}}},[s("i",{staticClass:"fa fa-undo"})]):t._e()],1)]}}],null,!1,2568335428)}):t._e()],1)]),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("b-row",{staticClass:"w-100 d-flex justify-content-center"},[s("b-col",{staticClass:"my-1 d-flex justify-content-left"},[s("b-pagination",{staticClass:"my-0",attrs:{disabled:t.busy,"total-rows":t.totalRows,"per-page":t.perPage,align:"fill"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),s("b-row",{staticClass:"w-100 d-flex justify-content-center"},[s("b-col",{staticClass:"my-1 d-flex justify-content-left"},[s("p",{staticClass:"text-center"},[t._v("\n                            Количество элементов: "+t._s(t.totalRows)+"\n                        ")])])],1)],1)]),t._v(" "),s("b-modal",{ref:"users_modal",attrs:{size:"lg","hide-footer":"",title:"Добавление терминала"},model:{value:t.enableModal,callback:function(e){t.enableModal=e},expression:"enableModal"}},[s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        AnyDesk:\n                    ")]),t._v(" "),s("b-form-input",{attrs:{id:"input-small",size:"sm",placeholder:"Введите AnyDesk"},model:{value:t.infoModalUser.name,callback:function(e){t.$set(t.infoModalUser,"name",e)},expression:"infoModalUser.name"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Компании\n                    ")]),t._v(" "),s("multiselect",{staticClass:"is-invalid",attrs:{options:t.companies,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите компанию",label:"name"},on:{"search-change":t.searchCompany,select:function(e){return t.infoModalUser.company_id=e.id}},model:{value:t.infoModalUser.company,callback:function(e){t.$set(t.infoModalUser,"company",e)},expression:"infoModalUser.company"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",{staticClass:"mb-1",attrs:{for:"stamp"}},[t._v("\n                        Штамп\n                    ")]),t._v(" "),s("multiselect",{staticClass:"is-invalid",attrs:{options:t.stamps,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите штамп",label:"name"},on:{"search-change":t.searchStamp,select:function(e){return t.infoModalUser.stamp_id=e.id},remove:function(e){t.infoModalUser.stamp_id=null}},model:{value:t.infoModalUser.stamp,callback:function(e){t.$set(t.infoModalUser,"stamp",e)},expression:"infoModalUser.stamp"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Часовой пояс:\n                    ")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите часовой пояс"},model:{value:t.infoModalUser.timezone,callback:function(e){t.$set(t.infoModalUser,"timezone",e)},expression:"infoModalUser.timezone"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Пункт выпуска:\n                    ")]),t._v(" "),s("b-form-select",{attrs:{options:[{value:null,text:"Выберите пункт выпуска",disabled:!0}].concat(t.optionsPvs)},model:{value:t.infoModalUser.pv_id,callback:function(e){t.$set(t.infoModalUser,"pv_id",e)},expression:"infoModalUser.pv_id"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Дата поверки:\n                    ")]),t._v(" "),s("b-form-datepicker",{attrs:{size:"sm",placeholder:"Укажите дату поверки",locale:"ru"},model:{value:t.infoModalUser.dateCheck,callback:function(e){t.$set(t.infoModalUser,"dateCheck",e)},expression:"infoModalUser.dateCheck"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Серийный номер:\n                    ")]),t._v(" "),s("b-form-input",{attrs:{size:"sm",placeholder:"Введите серийный номер"},model:{value:t.infoModalUser.serialNumber,callback:function(e){t.$set(t.infoModalUser,"serialNumber",e)},expression:"infoModalUser.serialNumber"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("label",{staticClass:"mb-2"},[s("b",{staticClass:"text-danger text-bold"},[t._v("* ")]),t._v("\n                        Комплектующие:\n                    ")]),t._v(" "),s("devices-input",{attrs:{options:t.devicesOptions},model:{value:t.infoModalUser.devices,callback:function(e){t.$set(t.infoModalUser,"devices",e)},expression:"infoModalUser.devices"}})],1)],1),t._v(" "),s("b-row",{staticClass:"mb-3"},[s("b-col",{attrs:{lg:"12"}},[s("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"1","unchecked-value":"0"},model:{value:t.infoModalUser.blocked,callback:function(e){t.$set(t.infoModalUser,"blocked",e)},expression:"infoModalUser.blocked"}},[t._v("\n                        Заблокирован\n                    ")])],1)],1),t._v(" "),s("div",{staticClass:"row mt-2 mx-2 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:t.hideModal}},[t._v("Закрыть")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"success"},on:{click:t.saveUser}},[t._v("Сохранить")])],1)],1)],2),t._v(" "),s("b-modal",{attrs:{title:"Журнал действий",static:!0,size:"lg","hide-footer":""},model:{value:t.logsModalShow,callback:function(e){t.logsModalShow=e},expression:"logsModalShow"}},[s("logs-modal",{ref:"logsModal"})],1)],1)}),[],!1,null,null,null).exports},6852:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>m});var a=s(9938),n=s.n(a),r=(s(6532),s(6455)),i=s.n(r),o=s(5786),l=s(8534);const c={name:"AdminUsersIndex",props:["users","deleted","roles","points","all_permissions","current_user_permissions","options_company","fields"],components:{UserPvsList:o.default,Swal2:i(),vSelect:n(),LogsModal:l.default},data:function(){return{allPermissions:[],allPvs:[],enableModal:!1,permission_collapse:!1,searchPermissions:"",infoModalUser_roles:[],optionsCompany:[],busy:!1,currentPage:1,totalRows:0,perPage:15,sortBy:"",sortDesc:!1,infoModalUser:{id:null,name:null,login:null,email:null,password:null,eds:null,timezone:null,pv:null,pvs:[],blocked:0,company:null,permissions:[]},optionsPvs:[],optionsRoles:[],columns:[],items:[],loading:!1,logsModalShow:!1}},methods:{logsRead:function(t){this.logsModalShow=!0,this.$refs.logsModal.loadData(t)},handlePvsSelect:function(t){this.infoModalUser.pvs=t},fetchCompanies:function(t){var e=this,s={params:{query:t}};axios.get("/users/fetchCompanies",s).then((function(t){e.optionsCompany=t.data})).catch((function(t){console.error(t),Swal.fire({title:"Неизвестная ошибка",icon:"error"})}))},sortChanged:function(t){this.sortBy=t.sortBy,this.sortDesc=t.sortDesc,this.loadData()},loadData:function(){var t=this;this.busy=!0,this.loading=!0,axios.get("/users"+window.location.search,{params:{sortBy:this.sortBy,sortDesc:this.sortDesc,page:this.currentPage,take:this.perPage,api:1}}).then((function(e){var s=e.data;t.items=s.items,t.currentPage=s.current_page,t.totalRows=s.total_rows,t.busy=!1})).finally((function(){t.loading=!1}))},fetchRoleData:function(t){var e=this,s=t.map((function(t){return t.id})),a=[];if(this.infoModalUser.id&&(a=this.items.filter((function(t){return t.id==e.infoModalUser.id}))[0].roles.map((function(t){return t.id}))),JSON.stringify(s)!=JSON.stringify(a)){if(this.allPermissions=this.allPermissions.map((function(t){return t.disable=!1,t.checked=!1,t})),this.infoModalUser.permissions=[],0==s.length)return;axios.get("/users/fetchRoleData",{params:{role_ids:s}}).then((function(t){var s=t.data;e.allPermissions.map((function(t,a){s.includes(t.id)&&(e.allPermissions[a].disable=!0,e.infoModalUser.permissions.push(t.id))})),e.showModal()})).finally((function(){e.loading=!1}))}},deleteUser:function(t){var e=this;i().fire({title:"Вы уверены, что хотите удалить?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена"}).then((function(s){s.isConfirmed&&axios.post("/users",{id:t}).then((function(s){var a=s.data;a.status?(i().fire("Удалено","Данные были успешно удалены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):i().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))}))},returnTrash:function(t){var e=this;axios.post("/users/return_trash",{id:t}).then((function(s){var a=s.data;a.status?(i().fire("Восстановлено","Данные были успешно восстановлены","success"),e.items=e.items.filter((function(e){return e.id!=t}))):i().fire("Ошибка",a.message,"warning")})).finally((function(){e.loading=!1}))},saveUser:function(){var t,e=this;this.loading=!0,axios.get("/users/saveUser",{params:{user_id:this.infoModalUser.id,name:this.infoModalUser.name,login:this.infoModalUser.login,email:this.infoModalUser.email,eds:this.infoModalUser.eds,timezone:this.infoModalUser.timezone,password:this.infoModalUser.password,pv:this.infoModalUser.pv,pvs:this.infoModalUser.pvs,company:null===(t=this.infoModalUser.company)||void 0===t?void 0:t.id,roles:this.infoModalUser_roles.map((function(t){return t.id})),blocked:this.infoModalUser.blocked,validity_eds_start:this.infoModalUser.validity_eds_start,validity_eds_end:this.infoModalUser.validity_eds_end,permissions:this.infoModalUser.permissions.filter((function(t){var s;return!(null!==(s=e.allPermissions.filter((function(e){return e.id==t}))[0])&&void 0!==s&&s.disable)}))}}).then((function(t){var s=t.data;s.status&&(e.infoModalUser.id?e.items=e.items.map((function(t){return t.id==s.user_info.id?s.user_info:t})):e.items.push(s.user_info),i().fire("Сохранено","Данные были успешно записаны","success"),e.enableModal=!1)})).finally((function(){e.loading=!1}))},editUserData:function(t){this.fetchUserData(t)},fetchUserData:function(t){var e=this;this.loading=!0,axios.get("/users/fetchUserData",{params:{user_id:t}}).then((function(t){var s=t.data;e.infoModalUser.id=s.id,e.infoModalUser.name=s.name,e.infoModalUser.login=s.login,e.infoModalUser.email=s.email,e.infoModalUser.eds=s.eds,e.infoModalUser.timezone=s.timezone,e.infoModalUser.pv=s.pv.id,e.infoModalUser.pvs=s.pvs,e.infoModalUser_roles=s.roles,e.infoModalUser.blocked=s.blocked,e.infoModalUser.company=s.company.name,e.infoModalUser.validity_eds_start=s.validity_eds_start,e.infoModalUser.validity_eds_end=s.validity_eds_end,e.allPermissions.map((function(t,a){s.disable.includes(t.id)&&(e.allPermissions[a].disable=!0,e.infoModalUser.permissions.push(t.id))})),s.permission_user.map((function(t){e.infoModalUser.permissions.push(t)})),e.showModal()})).finally((function(){e.loading=!1}))},resetModal:function(){this.infoModalUser.id=null,this.infoModalUser.name=null,this.infoModalUser.login=null,this.infoModalUser.email=null,this.infoModalUser.password=null,this.infoModalUser.eds=null,this.infoModalUser.timezone=null,this.infoModalUser.pv=null,this.infoModalUser.pvs=[],this.infoModalUser_roles=[],this.infoModalUser.blocked=0,this.infoModalUser.company=null,this.infoModalUser.permissions=[],this.permission_collapse=!1,this.allPermissions=this.allPermissions.map((function(t){return t.disable=!1,t}))},showModal:function(){this.enableModal=!0},hideModal:function(){this.enableModal=!1}},mounted:function(){var t,e=this;if(this.fetchCompanies(),this.loadData(),this.optionsPvs=this.points,this.allPvs=(null!==(t=this.points)&&void 0!==t?t:[]).map((function(t){var e;return(null!==(e=t.options)&&void 0!==e?e:[]).map((function(e){return{id:e.value,name:"".concat(t.label," - ").concat(e.text)}}))})).flat(),this.optionsRoles=this.roles.filter((function(t){return![3,9,6].includes(t.id)})),this.allPermissions=this.all_permissions,this.fields.forEach((function(t){e.columns.push({key:t.field,label:t.name,sortable:!0,thAttr:{"data-toggle":"tooltip","data-html":!0,"data-trigger":"hover","data-placement":"top",title:t.content}})})),this.columns.push({key:"buttons",label:"#",class:"text-right"}),this.deleted){var s;(s=this.columns).push.apply(s,[{key:"deleted_user.name",label:"Имя удалившего"},{key:"deleted_at",label:"Время удаления"}])}},watch:{searchPermissions:function(t){""!==t?(t=t.toLowerCase(),this.allPermissions=this.all_permissions.filter((function(e){return e.guard_name.toLowerCase().match(t)}))):this.allPermissions=this.all_permissions},enableModal:function(t){t||this.resetModal()},infoModalUser_roles:function(){this.fetchRoleData(this.infoModalUser_roles)},currentPage:function(){this.loadData()}},computed:{isNotClient:function(){return void 0===this.infoModalUser_roles.filter((function(t){return"client"===t.name}))[0]},isHeadOperator:function(){return void 0!==this.infoModalUser_roles.filter((function(t){return"head_operator_sdpo"===t.name}))[0]}}};var d=s(3379),u=s.n(d),p=s(4095),f={insert:"head",singleton:!1};u()(p.Z,f);p.Z.locals;const m=(0,s(1900).Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("div",{},[s("div",{staticClass:"my-3"},[t.current_user_permissions.permission_to_create?s("b-button",{attrs:{variant:"success",size:"sm"},on:{click:t.showModal}},[t._v("\n                Добавить пользователя\n                "),s("i",{staticClass:"fa fa-plus"})]):t._e(),t._v(" "),t.current_user_permissions.permission_to_trash?s("b-button",{attrs:{variant:"warning",size:"sm",href:t.deleted?"/users":"?deleted=1"}},[t._v("\n                "+t._s(t.deleted?"Назад":"Корзина")+"\n                "),t.deleted?t._e():s("i",{staticClass:"fa fa-trash"})]):t._e()],1),t._v(" "),t._t("default"),t._v(" "),s("div",{staticClass:"card table-card"},[s("div",{staticClass:"card-body pt-0"},[t.current_user_permissions.permission_to_view?s("b-table",{ref:"users_table",attrs:{items:t.items,fields:t.columns,striped:"",hover:"","no-local-sorting":"",busy:t.loading,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},"sort-changed":t.sortChanged},scopedSlots:t._u([{key:"cell(name)",fn:function(e){return[t.current_user_permissions.permission_to_edit?[s("a",{attrs:{href:"#"},on:{click:function(s){return t.editUserData(e.item.id)}}},[t._v(t._s(e.value))])]:[t._v("\n                            "+t._s(e.value)+"\n                        ")]]}},{key:"cell(pv)",fn:function(e){return[t._v("\n                        "+t._s(e.value.name)+"\n                    ")]}},{key:"cell(photo)",fn:function(t){return[t.value?s("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"/storage/"+t.value,alt:""}}):s("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"/img/default_profile.jpg",alt:""}})]}},{key:"cell(company)",fn:function(e){return[t._v("\n                        "+t._s(e.value.name)+"\n                    ")]}},{key:"cell(blocked)",fn:function(e){return[t._v("\n                        "+t._s("1"==e.value?"Да":"Нет")+"\n                    ")]}},{key:"cell(roles)",fn:function(e){return[t._l(e.value,(function(e){return[s("h5",[s("span",{staticClass:"badge badge-success"},[t._v("\n                            "+t._s(e.guard_name)+"\n                        ")])])]}))]}},{key:"cell(buttons)",fn:function(e){return[s("div",{staticClass:"d-flex"},[t.current_user_permissions.permission_to_logs_read?s("b-button",{attrs:{size:"sm",variant:"primary",title:"Журнал действий"},on:{click:function(s){return t.logsRead(e.item.id)}}},[s("i",{staticClass:"fa fa-book"})]):t._e(),t._v(" "),t.deleted?t._e():s("b-button",{staticClass:"ml-1",attrs:{disabled:!t.current_user_permissions.permission_to_delete,variant:"danger",size:"sm"},on:{click:function(s){return t.deleteUser(e.item.id)}}},[s("i",{staticClass:"fa fa-trash"})]),t._v(" "),t.deleted?s("b-button",{staticClass:"ml-1",attrs:{disabled:!t.current_user_permissions.permission_to_trash,variant:"warning",size:"sm"},on:{click:function(s){return t.returnTrash(e.item.id)}}},[s("i",{staticClass:"fa fa-undo"})]):t._e()],1)]}}],null,!1,2613957055)}):t._e()],1)]),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("b-row",{staticClass:"w-100 d-flex justify-content-center"},[s("b-col",{staticClass:"my-1 d-flex justify-content-left"},[s("b-pagination",{staticClass:"my-0",attrs:{disabled:t.busy,"total-rows":t.totalRows,"per-page":t.perPage,align:"fill"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),s("b-row",{staticClass:"w-100 d-flex justify-content-center"},[s("b-col",{staticClass:"my-1 d-flex justify-content-left"},[s("p",{staticClass:"text-center"},[t._v("\n                            Количество элементов: "+t._s(t.totalRows)+"\n                        ")])])],1)],1)]),t._v(" "),s("b-modal",{ref:"users_modal",attrs:{size:"xl","hide-footer":"",title:"Добавление сотрудника"},model:{value:t.enableModal,callback:function(e){t.enableModal=e},expression:"enableModal"}},[s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("ФИО:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{id:"input-small",size:"sm",placeholder:"Введите ФИО"},model:{value:t.infoModalUser.name,callback:function(e){t.$set(t.infoModalUser,"name",e)},expression:"infoModalUser.name"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Login:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{size:"sm",placeholder:"Введите логин"},model:{value:t.infoModalUser.login,callback:function(e){t.$set(t.infoModalUser,"login",e)},expression:"infoModalUser.login"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("E-mail:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{size:"sm",placeholder:"Введите эл. почту"},model:{value:t.infoModalUser.email,callback:function(e){t.$set(t.infoModalUser,"email",e)},expression:"infoModalUser.email"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Пароль:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{size:"sm",type:"password",placeholder:"Введите пароль"},model:{value:t.infoModalUser.password,callback:function(e){t.$set(t.infoModalUser,"password",e)},expression:"infoModalUser.password"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("ЭЦП:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{size:"sm",placeholder:"Введите эл. подпись"},model:{value:t.infoModalUser.eds,callback:function(e){t.$set(t.infoModalUser,"eds",e)},expression:"infoModalUser.eds"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Срок действия ЭЦП:")])]),t._v(" "),s("b-col",{staticClass:"d-flex align-items-baseline",staticStyle:{gap:"5px"},attrs:{lg:"5"}},[t._v("\n                    с "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.infoModalUser.validity_eds_start,expression:"infoModalUser.validity_eds_start"}],staticClass:"form-control",attrs:{type:"date",name:"date"},domProps:{value:t.infoModalUser.validity_eds_start},on:{input:function(e){e.target.composing||t.$set(t.infoModalUser,"validity_eds_start",e.target.value)}}}),t._v("\n                    по\n                    "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.infoModalUser.validity_eds_end,expression:"infoModalUser.validity_eds_end"}],staticClass:"form-control",attrs:{type:"date",name:"date"},domProps:{value:t.infoModalUser.validity_eds_end},on:{input:function(e){e.target.composing||t.$set(t.infoModalUser,"validity_eds_end",e.target.value)}}})])],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Часовой пояс:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-input",{attrs:{size:"sm",placeholder:"Введите часовой пояс"},model:{value:t.infoModalUser.timezone,callback:function(e){t.$set(t.infoModalUser,"timezone",e)},expression:"infoModalUser.timezone"}})],1)],1),t._v(" "),t.isNotClient?s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Пункт выпуска:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("b-form-select",{attrs:{options:t.optionsPvs},model:{value:t.infoModalUser.pv,callback:function(e){t.$set(t.infoModalUser,"pv",e)},expression:"infoModalUser.pv"}})],1)],1):t._e(),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"2"}},[s("label",[t._v("Роль:")])]),t._v(" "),s("b-col",{attrs:{lg:"5"}},[s("v-select",{attrs:{multiple:!0,options:t.optionsRoles,label:"guard_name"},model:{value:t.infoModalUser_roles,callback:function(e){t.infoModalUser_roles=e},expression:"infoModalUser_roles"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{lg:"10","offset-lg":"2"}},[s("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"1","unchecked-value":"0"},model:{value:t.infoModalUser.blocked,callback:function(e){t.$set(t.infoModalUser,"blocked",e)},expression:"infoModalUser.blocked"}},[t._v("\n                        Заблокирован\n                    ")])],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",[s("b-button",{class:t.permission_collapse?null:"collapsed",attrs:{"aria-expanded":t.permission_collapse?"true":"false","aria-controls":"collapse-4",size:"sm"},on:{click:function(e){t.permission_collapse=!t.permission_collapse}}},[t._v("\n                        Раскрыть права\n                    ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-4"},model:{value:t.permission_collapse,callback:function(e){t.permission_collapse=e},expression:"permission_collapse"}},[s("div",{staticClass:"alert alert-success my-3 text-center"},[t._v("\n                            Не все права можно выставить, так как они предусматриваются наличием роли"),s("br"),t._v("\n                            У каждой роли есть набор прав"),s("br"),t._v("\n                            У каждого пользователя есть набор прав и ролей\n                        ")]),t._v(" "),s("div",{staticClass:"col-lg-5 mx-0 px-0 mb-3"},[s("b-form-input",{attrs:{placeholder:"Поиск прав"},model:{value:t.searchPermissions,callback:function(e){t.searchPermissions=e},expression:"searchPermissions"}})],1),t._v(" "),s("b-card",[s("b-form-group",{attrs:{label:"Доступы:"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.ariaDescribedby;return[s("b-form-checkbox-group",{attrs:{"aria-describedby":a,name:"flavour-2"},model:{value:t.infoModalUser.permissions,callback:function(e){t.$set(t.infoModalUser,"permissions",e)},expression:"infoModalUser.permissions"}},[s("b-row",[s("div",{staticClass:"box"},t._l(t.allPermissions,(function(e,a){return s("div",[s("b-col",[s("b-form-checkbox",{key:a,attrs:{value:e.id,disabled:e.disable}},[t._v("\n                                                        "+t._s(e.guard_name)+"\n                                                    ")])],1)],1)})),0)])],1)]}}])})],1)],1)],1)],1),t._v(" "),t.isHeadOperator?s("b-row",{staticClass:"my-1"},[s("user-pvs-list",{attrs:{"all-items":t.allPvs,"selected-items":t.infoModalUser.pvs},on:{input:t.handlePvsSelect}})],1):t._e(),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",[s("div",{staticClass:"row mt-2 mx-2 d-flex justify-content-end"},[s("b-button",{attrs:{variant:"danger"},on:{click:t.hideModal}},[t._v("Закрыть")]),t._v(" "),s("b-button",{staticClass:"ml-2",attrs:{variant:"success"},on:{click:t.saveUser}},[t._v("Сохранить")])],1)])],1)],1)],2),t._v(" "),s("b-modal",{attrs:{title:"Журнал действий",static:!0,size:"lg","hide-footer":""},model:{value:t.logsModalShow,callback:function(e){t.logsModalShow=e},expression:"logsModalShow"}},[s("logs-modal",{ref:"logsModal"})],1)],1)}),[],!1,null,null,null).exports},5786:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"UserPvsList",props:{allItems:{required:!0,type:Array},selectedItems:{required:!0,type:Array}},data:function(){return{searchedItems:[],search:"",collapsed:!1}},mounted:function(){this.searchedItems=this.allItems},watch:{search:function(t){(t=t.trim().toLowerCase()).length?this.searchedItems=this.allItems.filter((function(e){return e.name.toLowerCase().match(t)})):this.searchedItems=this.allItems}},methods:{handleSelectAllClick:function(){this.$emit("input",this.allItems.map((function(t){return t.id})))},handleUnselectAllClick:function(){this.$emit("input",[])}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-col",[s("b-button",{class:t.collapsed?null:"collapsed",attrs:{"aria-expanded":t.collapsed?"true":"false","aria-controls":"collapse-4",size:"sm"},on:{click:function(e){t.collapsed=!t.collapsed}}},[t._v("\n        Раскрыть пункты выпуска\n    ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-4"},model:{value:t.collapsed,callback:function(e){t.collapsed=e},expression:"collapsed"}},[s("b-card",[s("b-row",{staticClass:" mx-0 px-0 mb-3"},[s("div",{staticClass:"col-lg-6"},[s("b-form-input",{attrs:{placeholder:"Поиск ПВ"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("b-button",{attrs:{variant:"success",size:"sm"},on:{click:t.handleSelectAllClick}},[t._v("\n                        Выбрать все\n                    ")]),t._v(" "),s("b-button",{attrs:{size:"sm"},on:{click:t.handleUnselectAllClick}},[t._v("\n                        Убрать все\n                    ")])],1)]),t._v(" "),s("b-form-group",{attrs:{label:"Пункты выпуска:"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.ariaDescribedby;return[s("b-form-checkbox-group",{attrs:{"aria-describedby":a,name:"flavour-2"},on:{input:function(e){return t.$emit("input",t.selectedItems)}},model:{value:t.selectedItems,callback:function(e){t.selectedItems=e},expression:"selectedItems"}},[s("b-row",[s("div",{staticClass:"box"},t._l(t.searchedItems,(function(e,a){return s("div",[s("b-col",[s("b-form-checkbox",{key:a,attrs:{value:e.id}},[t._v("\n                                        "+t._s(e.name)+"\n                                    ")])],1)],1)})),0)])],1)]}}])})],1)],1)],1)}),[],!1,null,"29240b27",null).exports},3676:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"DevicesInput",props:{options:{type:Array,required:!0},value:{type:Array,required:!0}},emits:["input"],computed:{resultValues:function(){var t=this;return this.options.reduce((function(e,s){var a,n;return e[s.id]={checked:!!t.value.filter((function(t){return t.id===s.id})).length,serialNumber:null!==(a=null===(n=t.value.filter((function(t){return t.id===s.id}))[0])||void 0===n?void 0:n.serial_number)&&void 0!==a?a:""},e}),{})}},methods:{inputCheckbox:function(t){var e=[];this.value.filter((function(e){return e.id===t}))[0]?e=this.value.filter((function(e){return e.id!==t})):(e=this.value).push({id:t,serial_number:""}),this.$emit("input",e)},inputSerialNumber:function(t,e){var s=this.value.filter((function(e){return e.id===t}))[0];s&&(s.serial_number=e),this.$emit("input",this.value)}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"device-input-wrapper"},t._l(t.options,(function(e,a){return s("b-row",{key:a,staticClass:"mb-1"},[s("b-col",{attrs:{lg:"3"}},[s("b-checkbox",{attrs:{value:e.id,checked:t.resultValues[e.id].checked?e.id:null},on:{change:function(s){return t.inputCheckbox(e.id)}}},[t._v(t._s(e.text))])],1),t._v(" "),s("b-col",{attrs:{lg:"9"}},[s("b-form-input",{attrs:{value:t.resultValues[e.id].serialNumber,disabled:!t.resultValues[e.id].checked,placeholder:"Введите серийный номер"},on:{input:function(s){return t.inputSerialNumber(e.id,s)}}})],1)],1)})),1)}),[],!1,null,"22a4105b",null).exports},4876:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"uuid-cell",props:["uuid"],data:function(){return{}},computed:{id:function(){return(Math.random()+1).toString(36).substring(7)},shortUuid:function(){return this.uuid?this.uuid.substring(0,7):null}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("span",{attrs:{id:t.id}},[t._v("\n        "+t._s(t.shortUuid)+"\n    ")]),t._v(" "),s("b-tooltip",{attrs:{target:t.id,placement:"bottom"}},[t._v("\n        "+t._s(t.uuid)+"\n    ")])],1)}),[],!1,null,"2332e39e",null).exports},5925:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>p});var a=s(7757),n=s.n(a),r=s(9938),i=s.n(r),o=(s(6532),s(6455)),l=s.n(o);function c(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function d(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){c(r,a,n,i,o,"next",t)}function o(t){c(r,a,n,i,o,"throw",t)}i(void 0)}))}}const u={name:"contract-create",components:{vSelect:i()},props:["busy"],data:function(){return{show:!1,companies:[],our_companies:[],typeOptions:[],products:[],validationStates:{nameState:null,companyState:null,ourCompanyState:null,servicesState:null},contractData:{id:null,name:null,date_of_start:0,date_of_end:0,company:null,our_company:null,main_for_company:!1,finished:!1,services:[],drivers:[],cars:[],hard_reset_for_car_and_drivers:!1},oldData:null,driversCarsVisible:!1,driversVisible:!1,carsVisible:!1,cars_of_company:[],drivers_of_company:[],company_id:[],allDriversSelected:!1,allCarsSelected:!1}},watch:{company_id:function(t){null!=t&&t.id?this.contractData.company=t:this.contractData.company=null,this.loadDrivers(),this.loadCars(!0)},allDriversSelected:function(){if(this.contractData.drivers=[],this.allDriversSelected)for(var t in this.drivers_of_company)this.contractData.drivers.push(this.drivers_of_company[t].id)},allCarsSelected:function(){if(this.contractData.cars=[],this.allCarsSelected)for(var t in this.cars_of_company)this.contractData.cars.push(this.cars_of_company[t].id.toString())}},methods:{validationCheck:function(){var t=this.$refs.form.checkValidity();return this.validationStates.nameState=t,this.validationStates.companyState=t,this.validationStates.ourCompanyState=t,this.validationStates.servicesState=t,this.contractData.name?this.contractData.company?this.contractData.our_company?this.contractData.services?t:(this.validationStates.servicesState=!1,!1):(this.validationStates.ourCompanyState=!1,!1):(this.validationStates.companyState=!1,!1):(this.validationStates.nameState=!1,!1)},loadDrivers:function(){var t=this;this.drivers_of_company=[],this.contractData.company&&axios.post("/contract/getDriversByCompany/"+this.contractData.company.id).then((function(e){var s=e.data;return t.drivers_of_company=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")}))},loadCars:function(){var t=this;this.cars_of_company=[],this.contractData.company&&axios.post("/contract/getCarsByCompany/"+this.contractData.company.id).then((function(e){var s=e.data;return t.cars_of_company=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")}))},hideModal:function(){this.show=!1},open:function(){var t=arguments,e=this;return d(n().mark((function s(){var a,r;return n().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(a=t.length>0&&void 0!==t[0]?t[0]:null,r=t.length>1&&void 0!==t[1]&&t[1],e.companies.length){s.next=8;break}return axios.get("/v-search/companies").then((function(t){var s=t.data;return e.companies=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})),axios.get("/v-search/our_companies").then((function(t){var s=t.data;return e.our_companies=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})),axios.get("/contract/getTypes").then((function(t){var s=t.data;return e.typeOptions=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})),s.next=8,axios.get("/v-search/services").then((function(t){var s=t.data;return e.products=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")}));case 8:e.allDriversSelected=!1,e.allCarsSelected=!1,e.company_id={},e.show=!0,a?(e.contractData=Object.assign({},a),Number(e.contractData.main_for_company)&&(e.contractData.main_for_company=!0),Number(e.contractData.finished)&&(e.contractData.finished=!0),e.contractData.cars.length&&(e.contractData.cars=e.contractData.cars.map((function(t){return t.id}))),e.contractData.drivers.length&&(e.contractData.drivers=e.contractData.drivers.map((function(t){return t.id}))),e.company_id=e.contractData.company,r&&(e.contractData.id=null)):e.contractData={drivers:[],cars:[]},e.loadDrivers(),e.loadCars();case 15:case"end":return s.stop()}}),s)})))()},submitForm:function(t){var e=this;return d(n().mark((function s(){return n().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(e.validationCheck()){s.next=4;break}return t.preventDefault(),t.stopPropagation(),s.abrupt("return");case 4:if(!e.contractData.hard_reset_for_car_and_drivers){s.next=10;break}return s.next=7,l().fire({title:"Подтвердите действие",text:"Всем водителям и автомобилям компании будет присвоен данный договор",confirmButtonText:"Да",confirmButtonColor:"#3085d6",showCloseButton:!0}).then((function(t){return t}));case 7:if(s.sent.isConfirmed){s.next=10;break}return s.abrupt("return");case 10:t.target.disabled=!0,e.contractData.id?axios.post("/contract/update",{data_to_save:e.contractData}).then((function(t){t.data.status?(e.$emit("success"),e.$bvToast.toast("Договор обновлён",{title:"Редактирование договора",variant:"success",autoHideDelay:1500,appendToast:!0,noCloseButton:!0,solid:!0})):l().fire("Ошибка!","","warning")})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})).finally((function(){t.target.disabled=!1,e.show=!1})):axios.get("/contract/create",{params:{data_to_save:e.contractData}}).then((function(t){t.data.status?(e.$emit("success"),e.$bvToast.toast("Договор добавлен",{title:"Добавление договора",variant:"success",autoHideDelay:1500,appendToast:!0,noCloseButton:!0,solid:!0})):l().fire("Ошибка!","","warning")})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})).finally((function(){t.target.disabled=!1,e.show=!1}));case 12:case"end":return s.stop()}}),s)})))()},searchCompanies:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.companies=[],axios.get("/v-search/companies",{params:{query:e}}).then((function(e){var s=e.data;t.companies=s})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")}))},searchOurCompanies:function(t,e){var s=this;e(!0),this.companies=[],axios.get("/v-search/our_companies",{params:{query:t}}).then((function(t){var e=t.data;s.our_companies=e})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})).finally((function(){e(!1)}))},searchServices:function(t,e){var s=this;e(!0),this.products=[],axios.get("/v-search/services",{params:{query:t}}).then((function(t){var e=t.data;s.products=e})).catch((function(t){console.error(t),l().fire("Ошибка!","","warning")})).finally((function(){e(!1)}))}}};const p=(0,s(1900).Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{title:t.contractData.id?"Редактирование Договора":"Создание договора",size:"lg","hide-footer":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("b-form",{ref:"form",on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.submitForm(e)}}},[s("b-form-group",{staticClass:"required my-1",attrs:{label:"Название","label-class":"form-control-label","label-for":"contract_name",state:t.validationStates.nameState,"invalid-feedback":"Название договора - обязательное поле!"}},[s("b-form-input",{attrs:{state:t.validationStates.nameState,id:"contract_name",placeholder:"Введите название"},model:{value:t.contractData.name,callback:function(e){t.$set(t.contractData,"name",e)},expression:"contractData.name"}})],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{sm:"3"}},[s("label",[t._v("Дата начала:")])]),t._v(" "),s("b-col",{attrs:{sm:"9"}},[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_start-datepicker"},model:{value:t.contractData.date_of_start,callback:function(e){t.$set(t.contractData,"date_of_start",e)},expression:"contractData.date_of_start"}})],1)],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{sm:"3"}},[s("label",[t._v("Дата завершения:")])]),t._v(" "),s("b-col",{attrs:{sm:"9"}},[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_end-datepicker"},model:{value:t.contractData.date_of_end,callback:function(e){t.$set(t.contractData,"date_of_end",e)},expression:"contractData.date_of_end"}})],1)],1),t._v(" "),s("b-form-group",{staticClass:"required my-1",attrs:{label:"Компания","label-for":"company_select","label-class":"form-control-label",state:t.validationStates.companyState,"invalid-feedback":"Выберите компанию"}},[s("multiselect",{attrs:{required:"",state:t.validationStates.companyState,id:"company_select",options:t.companies,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите компанию",label:"name","track-by":"id"},on:{select:function(e){return t.contractData.company_id=e.hash_id},"search-change":t.searchCompanies},model:{value:t.company_id,callback:function(e){t.company_id=e},expression:"company_id"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("b-form-group",{staticClass:"required my-1",attrs:{"label-class":"form-control-label",label:"Наша компания","label-for":"our_company_select",state:t.validationStates.ourCompanyState,"invalid-feedback":"Выберите компанию"}},[s("v-select",{key:"id",attrs:{state:t.validationStates.ourCompanyState,id:"our_company_select",options:t.our_companies,label:"name"},on:{search:t.searchOurCompanies},model:{value:t.contractData.our_company,callback:function(e){t.$set(t.contractData,"our_company",e)},expression:"contractData.our_company"}})],1),t._v(" "),s("b-row",{staticClass:"my-1"},[s("b-col",{attrs:{sm:"3"}},[s("label",[t._v("Статус договора:")])]),t._v(" "),s("b-col",{attrs:{sm:"9"}},[s("b-form-checkbox",{model:{value:t.contractData.main_for_company,callback:function(e){t.$set(t.contractData,"main_for_company",e)},expression:"contractData.main_for_company"}},[t._v("\n                    Главный\n                ")]),t._v(" "),s("b-form-checkbox",{model:{value:t.contractData.finished,callback:function(e){t.$set(t.contractData,"finished",e)},expression:"contractData.finished"}},[t._v("\n                    Завершен\n                ")])],1)],1),t._v(" "),s("b-form-group",{staticClass:"required my-1",attrs:{"label-for":"services_select",label:"Услуги",state:t.validationStates.servicesState,"label-class":"form-control-label","invalid-feedback":"Выберите услуги"}},[s("v-select",{key:"id",attrs:{id:"services_select",state:t.validationStates.servicesState,options:t.products,label:"name",multiple:""},on:{search:t.searchServices},model:{value:t.contractData.services,callback:function(e){t.$set(t.contractData,"services",e)},expression:"contractData.services"}})],1),t._v(" "),t.contractData.services?s("b-row",{staticClass:"my-1"},[s("b-col",[s("b-table",{attrs:{items:t.contractData.services,fields:[{label:"Услуга",key:"name"},{label:"Цена",key:"service_cost"}]},scopedSlots:t._u([{key:"cell(service_cost)",fn:function(e){return[e.item.pivot?[s("b-form-input",{model:{value:e.item.pivot.service_cost,callback:function(s){t.$set(e.item.pivot,"service_cost",s)},expression:"row.item.pivot.service_cost"}})]:[s("b-form-input",{model:{value:e.item.price_unit,callback:function(s){t.$set(e.item,"price_unit",s)},expression:"row.item.price_unit"}})]]}}],null,!1,2026406837)})],1)],1):t._e(),t._v(" "),s("div",[s("b-button",{staticClass:"collapsed",attrs:{"aria-expanded":t.driversCarsVisible?"true":"false","aria-controls":"collapse-driversCarsVisible"},on:{click:function(e){t.driversCarsVisible=!t.driversCarsVisible}}},[t._v("\n                "+t._s(t.carsVisible?"Скрыть настройки водителей и машин":"Раскрыть настройки водителей и машин")+"\n            ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-driversCarsVisible"},model:{value:t.driversCarsVisible,callback:function(e){t.driversCarsVisible=e},expression:"driversCarsVisible"}},[s("b-card",[s("b-button",{staticClass:"collapsed",attrs:{"aria-expanded":t.driversVisible?"true":"false","aria-controls":"collapse-driversVisible"},on:{click:function(e){t.driversVisible=!t.driversVisible}}},[t._v("\n                        "+t._s(t.driversVisible?"Скрыть водителей":"Раскрыть водителей")+"\n                    ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-driversVisible"},model:{value:t.driversVisible,callback:function(e){t.driversVisible=e},expression:"driversVisible"}},[s("b-card",[t.drivers_of_company.length?s("b-row",{staticClass:"my-1"},[s("b-col",[s("b-form-checkbox",{model:{value:t.allDriversSelected,callback:function(e){t.allDriversSelected=e},expression:"allDriversSelected"}},[t._v("\n                                        Выбрать все\n                                    ")])],1)],1):t._e(),t._v(" "),s("b-form-group",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.ariaDescribedby;return[s("b-form-checkbox-group",{ref:"drivers_list_of_company",attrs:{"aria-describedby":a,name:"flavour-2"},model:{value:t.contractData.drivers,callback:function(e){t.$set(t.contractData,"drivers",e)},expression:"contractData.drivers"}},[s("b-row",[s("div",{staticClass:"box"},t._l(t.drivers_of_company,(function(e,a){return s("div",[s("b-col",[s("b-form-checkbox",{key:a,attrs:{value:e.id}},[t._v("\n                                                        "+t._s(e.fio)+"\n                                                    ")])],1)],1)})),0)])],1)]}}])})],1)],1),t._v(" "),s("b-button",{staticClass:"collapsed",attrs:{"aria-expanded":t.carsVisible?"true":"false","aria-controls":"collapse-carsVisible"},on:{click:function(e){t.carsVisible=!t.carsVisible}}},[t._v("\n                        "+t._s(t.carsVisible?"Скрыть машины":"Раскрыть машины")+"\n                    ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-carsVisible"},model:{value:t.carsVisible,callback:function(e){t.carsVisible=e},expression:"carsVisible"}},[s("b-card",[t.cars_of_company.length?s("b-row",{staticClass:"my-1"},[s("b-col",[s("b-form-checkbox",{model:{value:t.allCarsSelected,callback:function(e){t.allCarsSelected=e},expression:"allCarsSelected"}},[t._v("\n                                        Выбрать все\n                                    ")])],1)],1):t._e(),t._v(" "),s("b-form-group",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.ariaDescribedby;return[s("b-form-checkbox-group",{attrs:{"aria-describedby":a,name:"flavour-2"},model:{value:t.contractData.cars,callback:function(e){t.$set(t.contractData,"cars",e)},expression:"contractData.cars"}},[s("b-row",[s("div",{staticClass:"box"},t._l(t.cars_of_company,(function(e,a){return s("div",[s("b-col",[s("b-form-checkbox",{key:a,attrs:{value:e.id}},[t._v("\n                                                        "+t._s(e.gos_number)+"\n                                                    ")])],1)],1)})),0)])],1)]}}])})],1)],1)],1)],1)],1),t._v(" "),s("b-row",{staticClass:" my-2"},[s("b-col",{staticClass:"text-right"},[[s("b-button",{attrs:{variant:"success",type:"submit"}},[t._v("\n                        Отправить\n                    ")])],t._v(" "),s("b-button",{attrs:{variant:"danger"},on:{click:t.hideModal}},[t._v("Закрыть")])],2)],1)],1)],1)}),[],!1,null,"1d39be6c",null).exports},8365:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});var a=s(9938),n=s.n(a),r=(s(6532),s(6455)),i=s.n(r);const o={name:"contract-filters",props:["trash","permissions"],components:{vSelect:n(),Swal2:i()},data:function(){return{filters:{date_of_end_end:null,date_of_end_start:null,created_at_start:null,created_at_end:null,finished:null,our_company_id:null,main_for_company:null,company_id:null,id:null,name:null,service_id:null},services:[],companies:[],our_companies:[]}},mounted:function(){var t=this;axios.get("/v-search/companies").then((function(e){var s=e.data;return t.companies=s})).catch((function(){return i().fire("Ошибка!","","warning")})),axios.get("/v-search/our_companies").then((function(e){var s=e.data;return t.our_companies=s})).catch((function(){return i().fire("Ошибка!","","warning")})),axios.get("/v-search/services").then((function(e){var s=e.data;return t.services=s})).catch((function(){return i().fire("Ошибка!","","warning")}))},methods:{search:function(){this.$emit("change_filters",this.filters)},reset_filters:function(){this.filters={date_of_end_end:null,date_of_end_start:null,created_at_start:null,created_at_end:null,date_check_main:null,finished:null,our_company_id:null,main_for_company:null,company_id:null,id:null,name:null,service_id:null},this.$emit("change_filters",this.filters)},setFilters:function(t){for(var e in t)this.filters[e]=t[e]},searchCompanies:function(t,e){var s=this;e(!0),axios.get("/v-search/companies",{params:{query:t}}).then((function(t){t.data.map((function(t){s.filters.company_id===t.id||s.companies.filter((function(e){return e.id==t.id})).length||s.companies.push(t)})),e(!1)})).catch((function(t){console.error(t),i().fire("Ошибка!","","warning"),e(!1)}))},searchOurCompanies:function(t,e){var s=this;e(!0),axios.get("/v-search/our_companies",{params:{query:t}}).then((function(t){t.data.map((function(t){s.filters.our_company_id===t.id||s.our_companies.filter((function(e){return e.id==t.id})).length||s.our_companies.push(t)})),e(!1)})).catch((function(t){console.error(t),i().fire("Ошибка!","","warning"),e(!1)}))},searchServices:function(t,e){var s=this;e(!0),axios.get("/v-search/services",{params:{query:t}}).then((function(t){t.data.map((function(t){s.filters.service_id===t.id||s.services.filter((function(e){return e.id==t.id})).length||s.services.push(t)})),e(!1)})).catch((function(t){console.error(t),i().fire("Ошибка!","","warning"),e(!1)}))}}};const l=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"my-2"},[s("b-row",[s("b-col",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-button",{staticClass:"m-1",attrs:{variant:"success"},on:{click:function(e){return t.$emit("create_new")}}},[t._v("Создать")]),t._v(" "),t.permissions.trash&&t.permissions.read?s("b-button",{staticClass:"m-1",attrs:{variant:"warning"},on:{click:function(e){return t.$emit("view_trash_toggle")}}},[t._v("\n                "+t._s(t.trash?"Назад":"Корзина")+"\n                "),t.trash?t._e():s("i",{staticClass:"fa fa-trash"})]):t._e()],1)],1),t._v(" "),t.permissions.read?s("div",{staticClass:"card",staticStyle:{"overflow-x":"inherit"}},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"ID договора"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-input",{attrs:{placeholder:"Введите ID договора"},model:{value:t.filters.id,callback:function(e){t.$set(t.filters,"id",e)},expression:"filters.id"}})]}}],null,!1,2239216733)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Название"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-input",{attrs:{placeholder:"Введите название"},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,"name",e)},expression:"filters.name"}})]}}],null,!1,405263049)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Услуги"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("v-select",{key:"id",attrs:{options:t.services,label:"name",placeholder:"Выберите услуги",reduce:function(t){return t.id}},on:{search:t.searchServices},model:{value:t.filters.service_id,callback:function(e){t.$set(t.filters,"service_id",e)},expression:"filters.service_id"}})]}}],null,!1,2694280789)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Компания"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("v-select",{attrs:{options:t.companies,placeholder:"Выберите компанию",reduce:function(t){return t.id},label:"name"},on:{search:t.searchCompanies},model:{value:t.filters.company_id,callback:function(e){t.$set(t.filters,"company_id",e)},expression:"filters.company_id"}})]}}],null,!1,2793423214)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Выберите нашу компанию"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("v-select",{key:"id",attrs:{options:t.our_companies,label:"name",placeholder:"Выберите нашу компанию",reduce:function(t){return t.id}},on:{search:t.searchOurCompanies},model:{value:t.filters.our_company_id,callback:function(e){t.$set(t.filters,"our_company_id",e)},expression:"filters.our_company_id"}})]}}],null,!1,3612863244)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Главный"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-select",{attrs:{options:[{value:null,text:"----"},{value:0,text:"Нет"},{value:1,text:"Да"}]},model:{value:t.filters.main_for_company,callback:function(e){t.$set(t.filters,"main_for_company",e)},expression:"filters.main_for_company"}})]}}],null,!1,3466159354)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Завершен"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-select",{attrs:{options:[{value:null,text:"----"},{value:0,text:"Нет"},{value:1,text:"Да"}]},model:{value:t.filters.finished,callback:function(e){t.$set(t.filters,"finished",e)},expression:"filters.finished"}})]}}],null,!1,2211227967)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата окончания договора от"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_end_start",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.date_of_end_start,callback:function(e){t.$set(t.filters,"date_of_end_start",e)},expression:"filters.date_of_end_start"}})]}}],null,!1,4128763923)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата окончания договора до"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_end_end",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.date_of_end_end,callback:function(e){t.$set(t.filters,"date_of_end_end",e)},expression:"filters.date_of_end_end"}})]}}],null,!1,2017700691)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата создания от"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"created_at_start",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.created_at_start,callback:function(e){t.$set(t.filters,"created_at_start",e)},expression:"filters.created_at_start"}})]}}],null,!1,29901491)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата создания до"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"created_at_end",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.created_at_end,callback:function(e){t.$set(t.filters,"created_at_end",e)},expression:"filters.created_at_end"}})]}}],null,!1,4016159091)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата начала от"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_start",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.date_of_start,callback:function(e){t.$set(t.filters,"date_of_start",e)},expression:"filters.date_of_start"}})]}}],null,!1,3484238611)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Дата начала до"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_of_end",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.date_of_end,callback:function(e){t.$set(t.filters,"date_of_end",e)},expression:"filters.date_of_end"}})]}}],null,!1,1201943379)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-form-group",{staticClass:"w-100",attrs:{label:"Проверить главный договор"},scopedSlots:t._u([{key:"default",fn:function(e){e.ariaDescribedby;return[s("b-form-datepicker",{staticClass:"mb-2",attrs:{id:"date_check_main",placeholder:"Укажите дату","reset-button":"","close-button":"","label-reset-button":"Сбросить","label-close-button":"Закрыть"},model:{value:t.filters.date_check_main,callback:function(e){t.$set(t.filters,"date_check_main",e)},expression:"filters.date_check_main"}})]}}],null,!1,1349732115)})],1),t._v(" "),s("div",{staticClass:"d-flex align-items-center col-lg-3"},[s("b-button",{staticClass:"m-1",attrs:{variant:"info"},on:{click:t.search}},[t._v("\n                        Поиск\n                    ")]),t._v(" "),s("b-button",{staticClass:"m-1",attrs:{variant:"danger"},on:{click:t.reset_filters}},[t._v("\n                        Сброс фильтров\n                    ")])],1)])])]):t._e()],1)}),[],!1,null,"a8aebac0",null).exports},4227:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>u});var a=s(6455),n=s.n(a),r=s(5925),i=s(8365),o=s(4323),l=s(8534),c=s(992);const d={name:"contract-index",components:{Swal2:n(),ContractCreate:r.default,ContractFilters:i.default,ContractTable:o.default,LogsModal:l.default},props:["permissions","fields"],data:function(){return{logsModalShow:!1,busy:!1,user:null,table:{items:[],fields:[]},filters:{sortBy:"id",sortDesc:!0,currentPage:1,trash:0},total:0,perPage:20}},mounted:function(){var t=this;this.fields.forEach((function(e){t.table.fields.push({key:e.field,label:e.name,sortable:!0,thAttr:{"data-toggle":"tooltip","data-html":!0,"data-trigger":"hover","data-placement":"top",title:e.content}})})),this.table.fields.push({key:"buttons",label:"#",class:"text-center"});var e=(0,c.Q)();for(var s in e)isNaN(e[s])?this.filters[s]=e[s]:this.filters[s]=Number(e[s]);this.$refs.contractFilters.setFilters(this.filters),this.loadData()},methods:{logsRead:function(t){this.logsModalShow=!0,this.$refs.logsModal.loadData(t)},toggleTrash:function(){this.filters.trash=this.filters.trash?0:1,this.loadData()},selectPage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.filters.currentPage=t,this.loadData()},changeSort:function(t){this.filters.sortBy=t.sortBy,this.filters.sortDesc=t.sortDesc,this.loadData()},changeFilters:function(t){for(var e in t)this.filters[e]=t[e];this.loadData()},showCreateModal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$refs.contractCreate.open(t)},showCloneModal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$refs.contractCreate.open(t,!0)},loadData:function(){var t=this;this.busy=!0,(0,c.F)(this.filters);var e={params:Object.assign({},this.filters)};e.params.perPage=this.perPage,axios.get("/contract/index",e).then((function(e){var s=e.data;s.status?(t.table.items=s.result.contracts,t.total=s.result.total,t.filters.currentPage=s.result.currentPage):n().fire({title:"Неизвестная ошибка сервера",icon:"error"})})).catch((function(t){console.error(t),n().fire({title:"Неизвестная ошибка",icon:"error"})})).finally((function(){return t.busy=!1}))}}};const u=(0,s(1900).Z)(d,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("contract-filters",{ref:"contractFilters",attrs:{trash:t.filters.trash,permissions:t.permissions},on:{change_filters:t.changeFilters,create_new:t.showCreateModal,view_trash_toggle:t.toggleTrash}}),t._v(" "),s("div",{staticClass:"card"},[t.permissions.read?s("div",{staticClass:"card-body"},[s("contract-table",{ref:"contractTable",attrs:{table:t.table,busy:t.busy,trash:t.filters.trash,permissions:t.permissions},on:{logs_read:t.logsRead,change_sort:t.changeSort,update_data:t.showCreateModal,clone_data:t.showCloneModal,success:t.loadData}})],1):t._e()]),t._v(" "),s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[t.total>1?s("b-row",{staticClass:"w-100 d-flex justify-content-start"},[s("b-col",{staticClass:"my-1 d-flex justify-content-start"},[s("b-form-group",{staticClass:"mb-0",attrs:{"label-size":"sm"}},[s("b-pagination",{staticClass:"my-0",attrs:{id:"paginate_filters","total-rows":t.total,"per-page":t.perPage},on:{change:t.selectPage},model:{value:t.filters.currentPage,callback:function(e){t.$set(t.filters,"currentPage",e)},expression:"filters.currentPage"}})],1)],1)],1):t._e(),t._v(" "),s("b-row",[s("b-col",{staticClass:"my-1",attrs:{md:"2"}},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.perPage,expression:"perPage"}],on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.perPage=e.target.multiple?s:s[0]},t.loadData]}},[s("option",{attrs:{value:"20"}},[t._v("20")]),t._v(" "),s("option",{attrs:{value:"500"}},[t._v("500")]),t._v(" "),s("option",{attrs:{value:"1500"}},[t._v("1500")]),t._v(" "),s("option",{attrs:{value:"2000"}},[t._v("2000")]),t._v(" "),s("option",{attrs:{value:"2500"}},[t._v("2500")])])])],1),t._v(" "),s("p",{staticClass:"text-success"},[t._v("Найдено записей: "),s("b",[t._v(t._s(t.total))])])],1)]),t._v(" "),s("contract-create",{ref:"contractCreate",on:{success:t.loadData}}),t._v(" "),s("b-modal",{attrs:{title:"Журнал действий",static:!0,size:"lg","hide-footer":""},model:{value:t.logsModalShow,callback:function(e){t.logsModalShow=e},expression:"logsModalShow"}},[s("logs-modal",{ref:"logsModal"})],1)],1)}),[],!1,null,"0476ce9c",null).exports},4323:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d});var a=s(6455),n=s.n(a);const r={name:"contract-table",props:["table","change_sort","busy","trash","permissions"],methods:{changeSort:function(t){this.$emit("change_sort",t)},deleteItem:function(t,e){var s=this;e.disabled=!0,axios.post("/contract/"+t,{_method:"DELETE"}).then((function(t){t.data.status?s.$emit("success"):n().fire("Ошибка!","","warning")})).catch((function(t){console.error(t),n().fire("Ошибка!","","warning")})).finally((function(){e.disabled=!1}))},restoreItem:function(t,e){var s=this;e.disabled=!0,axios.post("/contract/restore/"+t,{_method:"PUT"}).then((function(t){t.data.status?s.$emit("success"):n().fire("Ошибка!","","warning")})).catch((function(t){console.error(t),n().fire("Ошибка!","","warning")})).finally((function(){e.disabled=!1}))}}};var i=s(3379),o=s.n(i),l=s(113),c={insert:"head",singleton:!1};o()(l.Z,c);l.Z.locals;const d=(0,s(1900).Z)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-table",{attrs:{items:t.table.items,fields:t.table.fields,busy:t.busy,striped:"",hover:"","no-local-sorting":"",responsive:"","label-sort-asc":"","label-sort-desc":"","label-sort-clear":""},on:{"sort-changed":t.changeSort},scopedSlots:t._u([{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center text-primary my-2"},[s("b-spinner",{staticClass:"align-middle"})],1)]},proxy:!0},{key:"cell(services)",fn:function(e){return t._l(e.value,(function(e){return s("h2",[s("span",{staticClass:"badge badge-success"},[t._v("\n                    "+t._s(e.name)+"\n                ")])])}))}},{key:"cell(company)",fn:function(e){return[s("a",{attrs:{href:"/elements/Company?filter=1&id="+e.value.id}},[t._v("\n            "+t._s(e.value.name)+"\n        ")])]}},{key:"cell(main_for_company)",fn:function(e){return[t._v("\n        "+t._s(Number(e.value)?"Да":"Нет")+"\n    ")]}},{key:"cell(finished)",fn:function(e){return[t._v("\n        "+t._s(Number(e.value)?"Да":"Нет")+"\n    ")]}},{key:"cell(date_of_start)",fn:function(e){return[t._v("\n        "+t._s(e.value?new Date(e.value).toLocaleDateString("ru-RU"):"")+"\n    ")]}},{key:"cell(date_of_end)",fn:function(e){return[t._v("\n        "+t._s(e.value?new Date(e.value).toLocaleDateString("ru-RU"):"")+"\n    ")]}},{key:"cell(created_at)",fn:function(e){return[t._v("\n        "+t._s(e.value?new Date(e.value).toLocaleDateString("ru-RU"):"")+"\n    ")]}},{key:"cell(buttons)",fn:function(e){return[s("div",{staticClass:"d-flex justify-content-center"},[t.trash?[s("b-button",{staticClass:"mr-2",staticStyle:{border:"none"},attrs:{size:"sm",variant:"outline-primary"},on:{click:function(s){return t.restoreItem(e.item.id,s.target)}}},[s("i",{staticClass:"fa fa-undo"})])]:[t.permissions.logs_read?s("b-button",{staticClass:"mr-2",staticStyle:{border:"none"},attrs:{size:"sm",variant:"outline-primary",title:"Журнал действий"},on:{click:function(s){return t.$emit("logs_read",e.item.id)}}},[s("b-icon-journal")],1):t._e(),t._v(" "),t.permissions.edit&&t.permissions.create?s("b-button",{staticClass:"mr-2",staticStyle:{border:"none"},attrs:{size:"sm",variant:"outline-primary",title:"Клонировать"},on:{click:function(s){return t.$emit("clone_data",e.item)}}},[s("b-icon-download")],1):t._e(),t._v(" "),t.permissions.edit?s("b-button",{staticClass:"mr-2",staticStyle:{border:"none"},attrs:{size:"sm",variant:"outline-primary",title:"Редактировать"},on:{click:function(s){return t.$emit("update_data",e.item)}}},[s("b-icon-pencil")],1):t._e(),t._v(" "),t.permissions.delete?s("b-button",{staticClass:"mr-2",staticStyle:{border:"none"},attrs:{size:"sm",variant:"outline-danger",title:"Удалить"},on:{click:function(s){return t.deleteItem(e.item.id,s.target)}}},[s("b-icon-trash-fill")],1):t._e()]],2)]}}])})}),[],!1,null,"e95af580",null).exports},3062:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>o});function a(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function n(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?a(Object(s),!0).forEach((function(e){r(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const i={name:"logs-filter",props:{filter:{type:Object,required:!0},usersOptions:{type:Array,required:!0},modelsOptions:{type:Array,required:!0},actionsOptions:{type:Array,required:!0}},emits:["update:filter","apply","reset"],methods:{handleFilterUpdate:function(t,e){var s=n(n({},this.filter),{},r({},t,e));this.$emit("update:filter",s)},handleApply:function(){this.$emit("apply")},handleReset:function(){this.$emit("reset")}}};const o=(0,s(1900).Z)(i,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Пользователи")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.users,options:t.usersOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("users",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Модели")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.models,options:t.modelsOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("models",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("ID модели")]),t._v(" "),s("b-form-input",{attrs:{value:t.filter.id,size:"sm",placeholder:"Введите значение"},on:{input:function(e){return t.handleFilterUpdate("id",e)}}})],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("UUID")]),t._v(" "),s("b-form-input",{attrs:{value:t.filter.uuid,size:"sm",placeholder:"Введите значение"},on:{input:function(e){return t.handleFilterUpdate("uuid",e)}}})],1)]),t._v(" "),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Действия")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.actions,options:t.actionsOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("actions",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Дата с")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.date_start},on:{input:function(e){return t.handleFilterUpdate("date_start",e)}}})],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Модели")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.date_end},on:{input:function(e){return t.handleFilterUpdate("date_end",e)}}})],1)]),t._v(" "),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"d-flex"},[s("b-button",{staticClass:"mr-2",attrs:{variant:"success",size:"sm"},on:{click:t.handleApply}},[t._v("\n                    Поиск\n                ")]),t._v(" "),s("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:t.handleReset}},[t._v("\n                    Сбросить\n                ")])],1)])])])}),[],!1,null,"26c977cb",null).exports},934:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>p});var a=s(7757),n=s.n(a),r=s(3062),i=s(9374),o=s(6455),l=s.n(o);function c(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function d(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){c(r,a,n,i,o,"next",t)}function o(t){c(r,a,n,i,o,"throw",t)}i(void 0)}))}}const u={name:"logs-index",components:{ModelSearcher:s(3250).default,LogsTable:i.default,LogsFilter:r.default},data:function(){return{pageSetup:window.PAGE_SETUP,filter:{users:[],models:[],id:null,uuid:null,actions:[],date_start:null,date_end:null},items:[],page:1,total:1,limit:100}},methods:{reload:function(){var t=this;return d(n().mark((function e(){var s,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.post(t.pageSetup.tableDataUrl,{limit:t.limit,page:t.page,filter:{id:t.filter.id?t.filter.id:null,uuid:t.filter.uuid?t.filter.uuid:null,date_start:t.filter.date_start?t.filter.date_start:null,date_end:t.filter.date_end?t.filter.date_end:null,users:t.filter.users.map((function(t){return t.id})),models:t.filter.models.map((function(t){return t.id})),actions:t.filter.actions.map((function(t){return t.id}))}});case 3:s=e.sent,a=s.data,t.total=a.total,t.items=a.data.map((function(e){var s;return e.data=(null!==(s=e.data)&&void 0!==s?s:[]).map((function(s){var a,n;return s.name=null!==(a=null===(n=t.pageSetup.fieldPromptsMap[e.model_type])||void 0===n?void 0:n[s.name])&&void 0!==a?a:s.name,s})),e.type=t.pageSetup.actionsMap[e.type],e.model_type=t.pageSetup.modelsMap[e.model_type],e})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0.message),l().fire({title:"Ошибка",text:"Ошибка при загрузке данных",icon:"error"});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},handleApply:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resetPageOrReload();case 2:case"end":return e.stop()}}),e)})))()},handleReset:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.filter={users:[],models:[],id:null,uuid:null,actions:[],date_start:null,date_end:null},e.next=3,t.resetPageOrReload();case 3:case"end":return e.stop()}}),e)})))()},resetPageOrReload:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.page){e.next=5;break}return e.next=3,t.reload();case 3:e.next=6;break;case 5:t.page=1;case 6:case"end":return e.stop()}}),e)})))()}},mounted:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)})))()},watch:{page:function(){this.reload()},limit:function(){this.resetPageOrReload()}}};const p=(0,s(1900).Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("logs-filter",{staticStyle:{"margin-bottom":"25px"},attrs:{filter:t.filter,"users-options":t.pageSetup.usersOption,"models-options":t.pageSetup.modelsOption,"actions-options":t.pageSetup.actionsOption},on:{"update:filter":function(e){t.filter=e},apply:t.handleApply,reset:t.handleReset}}),t._v(" "),s("hr"),t._v(" "),s("logs-table",{staticStyle:{"margin-top":"25px"},attrs:{items:t.items,page:t.page,limit:t.limit,total:t.total},on:{"update:page":function(e){t.page=e},"update:limit":function(e){t.limit=e}}})],1)])]),t._v(" "),s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("model-searcher")],1)])])])}),[],!1,null,"a2040290",null).exports},1268:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});const a={name:"logs-modal-table",components:{UuidCell:s(4876).default},props:{items:{type:Array,required:!0}},data:function(){return{fields:[{key:"uuid",label:"UUID",class:"text-left"},{key:"user",label:"Пользователь",class:"text-left"},{key:"created_at",label:"Дата, время",class:"text-left"},{key:"type",label:"Действие",class:"text-left"},{key:"data",label:"Изменения",class:"text-left"}]}}};var n=s(3379),r=s.n(n),i=s(9868),o={insert:"head",singleton:!1};r()(i.Z,o);i.Z.locals;const l=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("b-table",{attrs:{fields:t.fields,items:t.items,"head-variant":"light",striped:"",responsive:"",bordered:""},scopedSlots:t._u([{key:"cell(uuid)",fn:function(t){var e=t.item;return[s("uuid-cell",{attrs:{uuid:e.uuid}})]}},{key:"cell(data)",fn:function(e){var a=e.item;return t._l(a.data,(function(e,a){return s("div",{key:a,staticClass:"p-1 mb-1",staticStyle:{"line-height":"19px"}},[s("div",[s("b",[t._v(t._s(e.name))])]),t._v(" "),s("span",{staticStyle:{height:"18px"}},[t._v(t._s(e.oldValue))]),t._v(" "),s("span",{staticClass:"text-primary"},[t._v("⟶")]),t._v(" "),s("span",[t._v(" "+t._s(e.newValue))])])}))}}])})],1)}),[],!1,null,"d6be2794",null).exports},8534:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>u});var a=s(7757),n=s.n(a),r=s(1268),i=s(3250),o=s(6455),l=s.n(o);function c(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const d={name:"logs-modal",components:{ModelSearcher:i.default,LogsModalTable:r.default},data:function(){return{pageSetup:window.PAGE_SETUP.LOGS_MODAL,maps:null,items:[]}},methods:{loadData:function(t){var e,s=this;return(e=n().mark((function e(){var a,r,i,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s.items=[],null!==s.maps){e.next=8;break}return e.next=5,axios.post(s.pageSetup.mapDataUrl,{model:s.pageSetup.model});case 5:a=e.sent,r=a.data,s.maps=r;case 8:return e.next=10,axios.post(s.pageSetup.tableDataUrl,{id:t,model:s.pageSetup.model});case 10:i=e.sent,o=i.data,s.items=o.map((function(t){var e;return t.data=(null!==(e=t.data)&&void 0!==e?e:[]).map((function(t){var e;return t.name=null!==(e=s.maps.fieldPrompts[t.name])&&void 0!==e?e:t.name,t})),t.type=s.maps.actionTypes[t.type],t})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),l().fire({title:"Ошибка",text:"Ошибка при загрузке данных",icon:"error"});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})),function(){var t=this,s=arguments;return new Promise((function(a,n){var r=e.apply(t,s);function i(t){c(r,a,n,i,o,"next",t)}function o(t){c(r,a,n,i,o,"throw",t)}i(void 0)}))})()}},mounted:function(){var t=this;document.addEventListener("loadLogsModalData",(function(e){t.$refs.modelSearcher.reset(),t.loadData(e.detail.modelId)}))},computed:{searchAvailable:function(){return this.items.length>0}}};const u=(0,s(1900).Z)(d,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-md-12 mt-2"},[s("logs-modal-table",{attrs:{items:t.items}}),t._v(" "),s("model-searcher",{directives:[{name:"show",rawName:"v-show",value:t.searchAvailable,expression:"searchAvailable"}],ref:"modelSearcher"})],1)}),[],!1,null,"0dc06af3",null).exports},9374:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});const a={name:"logs-table",components:{UuidCell:s(4876).default},props:{items:{type:Array,required:!0},total:{type:Number,required:!0},page:{type:Number,required:!0},limit:{type:Number,required:!0}},emits:["update:page","update:limit"],data:function(){return{fields:[{key:"uuid",label:"UUID",class:"text-left"},{key:"user",label:"Пользователь",class:"text-left"},{key:"created_at",label:"Дата, время",class:"text-left"},{key:"type",label:"Действие",class:"text-left"},{key:"model_type",label:"Модель",class:"text-left"},{key:"model_id",label:"ID Модели",class:"text-center"},{key:"data",label:"Изменения",class:"text-left"}]}},methods:{handleChangePage:function(t){this.$emit("update:page",t)},handleChangeLimit:function(t){this.$emit("update:limit",+t.target.value)}}};var n=s(3379),r=s.n(n),i=s(9275),o={insert:"head",singleton:!1};r()(i.Z,o);i.Z.locals;const l=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"d-flex align-items-center mb-4"},[s("span",[t._v("Показывать")]),t._v(" "),s("select",{staticClass:"ml-2 mr-2",domProps:{value:t.limit},on:{input:t.handleChangeLimit}},[s("option",{attrs:{value:"100"}},[t._v("100")]),t._v(" "),s("option",{attrs:{value:"500"}},[t._v("500")]),t._v(" "),s("option",{attrs:{value:"1000"}},[t._v("1000")]),t._v(" "),s("option",{attrs:{value:"1500"}},[t._v("1500")]),t._v(" "),s("option",{attrs:{value:"2000"}},[t._v("2000")])]),t._v(" "),s("span",[t._v("записей")])]),t._v(" "),s("b-table",{attrs:{fields:t.fields,items:t.items,"head-variant":"light",striped:"",responsive:"",bordered:""},scopedSlots:t._u([{key:"cell(uuid)",fn:function(t){var e=t.item;return[s("uuid-cell",{attrs:{uuid:e.uuid}})]}},{key:"cell(data)",fn:function(e){var a=e.item;return t._l(a.data,(function(e,a){return s("div",{key:a,staticClass:"p-1 mb-1",staticStyle:{"line-height":"19px"}},[s("div",[s("b",[t._v(t._s(e.name))])]),t._v(" "),s("span",{staticStyle:{height:"18px"}},[t._v(t._s(e.oldValue))]),t._v(" "),s("span",{staticClass:"text-primary"},[t._v("⟶")]),t._v(" "),s("span",[t._v(" "+t._s(e.newValue))])])}))}}])}),t._v(" "),s("b-pagination",{attrs:{value:t.page,"total-rows":t.total,"per-page":t.limit},on:{input:t.handleChangePage}})],1)}),[],!1,null,"3d9ea51a",null).exports},7287:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>_});var a=s(7757),n=s.n(a),r=s(6455),i=s.n(r),o=s(9669),l=s.n(o);function c(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function d(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){c(r,a,n,i,o,"next",t)}function o(t){c(r,a,n,i,o,"throw",t)}i(void 0)}))}}const u={props:["fields","time","reloadInterval"],data:function(){return{order:{by:!0,key:"id"},rows:[]}},created:function(){var t=this;return d(n().mark((function e(){var s,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadData();case 2:s=new Audio("/sounds/notice.mp3"),a=function e(){return new Promise(function(){var a=d(n().mark((function a(r,i){var o,l,c;return n().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=t.rows.map((function(t){return t.id})),a.next=3,t.loadData();case 3:a.t0=n().keys(t.rows);case 4:if((a.t1=a.t0()).done){a.next=12;break}if(l=a.t1.value,c=t.rows[l],o.includes(c.id)){a.next=10;break}return s.play(),a.abrupt("break",12);case 10:a.next=4;break;case 12:setTimeout((function(){e().then(r).catch(i)}),t.reloadInterval);case 13:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())},a(),t.time=new Date(t.time).getTime(),setInterval((function(){t.time+=1e3,t.rows.forEach((function(e){t.setTimer(e)})),t.$forceUpdate()}),1e3);case 7:case"end":return e.stop()}}),e)})))()},methods:{loadData:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l().get("/pak/list",{params:{order_by:t.order.by?"ASC":"DESC",order_key:t.order.key}}).then((function(e){var s=e.data;return s.forEach((function(e){t.setTimer(e)})),s}));case 2:t.rows=e.sent;case 3:case"end":return e.stop()}}),e)})))()},setTimer:function(t){var e=new Date(t.created_at),s=Math.floor((this.time-e.getTime())/1e3),a=0,n=0;s>60&&(s-=60*(a=Math.floor(s/60))),a>60&&(a-=60*(n=Math.floor(a/60))),t.timer=n<10?"0"+n:n,t.timer+=":"+(a<10?"0"+a:a),t.timer+=":"+(s<10?"0"+s:s)},notAdmittedField:function(t,e){var s;return(null!==(s=t.not_admitted_reasons)&&void 0!==s?s:[]).includes(e)?{backgroundColor:"pink"}:{}},approveAdmitting:function(t){var e=this;0!==t.not_admitted_reasons.length?i().fire({title:"Отклонение от параметров!",text:"Обратите внимание, у водителя имеются отклонения от установленных предельных параметров. Подтвердите действие.",icon:"error",showCancelButton:!0,confirmButtonColor:"#28a745",confirmButtonText:"Допустить водителя",cancelButtonText:"Отмена"}).then((function(s){s.isConfirmed&&e.admit(t.id)})):this.admit(t.id)},admit:function(t){var e=this,s="/anketa/change-pak-queue/".concat(t,"/Допущен");l().get(s).then((function(s){e.rows=e.rows.filter((function(e){return e.id!==t}))})).catch((function(t){console.error(t),i().fire("Ошибка принятия осмотра!",t.response.data.message,"error")}))}}};var p=s(3379),f=s.n(p),m=s(5524),v={insert:"head",singleton:!1};f()(m.Z,v);m.Z.locals;const _=(0,s(1900).Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",{staticClass:"ankets-table table table-striped table-sm",attrs:{id:"ankets-table"}},[s("thead",[s("tr",[s("th",{staticClass:"not-export"},[t._v("\n            Таймер\n        ")]),t._v(" "),t._l(t.fields,(function(e){return s("th",{key:e.id,attrs:{"data-field-key":e.field}},[s("span",{staticClass:"user-select-none",attrs:{"data-toggle":{tooltip:e.content},"data-html":!0,"data-trigger":"click hover",title:e.content}},[t._v("\n                        "+t._s(e.name)+"\n                    ")]),t._v(" "),s("a",{staticClass:"not-export",attrs:{href:"javascript:void(0);"},on:{click:function(s){t.order.key=e.field,t.order.by=!t.order.by}}},[s("i",{staticClass:"fa fa-sort"})])])})),t._v(" "),s("th",{staticClass:"not-export"},[t._v("#")])],2)]),t._v(" "),s("tbody",t._l(t.rows,(function(e){return s("tr",{key:e.id,attrs:{"data-field":e.id}},[s("td",[s("div",{staticClass:"text-danger"},[t._v("\n                "+t._s(e.timer)+"\n            ")])]),t._v(" "),t._l(t.fields,(function(a){return s("td",{key:a.id,style:t.notAdmittedField(e,a.field)},["photos"===a.field&&e[a.field]?s("a",{attrs:{href:e[a.field]}},[s("i",{staticClass:"fa fa-camera"})]):"videos"===a.field&&e[a.field]?s("a",{attrs:{href:e[a.field]}},[s("i",{staticClass:"fa fa-video-camera"})]):"driver_fio"===a.field?s("a",{attrs:{href:"/elements/Driver?filter=1&fio="+e[a.field]}},[t._v("\n                "+t._s(e[a.field])+"\n            ")]):s("span",[t._v(t._s(e[a.field]))])])})),t._v(" "),s("td",{staticClass:"td-option not-export d-flex"},[s("a",{staticClass:"btn btn-info btn-sm mr-1",attrs:{href:"/anketa/"+e.id}},[s("i",{staticClass:"fa fa-search"})]),t._v(" "),s("a",{staticClass:"btn btn-sm btn-success mr-1",attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.approveAdmitting(e)}}},[s("i",{staticClass:"fa fa-check"})]),t._v(" "),s("a",{staticClass:"btn btn-sm btn-secondary mr-1",attrs:{href:"/anketa/change-pak-queue/"+e.id+"/Не идентифицирован"}},[s("i",{staticClass:"fa fa-question"})]),t._v(" "),s("a",{staticClass:"btn btn-sm btn-danger",attrs:{href:"/anketa/change-pak-queue/"+e.id+"/Не допущен"}},[s("i",{staticClass:"fa fa-close"})])])],2)})),0)])}),[],!1,null,null,null).exports},938:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ReportDynamicIndex",props:["towns","points","selTowns","selPoints","type","order","companies","selCompanies"],data:function(){return{journal:"medic",pointList:[],orderBy:"execute",selectedTowns:[],selectedPoints:[],selectedCompanies:[],selectedPoint:0}},mounted:function(){var t=this;this.selectedTowns=this.selTowns||[],this.selectedPoints=this.selPoints||[],this.selectedCompanies=this.selCompanies||[],this.pointList=this.points.filter((function(e){return t.selectedTowns.includes(""+e.pv_id)})),this.journal=this.type,this.orderBy=this.order,$(this.$refs.towns).on("change",this.selectTown)},methods:{selectTown:function(t){var e=$(t.currentTarget).val();this.pointList=this.points.filter((function(t){return e.includes(""+t.pv_id)}))}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"card mb-4",staticStyle:{"overflow-x":"inherit"}},[s("h5",{staticClass:"card-header d-flex justify-content-between align-items-center"},[t._v("\n      Выбор информации\n      "),s("div",{staticClass:"d-flex align-items-center"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.journal,expression:"journal"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.journal=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"tech"}},[t._v("Техосмотры")]),t._v(" "),s("option",{attrs:{value:"medic"}},[t._v("Медосмотры")]),t._v(" "),s("option",{attrs:{value:"all"}},[t._v("Все")])])])]),t._v(" "),s("div",{staticClass:"card-body"},[s("form",{attrs:{action:"/report/dynamic/"+t.journal,method:"GET",onsubmit:"document.querySelector('#page-preloader').classList.remove('hide')"}},[s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"company_id"}},[t._v("Компания")]),t._v(" "),s("select",{staticClass:"filled-select2 filled-select select2-hidden-accessible",attrs:{model:"Company","field-key":"hash_id",field:"name","field-concat":"hash_id","field-trashed":"true",multiple:"true",name:"company_id[]","data-label":"company_id","data-field":"medic_company_id","data-allow-clear":"true","data-select2-id":"1",tabindex:"-1","aria-hidden":"true"}},[s("option",{attrs:{value:""}},[t._v("Не установлено")]),t._v(" "),t._l(t.companies,(function(e){return s("option",{key:e.hash_id,domProps:{value:e.hash_id,selected:t.selectedCompanies.includes(""+e.hash_id)}},[t._v("\n                    ["+t._s(e.hash_id)+"] "+t._s(e.name)+"\n                ")])}))],2)]),t._v(" "),s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"town_id"}},[t._v("Город")]),t._v(" "),s("select",{ref:"towns",staticClass:"filled-select2 filled-select",attrs:{name:"town_id[]",id:"town_selector","data-allow-clear":"true",multiple:""}},[s("option",{attrs:{value:""}},[t._v("Не установлено")]),t._v(" "),t._l(t.towns,(function(e){return s("option",{key:e.id,domProps:{value:e.id,selected:t.selectedTowns.includes(""+e.id)}},[t._v("\n                ["+t._s(e.hash_id)+"] "+t._s(e.name)+"\n              ")])}))],2)]),t._v(" "),s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"pv_id"}},[t._v("Пункт выпуска")]),t._v(" "),s("select",{ref:"points",staticClass:"filled-select2 filled-select",attrs:{name:"pv_id[]",id:"point_selector","data-allow-clear":"true",multiple:""}},[s("option",{attrs:{value:""}},[t._v("Не установлено")]),t._v(" "),t._l(t.pointList,(function(e){return s("option",{key:e.id,domProps:{value:e.id,selected:t.selectedPoints.includes(""+e.id)}},[t._v("\n                  ["+t._s(e.hash_id)+"] "+t._s(e.name)+"\n              ")])}))],2)]),t._v(" "),s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[t._v("Построение")]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.orderBy,expression:"orderBy"}],ref:"order",staticClass:"filled-select2 filled-select",attrs:{id:"order_by",name:"order_by","data-allow-clear":"false"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.orderBy=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"execute"}},[t._v("По дате осмотра")]),t._v(" "),s("option",{attrs:{value:"created"}},[t._v("По дате создания")])])])]),t._v(" "),t._m(0)])])]),t._v(" "),t._t("default")],2)}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row",attrs:{id:"make-report-block"}},[s("div",{staticClass:"form-group col-lg-12"},[s("button",{staticClass:"btn btn-info"},[t._v("\n              Сформировать отчет\n            ")])])])}],!1,null,"c6488cd8",null).exports},4025:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>_});var a=s(7757),n=s.n(a),r=s(2985),i=s(8727),o=s(8609),l=s(1677),c=s(2566),d=s(6455),u=s.n(d),p=s(9938),f=s.n(p);function m(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const v={name:"ReportJournalContract",props:["default_company","client_company","permissions"],components:{ReportJournalMedic:r.default,ReportJournalTech:i.default,ReportJournalTechOther:o.default,ReportJournalMedicOther:l.default,vSelect:f(),ReportJournalOther:c.default},data:function(){return{loading:!1,loadingExport:!1,company:null,client:!1,companies:[],month:null,company_id:0,contracts:[],contracts_options:[],counter:5}},mounted:function(){this.searchCompany();var t=new Date,e=t.getMonth()>9?t.getMonth():"0"+t.getMonth();this.month=t.getFullYear()+"-"+e,this.client_company?(this.companies.push(this.client_company),this.company=this.client_company,this.company_id=this.client_company.hash_id,this.client=!0):this.default_company&&(this.companies.push(this.default_company),this.company=this.default_company,this.company_id=this.default_company.hash_id,this.report())},methods:{getTotalContractSum:function(t){var e=0;for(var s in t)if("techs"!=s&&"medics"!=s)if("medics_other"!=s&&"techs_other"!=s){if("other"==s)for(var a in t[s])if("company"!=a)for(var n in t[s][a])e+=t[s][a][n].sum;else for(var r in t[s][a])e+=t[s][a][r]}else for(var i in t[s])for(var o in t[s][i].reports)for(var l in t[s][o])t[s][o].types[l].sum&&(e+=t[s][o].types[l].sum);else for(var c in t[s])for(var d in t[s][c].types)t[s][c].types[d].sum&&(e+=t[s][c].types[d].sum);return e},searchServices:function(){var t=this;this.loading=!0,this.contracts=[],this.contracts_options=[],axios.get("/api/reports/getContractsForCompany",{params:{id:this.company_id}}).then((function(e){var s=e.data;t.contracts=s,t.contracts_options=s})).finally((function(){t.loading=!1}))},reset:function(){this.$refs.reportsMedic.hide(),this.$refs.reportsTech.hide(),this.$refs.reportsTechOther.hide(),this.$refs.reportsMedicOther.hide(),this.$refs.reportsOther.hide()},report:function(){var t,e=this;return(t=n().mark((function t(){var s,a,r,i;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i in e.loading=!0,s=e.contracts.length,a=0,r=function(t){axios.get("/api/reports/contract/journal",{params:{company_id:e.company_id,contracts_ids:[e.contracts[t].id],month:e.month}}).then((function(n){var r=n.data;a++,e.contracts[t].visible_result=!0,e.contracts[t].sum=e.getTotalContractSum(r),e.$refs.reportsMedic[t].hide(),e.$refs.reportsMedic[t].visible(r.medics),e.$refs.reportsTech[t].hide(),e.$refs.reportsTech[t].visible(r.techs),e.$refs.reportsTechOther[t].hide(),e.$refs.reportsTechOther[t].visible(r.techs_other),e.$refs.reportsMedicOther[t].hide(),e.$refs.reportsMedicOther[t].visible(r.medics_other),e.$refs.reportsOther[t].hide(),e.$refs.reportsOther[t].visible(r.other),a===s&&(e.loading=!1),r.message.length&&u().fire({icon:"error",title:"Упсс...",text:r.message})})).finally((function(){}))},e.contracts)r(i);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){m(r,a,n,i,o,"next",t)}function o(t){m(r,a,n,i,o,"throw",t)}i(void 0)}))})()},exportData:function(){var t=this;this.loadingExport=!0,axios.get("/api/reports/contract/journal/export",{params:{company_id:this.company_id,month:this.month},responseType:"blob"}).then((function(t){var e=t.data,s=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=s,a.setAttribute("download","export.xlsx"),document.body.appendChild(a),a.click()})).finally((function(){t.loadingExport=!1}))},searchCompany:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";axios.get("/api/companies/find",{params:{search:e}}).then((function(e){var s=e.data;t.companies=s}))}},watch:{company:function(){0!=this.company_id?this.searchServices():this.loading=!0}}};const _=(0,s(1900).Z)(v,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"card mb-4",staticStyle:{"overflow-x":"inherit"}},[s("h5",{staticClass:"card-header"},[t._v("Выбор информации")]),t._v(" "),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[t._v("Компании")]),t._v(" "),s("multiselect",{staticClass:"is-invalid",attrs:{disabled:t.client,options:t.companies,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите компанию",label:"name"},on:{"search-change":t.searchCompany,select:function(e){return t.company_id=e.hash_id}},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"contract"}},[t._v("Договор")]),t._v(" "),s("multiselect",{attrs:{multiple:!0,options:t.contracts_options,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите договор",label:"name","track-by":"name","preselect-first":!0,selectLabel:"Enter чтобы выбрать",deselectLabel:"Enter чтобы отменить",selectedLabel:"Выбрано"},model:{value:t.contracts,callback:function(e){t.contracts=e},expression:"contracts"}},[s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("По договорам компании осмотров не проводилось")])])],1),t._v(" "),s("div",{staticClass:"form-group col-lg-2"},[s("label",{staticClass:"mb-1",attrs:{for:"date_from"}},[t._v("Период:")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.month,expression:"month"}],ref:"month",staticClass:"form-control form-date",attrs:{type:"month",required:"",id:"month",name:"month"},domProps:{value:t.month},on:{input:function(e){e.target.composing||(t.month=e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-12"},[t.permissions.create?s("button",{staticClass:"btn btn-info",attrs:{type:"submit",disabled:t.loading},on:{click:t.report}},[t.loading?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v("\n                        Сформировать отчет\n                    ")]):t._e(),t._v(" "),t.permissions.export?s("button",{staticClass:"btn btn-info",attrs:{type:"submit",disabled:t.loadingExport},on:{click:t.exportData}},[t.loadingExport?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v("\n                        Экспортировать\n                    ")]):t._e(),t._v(" "),s("a",{staticClass:"btn btn-danger",attrs:{href:"?"}},[t._v("Сбросить")])])])])]),t._v(" "),t._l(t.contracts,(function(e,a){return s("div",[s("b-card-group",{directives:[{name:"show",rawName:"v-show",value:e.visible_result,expression:"contract.visible_result"}],staticClass:"my-3"},[s("b-card",{attrs:{header:e.name},scopedSlots:t._u([{key:"header",fn:function(){return[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:"collapse-"+a,expression:"'collapse-' + index"}],attrs:{variant:"primary"}},[t._v(t._s(e.name))])]},proxy:!0}],null,!0)},[t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-"+a}},[s("b-card",[s("b-card-text",[s("ReportJournalMedic",{ref:"reportsMedic",refInFor:!0}),t._v(" "),s("ReportJournalTech",{ref:"reportsTech",refInFor:!0}),t._v(" "),s("ReportJournalMedicOther",{ref:"reportsMedicOther",refInFor:!0}),t._v(" "),s("ReportJournalTechOther",{ref:"reportsTechOther",refInFor:!0}),t._v(" "),s("ReportJournalOther",{ref:"reportsOther",refInFor:!0})],1)],1),t._v(" "),s("b-row",[s("b-col",{staticClass:"text-right"},[s("p",[t._v("\n                                Итого по договору: "+t._s(e.sum)+"\n                            ")])])],1)],1)],1)],1)],1)}))],2)}),[],!1,null,"57d5c727",null).exports},380:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>c});var a=s(2985),n=s(8727),r=s(8609),i=s(1677),o=s(2566);const l={name:"ReportJournalIndex",props:["default_company","client_company","permissions"],components:{ReportJournalMedic:a.default,ReportJournalTech:n.default,ReportJournalTechOther:r.default,ReportJournalMedicOther:i.default,ReportJournalOther:o.default},data:function(){return{loading:!1,loadingExport:!1,company:null,client:!1,companies:[],month:null,company_id:0}},mounted:function(){this.searchCompany();var t=new Date,e=t.getMonth()>9?t.getMonth():"0"+t.getMonth();this.month=t.getFullYear()+"-"+e,this.client_company?(this.companies.push(this.client_company),this.company=this.client_company,this.company_id=this.client_company.hash_id,this.client=!0):this.default_company&&(this.companies.push(this.default_company),this.company=this.default_company,this.company_id=this.default_company.hash_id,this.report())},methods:{reset:function(){this.$refs.reportsMedic.hide(),this.$refs.reportsTech.hide(),this.$refs.reportsTechOther.hide(),this.$refs.reportsMedicOther.hide(),this.$refs.reportsOther.hide()},report:function(){var t=this;this.reset(),this.loading=!0,axios.get("/api/reports/journal",{params:{company_id:this.company_id,month:this.month}}).then((function(e){var s=e.data;t.$refs.reportsMedic.visible(s.medics),t.$refs.reportsTech.visible(s.techs),t.$refs.reportsTechOther.visible(s.techs_other),t.$refs.reportsMedicOther.visible(s.medics_other),t.$refs.reportsOther.visible(s.other)})).finally((function(){t.loading=!1}))},exportData:function(){var t=this;this.loadingExport=!0,axios.get("/api/reports/journal/export",{params:{company_id:this.company_id,month:this.month},responseType:"blob"}).then((function(t){var e=t.data,s=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=s,a.setAttribute("download","export.xlsx"),document.body.appendChild(a),a.click()})).finally((function(){t.loadingExport=!1}))},searchCompany:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";axios.get("/api/companies/find",{params:{search:e}}).then((function(e){var s=e.data;s.forEach((function(t){t.name="[".concat(t.hash_id,"] ").concat(t.name)})),t.companies=s}))}}};const c=(0,s(1900).Z)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"card mb-4",staticStyle:{"overflow-x":"inherit"}},[s("h5",{staticClass:"card-header"},[t._v("Выбор информации")]),t._v(" "),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-3"},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[t._v("Компании")]),t._v(" "),s("multiselect",{staticClass:"is-invalid",attrs:{disabled:t.client,options:t.companies,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите компанию",label:"name"},on:{"search-change":t.searchCompany,select:function(e){return t.company_id=e.hash_id}},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"form-group col-lg-2"},[s("label",{staticClass:"mb-1",attrs:{for:"date_from"}},[t._v("Период:")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.month,expression:"month"}],ref:"month",staticClass:"form-control form-date",attrs:{type:"month",required:"",id:"month",name:"month"},domProps:{value:t.month},on:{input:function(e){e.target.composing||(t.month=e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-12"},[t.permissions.create?s("button",{staticClass:"btn btn-info",attrs:{type:"submit",disabled:t.loading},on:{click:t.report}},[t.loading?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v("\n                        Сформировать отчет\n                    ")]):t._e(),t._v(" "),t.permissions.export?s("button",{staticClass:"btn btn-info",attrs:{type:"submit",disabled:t.loadingExport},on:{click:t.exportData}},[t.loadingExport?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v("\n                        Экспортировать\n                    ")]):t._e(),t._v(" "),s("a",{staticClass:"btn btn-danger",attrs:{href:"?"}},[t._v("Сбросить")])])])])]),t._v(" "),s("ReportJournalMedic",{ref:"reportsMedic"}),t._v(" "),s("ReportJournalTech",{ref:"reportsTech"}),t._v(" "),s("ReportJournalMedicOther",{ref:"reportsMedicOther"}),t._v(" "),s("ReportJournalTechOther",{ref:"reportsTechOther"}),t._v(" "),s("ReportJournalOther",{ref:"reportsOther"})],1)}),[],!1,null,"24194604",null).exports},2985:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>r});var a=s(6779);const n={name:"ReportJournalMedic",data:function(){return{reports:!1,show:!1}},methods:{visible:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(void 0===t.length||t.length>0)&&(this.reports=t),this.show=e},hide:function(){this.reports=!1,this.show=!1},getTotalAll:a.tx,getTotal:a.NU,getSumAll:a.gw,getSum:a.n0,getDiscount:a.fL,isSync:a.Wk}};const r=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.reports?s("div",{staticClass:"card"},[s("h5",{staticClass:"card-header"},[t._v("Медосмотры и другие услуги для водителей за выбранный период")]),t._v(" "),s("div",{staticClass:"card-body"},[s("table",{staticClass:"table table-striped table-sm",attrs:{id:"reports-table-1"}},[t._m(0),t._v(" "),s("tbody",[t._l(t.reports,(function(e,a,n){return s("tr",{key:n},[s("td",{attrs:{width:"100"}},[t._v("\n                        "+t._s(a)+"\n                    ")]),t._v(" "),s("td",{attrs:{width:"250"}},[s("b",[t._v(t._s(e.driver_fio||"Неизвестный водитель"))]),t._v(" "),s("p",[t._v(t._s(e.pv_id||""))])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"Предрейсовый","Предсменный"))+"\n\n                        "),null==t.getSum(e,"Предрейсовый","Предсменный")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"Предрейсовый","Предсменный"))+"₽\n                            "),t.getDiscount(e,"Предрейсовый","Предсменный")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"Предрейсовый","Предсменный"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"Предрейсовый","Предсменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"Послерейсовый","Послесменный"))+"\n\n                        "),null==t.getSum(e,"Послерейсовый","Послесменный")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"Послерейсовый","Послесменный"))+"₽\n                            "),t.getDiscount(e,"Послерейсовый","Послесменный")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"Послерейсовый","Послесменный"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"Послерейсовый","Послесменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"is_dop"))+"\n                    ")]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"bdd"))+"\n\n                        "),null==t.getSum(e,"bdd")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"bdd"))+"₽\n                            "),t.getDiscount(e,"bdd")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"bdd"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"bdd")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"Не идентифицирован"))+"\n                    ")]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"report_cart"))+"\n\n                        "),null==t.getSum(e,"report_cart")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"report_cart"))+"₽\n                            "),t.getDiscount(e,"report_cart")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"report_cart"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"report_cart")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"pechat_pl"))+"\n\n                        "),null==t.getSum(e,"pechat_pl")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"pechat_pl"))+"₽\n                            "),t.getDiscount(e,"pechat_pl")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"pechat_pl"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"pechat_pl")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])])])})),t._v(" "),t.reports?s("tr",[t._m(1),t._v(" "),s("td",[t._v("\n                       "+t._s(Object.keys(t.reports).length)+"\n                    ")]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"Предрейсовый","Предсменный"))+"\n\n                        "),null!=t.getSumAll(t.reports,"Предрейсовый","Предсменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSumAll(t.reports,"Предрейсовый","Предсменный"))+"₽\n                        ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"Послерейсовый","Послесменный"))+"\n\n                        "),null!=t.getSumAll(t.reports,"Послерейсовый","Послесменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSumAll(t.reports,"Послерейсовый","Послесменный"))+"₽\n                        ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"is_dop"))+"\n                    ")]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"bdd"))+"\n\n                        "),null!=t.getSumAll(t.reports,"bdd")?s("div",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t.getSumAll(t.reports,"bdd"))+"₽ ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"Не идентифицирован"))+"\n\n                        "),null!=t.getSumAll(t.reports,"Не идентифицирован")?s("div",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t.getSumAll(t.reports,"Не идентифицирован"))+"₽ ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"report_cart"))+"\n\n                        "),null!=t.getSumAll(t.reports,"report_cart")?s("div",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t.getSumAll(t.reports,"report_cart"))+"₽ ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"pechat_pl"))+"\n\n                        "),null!=t.getSumAll(t.reports,"pechat_pl")?s("div",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t.getSumAll(t.reports,"pechat_pl"))+"₽ ")]):t._e()])]):t._e()],2)])])]):t.show?s("div",{staticClass:"alert alert-secondary",attrs:{role:"alert"}},[t._v("\n        Медосмотры за период не найдены\n    ")]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"100"}},[t._v("ID")]),t._v(" "),s("th",{attrs:{width:"250"}},[t._v("Водитель")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Предрейсовый/Предсменный")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Послерейсовый/Послесменный")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Несогласованные осмотры")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("БДД")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Не идентифицирован")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Отчёты с карт")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Печать ПЛ")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",{attrs:{width:"100"}},[s("b",[t._v("Всего")])])}],!1,null,"e389de7a",null).exports},1677:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var a=s(3723),n=s(6779);const r={name:"ReportJournalMedicOther",data:function(){return{data:!1,show:!1,months:a.e}},methods:{visible:function(t){(void 0===t.length||t.length>0)&&(this.data=t),this.show=!0},hide:function(){this.data=!1,this.show=!1},getTotalAll:n.tx,getTotal:n.NU,getSumAll:n.gw,getSum:n.n0,getDiscount:n.fL,isSync:n.Wk}};const i=(0,s(1900).Z)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.data?s("div",{staticClass:"card"},[s("h5",{staticClass:"card-header"},[t._v("Медосмотры и другие услуги для водителей за другие периоды")]),t._v(" "),s("div",{staticClass:"card-body"},[s("table",{staticClass:"table table-responsive",attrs:{id:"reports-table-4"}},[s("thead",[s("tr",t._l(t.data,(function(e,a,n){return s("th",{key:n,staticClass:"text-center",staticStyle:{"border-left":"1px solid #e9e9e9",background:"#e9e9e9"},attrs:{colspan:"7"}},[t._v("\n                        "+t._s(t.months[e.month-1])+" "+t._s(e.year)+"\n                    ")])})),0)]),t._v(" "),s("tbody",t._l(t.data,(function(e,a,n){return s("td",{staticClass:"p-0",attrs:{colspan:"7"}},[s("table",{staticClass:"w-100 table"},[t._m(0,!0),t._v(" "),s("tbody",[t._l(e.reports,(function(a,n,r){return s("tr",[s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(a.driver_fio||"Неизвестный водитель")+" / "+t._s(n)+"\n                            ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"Предрейсовый","Предсменный"))+"\n\n                                "),t.getSum(a,"Предрейсовый","Предсменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"Предрейсовый","Предсменный"))+"₽\n                                    "),t.getDiscount(a,"Предрейсовый","Предсменный")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"Предрейсовый","Предсменный"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"Предрейсовый","Предсменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"Послерейсовый","Послесменный"))+"\n\n                                "),t.getSum(e,"Послерейсовый","Послесменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"Послерейсовый","Послесменный"))+"₽\n                                    "),t.getDiscount(a,"Послерейсовый","Послесменный")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"Послерейсовый","Послесменный"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"Послерейсовый","Послесменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"is_dop"))+"\n                            ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"bdd"))+"\n\n                                "),t.getSum(a,"bdd")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"bdd"))+"₽\n                                    "),t.getDiscount(a,"bdd")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"bdd"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"bdd")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"report_cart"))+"\n\n                                "),t.getSum(a,"report_cart")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"report_cart"))+"₽\n                                    "),t.getDiscount(a,"report_cart")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"report_cart"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"report_cart")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"pechat_pl"))+"\n\n                                "),t.getSum(e,"pechat_pl")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                "+t._s(t.getSum(a,"pechat_pl"))+"₽\n                                "),t.getDiscount(a,"pechat_pl")?s("span",{staticClass:"text-red"},[t._v("\n                                    ("+t._s(t.getDiscount(a,"pechat_pl"))+"%)\n                                ")]):t._e(),t._v(" "),t.isSync(a,"pechat_pl")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()])])})),t._v(" "),e.reports?s("tr",[t._m(1,!0),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"Предрейсовый","Предсменный"))+"\n\n                                "),null!=t.getSumAll(e.reports,"Предрейсовый","Предсменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSumAll(e.reports,"Предрейсовый","Предсменный"))+"₽\n                                ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"Послерейсовый","Послесменный"))+"\n\n                                "),null!=t.getSumAll(t.reports,"Послерейсовый","Послесменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSumAll(e.reports,"Послерейсовый","Послесменный"))+"₽\n                                ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"is_dop"))+"\n                            ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"bdd"))+"\n                                "),null!=t.getSumAll(e.reports,"bdd")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSumAll(e.reports,"bdd"))+"₽\n                                ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"report_cart"))+"\n                                "),null!=t.getSumAll(e.reports,"report_cart")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSumAll(e.reports,"report_cart"))+"₽\n                                ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotalAll(e.reports,"pechat_pl"))+"\n                                "),null!=t.getSumAll(e.reports,"pechat_pl")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSumAll(e.reports,"pechat_pl"))+"₽\n                                ")]):t._e()])]):t._e()],2)])])})),0)])])]):t.show?s("div",{staticClass:"alert alert-secondary",attrs:{role:"alert"}},[t._v("\n        Медосмотры за другие периоды не найдены\n    ")]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",{staticClass:"text-center"},[t._v("Водитель")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Предрейсовый/Предсменный")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Послерейсовый/Послесменный")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Несогласованные осмотры")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("БДД")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Отчёты с карт")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Печать ПЛ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",{staticClass:"text-center"},[s("b",[t._v("Всего")])])}],!1,null,"1e96f75a",null).exports},2566:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ReportJournalOther",data:function(){return{show:!1,data:!1}},methods:{visible:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(void 0===t.length||t.length>0)&&(this.data=t),this.show=e},hide:function(){this.data=!1,this.show=!1},getTotal:function(t){var e=0;for(var s in t){var a;if("number"==typeof t[s])e+=t[s];else e+=null===(a=t[s])||void 0===a?void 0:a.sum}return e}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.data?s("div",{staticClass:"card"},[s("h5",{staticClass:"card-header"},[t._v("Услуги без реестров")]),t._v(" "),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[t.data.company?s("div",{staticClass:"col-lg-3"},[s("p",{staticClass:"font-weight-bold",staticStyle:{"font-size":"14px"}},[t._v("Услуги компании")]),t._v(" "),s("table",{staticClass:"table table-striped table-sm",attrs:{id:"reports-table-1"}},[t._m(0),t._v(" "),s("tbody",[t._l(t.data.company,(function(e,a,n){return s("tr",{key:n},[s("td",[t._v(" "+t._s(a)+" ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(" "+t._s(e)+"₽ ")])])})),t._v(" "),s("tr",[s("td",[t._v(" Всего: ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(t.getTotal(t.data.company))+"₽\n                                ")])])],2)])]):t._e(),t._v(" "),t.data.drivers?s("div",{staticClass:"col-lg-4"},[s("p",{staticClass:"font-weight-bold",staticStyle:{"font-size":"14px"}},[t._v("Услуги водителей")]),t._v(" "),s("table",{staticClass:"table table-striped table-sm",attrs:{id:"reports-table-1"}},[t._m(1),t._v(" "),s("tbody",[t._l(t.data.drivers,(function(e,a,n){return s("tr",{key:n},[s("td",[t._v(" "+t._s(e.driver_fio||"Неизвестный водитель")+" ")]),t._v(" "),s("td",[t._v(" "+t._s(e.name)+" ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(" "+t._s(e.sum)+"₽ ")])])})),t._v(" "),s("tr",[s("td",[t._v(" Всего: ")]),t._v(" "),s("td"),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(t.data.drivers))+"₽\n                            ")])])],2)])]):t._e(),t._v(" "),t.data.cars?s("div",{staticClass:"col-lg-5"},[s("p",{staticClass:"font-weight-bold",staticStyle:{"font-size":"14px"}},[t._v("Услуги автомобилей")]),t._v(" "),s("table",{staticClass:"table table-striped table-sm",attrs:{id:"reports-table-1"}},[t._m(2),t._v(" "),s("tbody",[t._l(t.data.cars,(function(e,a,n){return s("tr",{key:n},[s("td",[t._v(" "+t._s(e.gos_number||"Неизвестный автомобиль")+" ("+t._s(e.type_auto)+") ")]),t._v(" "),s("td",[t._v(" "+t._s(e.name)+" ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(" "+t._s(e.sum)+"₽ ")])])})),t._v(" "),s("tr",[s("td",[t._v(" Всего: ")]),t._v(" "),s("td"),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(t.getTotal(t.data.cars))+"₽\n                                ")])])],2)])]):t._e()])])]):t.show?s("div",{staticClass:"alert alert-secondary",attrs:{role:"alert"}},[t._v("\n        Услуги без реестров не найдены\n    ")]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"200"}},[t._v("Услуга")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"100"}},[t._v("Сумма")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"200"}},[t._v("Водитель")]),t._v(" "),s("th",{attrs:{width:"200"}},[t._v("Услуга")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"100"}},[t._v("Сумма")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"200"}},[t._v("Автомобиль")]),t._v(" "),s("th",{attrs:{width:"200"}},[t._v("Услуга")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"100"}},[t._v("Сумма")])])])}],!1,null,null,null).exports},8727:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>r});var a=s(6779);const n={name:"ReportJournalTech",data:function(){return{reports:!1,show:!1}},methods:{getStringMark:function(t){var e="";return t.car_gos_number?e+=t.car_gos_number+" ":e+="неизвестный автомобиль ",t.type_auto&&(e+="(".concat(t.type_auto,")")),e},visible:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(void 0===t.length||t.length>0)&&(this.reports=t),this.show=e},hide:function(){this.reports=!1,this.show=!1},getTotalAll:a.tx,getTotal:a.NU,getSumAll:a.gw,getSum:a.n0,getDiscount:a.fL,isSync:a.Wk}};const r=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.reports?s("div",{staticClass:"card"},[s("h5",{staticClass:"card-header"},[t._v("Техосмотры за период")]),t._v(" "),s("div",{staticClass:"card-body"},[s("table",{staticClass:"table table-striped table-sm",attrs:{id:"reports-table-2"}},[t._m(0),t._v(" "),s("tbody",[t._l(t.reports,(function(e,a,n){return s("tr",{key:n},[s("td",{attrs:{width:"100"}},[t._v("\n                        "+t._s(a)+"\n                    ")]),t._v(" "),s("td",{attrs:{width:"250"}},[s("b",[t._v(t._s(t.getStringMark(e)))]),t._v(" "),s("p",[t._v(t._s(e.pv_id||""))])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"Предрейсовый","Предсменный"))+"\n\n                        "),null==t.getSum(e,"Предрейсовый","Предсменный")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"Предрейсовый","Предсменный"))+"₽\n                            "),t.getDiscount(e,"Предрейсовый","Предсменный")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"Предрейсовый","Предсменный"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"Предрейсовый","Предсменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"Послерейсовый","Послесменный"))+"\n\n                        "),null==t.getSum(e,"Послерейсовый","Послесменный")?s("div",{staticClass:"text-red font-weight-bold"},[t._v("\n                            Услуги не указаны\n                        ")]):s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSum(e,"Послерейсовый","Послесменный"))+"₽\n                            "),t.getDiscount(e,"Послерейсовый","Послесменный")?s("span",{staticClass:"text-red"},[t._v("\n                                ("+t._s(t.getDiscount(e,"Послерейсовый","Послесменный"))+"%)\n                            ")]):t._e(),t._v(" "),t.isSync(e,"Послерейсовый","Послесменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})])]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotal(e,"is_dop"))+"\n                    ")])])})),t._v(" "),t.reports?s("tr",[t._m(1),t._v(" "),s("td",[t._v("\n                        "+t._s(Object.keys(t.reports).length)+"\n                    ")]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"Предрейсовый","Предсменный"))+"\n\n                        "),null!=t.getSumAll(t.reports,"Предрейсовый","Предсменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSumAll(t.reports,"Предрейсовый","Предсменный"))+"₽\n                        ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"Послерейсовый","Послесменный"))+"\n\n\n                        "),null!=t.getSumAll(t.reports,"Послерейсовый","Послесменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                            "+t._s(t.getSumAll(t.reports,"Послерейсовый","Послесменный"))+"₽\n                        ")]):t._e()]),t._v(" "),s("td",{staticClass:"text-center",attrs:{width:"150"}},[t._v("\n                        "+t._s(t.getTotalAll(t.reports,"is_dop"))+"\n                    ")])]):t._e()],2)])])]):t.show?s("div",{staticClass:"alert alert-secondary",attrs:{role:"alert"}},[t._v("\n        Техосмотры за период не найдены\n    ")]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"100"}},[t._v("ID")]),t._v(" "),s("th",{attrs:{width:"250"}},[t._v("Автомобиль")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Предрейсовый/Предсменный")]),t._v(" "),s("th",{staticClass:"text-center",attrs:{width:"150"}},[t._v("Послерейсовый/Послесменный")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Несогласованные осмотры")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",{attrs:{width:"100"}},[s("b",[t._v("Всего")])])}],!1,null,"1162c1ba",null).exports},8609:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var a=s(3723),n=s(6779);const r={name:"ReportJournalTechOther",data:function(){return{data:!1,show:!1,months:a.e}},methods:{getStringMark:function(t){var e="";return t.car_gos_number?e+=t.car_gos_number+" ":e+="неизвестный автомобиль ",t.type_auto&&(e+="(".concat(t.type_auto,")")),e},visible:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(void 0===t.length||t.length>0)&&(this.data=t),this.show=e},hide:function(){this.data=!1,this.show=!1},getTotalAll:n.tx,getTotal:n.NU,getSumAll:n.gw,getSum:n.n0,getDiscount:n.fL,isSync:n.Wk}};const i=(0,s(1900).Z)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.data?s("div",{staticClass:"card"},[s("h5",{staticClass:"card-header"},[t._v("Техосмотры за другие периоды")]),t._v(" "),s("div",{staticClass:"card-body"},[s("table",{staticClass:"table table-responsive",attrs:{id:"reports-table-4"}},[s("thead",[s("tr",t._l(t.data,(function(e,a,n){return s("th",{key:n,staticClass:"text-center",staticStyle:{"border-left":"1px solid #e9e9e9",background:"#e9e9e9"},attrs:{colspan:"7"}},[t._v("\n                        "+t._s(t.months[e.month-1])+" "+t._s(e.year)+"\n                    ")])})),0)]),t._v(" "),s("tbody",t._l(t.data,(function(e,a,n){return s("td",{staticClass:"p-0",attrs:{colspan:"7"}},[s("table",{staticClass:"w-100 table mr-2"},[t._m(0,!0),t._v(" "),s("tbody",[t._l(e.reports,(function(a,n,r){return s("tr",[s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getStringMark(a))+"\n                            ")]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"Предрейсовый","Предсменный"))+"\n                                "),t.getSum(a,"Предрейсовый","Предсменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"Предрейсовый","Предсменный"))+"₽\n                                    "),t.getDiscount(a,"Предрейсовый","Предсменный")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"Предрейсовый","Предсменный"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"Предрейсовый","Предсменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(t.getTotal(a,"Послерейсовый","Послесменный"))+"\n\n                                "),t.getSum(e,"Послерейсовый","Послесменный")?s("div",{staticClass:"font-weight-bold"},[t._v("\n                                    "+t._s(t.getSum(a,"Послерейсовый","Послесменный"))+"₽\n                                    "),t.getDiscount(a,"Послерейсовый","Послесменный")?s("span",{staticClass:"text-red"},[t._v("\n                                        ("+t._s(t.getDiscount(a,"Послерейсовый","Послесменный"))+"%)\n                                    ")]):t._e(),t._v(" "),t.isSync(a,"Послерейсовый","Послесменный")?s("i",{staticClass:"fa fa-refresh text-success"}):s("i",{staticClass:"fa fa-refresh text-red"})]):t._e()]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(t._s(t.getTotal(a,"is_dop")))])])})),t._v(" "),e.reports?s("tr",[t._m(1,!0),t._v(" "),s("td",{staticClass:"text-center"},[t._v(t._s(t.getTotalAll(e.reports,"Предрейсовый","Предсменный")))]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(t._s(t.getTotalAll(e.reports,"Послерейсовый","Послесменный")))]),t._v(" "),s("td",{staticClass:"text-center"},[t._v(t._s(t.getTotalAll(e.reports,"is_dop")))])]):t._e()],2)])])})),0)])])]):t.show?s("div",{staticClass:"alert alert-secondary",attrs:{role:"alert"}},[t._v("\n        Техосмотры за другие периоды не найдены\n    ")]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",{staticClass:"text-center"},[t._v("Автомобиль")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Предрейсовый/Предсменный")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Послерейсовый/Послесменный")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("Несогласованные осмотры")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",{staticClass:"text-center"},[s("b",[t._v("Всего")])])}],!1,null,"281858af",null).exports},3871:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ReportJournalMedic",props:["reports"],data:function(){return{show:!1}},methods:{getName:function(t){return"is_dop"===t?"Несогласованные осмотры":"bdd"===t?"БДД":"report_cart"===t?"Отчёты с карт":"pechat_pl"===t?"Печать ПЛ":t},getTotalCount:function(t){return t.reduce((function(t,e){return t+e.count}),0)},getTotalPrice:function(t){var e=this;return t.reduce((function(t,s){var a=e.reports.data;return"Разовые осмотры"===s.type_product?t+s.price*s.count:"Абонентская оплата"===s.type_product?Object.keys(a).length*s.price:t+s.price}),0)}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"report-group"},[s("div",{staticClass:"report__title"},[t._v("\n        Медосмотры и другие услуги для водителей за выбранный период\n        "+t._s(0===t.reports.data.length?"не найдены":"")+"\n    ")]),t._v(" "),0!==t.reports.data.length?s("div",[t._l(t.reports.data,(function(e,a){return s("div",{key:a,staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("span",{staticClass:"text-muted"},[t._v(t._s(a||"Неизвестный водитель"))]),t._v(" "+t._s(e.driver_fio)+"\n                ")]),t._v(" "),s("div",{staticClass:"report__pvs mt-1"},[t._v(t._s(e.pv_id||"Пункты выпуска не найдены"))])]),t._v(" "),s("div",{staticClass:"report__cards medic"},t._l(e.types,(function(e,a){return e.count>0||e.total>0?s("div",{key:a,staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,n){return"is_dop"!==a?s("div",{key:n,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(n)+"\n                        ")]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                            "),e.discount?s("span",[t._v(t._s(e.discount)+"%")]):t._e()])]):t._e()})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2):t._e()})),0)])})),t._v(" "),s("div",{staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[t._v("\n                    Всего\n                    "),s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"всего водителей"}},[t._v("Кол-во: "+t._s(t.reports.total.drivers_count||0))]),t._v(" "),s("span",[t._v("Стоимость: "+t._s(t.reports.total.price||0)+"₽")])])]),t._v(" "),s("div",{staticClass:"report__cards medic"},t._l(t.reports.total.types,(function(e,a){return s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,a){return s("div",{key:a,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(a)+"\n                            "),s("span",[t._v("кол-во: "+t._s(e.count||0))])]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                        ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2)})),0)])],2):t._e()])}),[],!1,null,"1c1a656e",null).exports},4078:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>r});var a=s(3723);const n={name:"ReportJournalMedicOther",props:["reports"],data:function(){return{show:!1,months:a.e}},methods:{getName:function(t){return"is_dop"===t?"Несогласованные осмотры":"bdd"===t?"БДД":"report_cart"===t?"Отчёты с карт":"pechat_pl"===t?"Печать ПЛ":t}}};const r=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"report-group"},[s("div",{staticClass:"report__title"},[t._v("\n        Медосмотры и другие услуги для водителей за другие периоды\n        "+t._s(0===t.reports.data.length?"не найдены":"")+"\n    ")]),t._v(" "),0!==t.reports.data.length?s("div",[t._l(t.reports.data,(function(e,a){return 0!==t.reports.data.length?s("div",{key:a,staticClass:"report__item mt-3"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("span",{staticClass:"text-muted"},[t._v(t._s(e.year))]),t._v(" "+t._s(t.months[e.month-1])+"\n                ")])]),t._v(" "),s("div",{staticClass:"card p-2",staticStyle:{"border-radius":"10px",gap:"10px"}},t._l(e.reports,(function(e,a){return s("div",{key:a,staticClass:"d-flex"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("span",{staticClass:"text-muted"},[t._v(t._s(a||"Неизвестный водитель"))]),t._v(" "+t._s(e.driver_fio)+"\n                        ")]),t._v(" "),s("div",{staticClass:"report__pvs mt-1"},[t._v(t._s(e.pv_id||"Пункты выпуска не найдены"))])]),t._v(" "),s("div",{staticClass:"report__cards medic"},t._l(e.types,(function(e,a){return"medic"!==a?s("div",{key:a,staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                                "+t._s(t.getName(a))+"\n                            ")]),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                                Всего осмотров:\n                                "+t._s(e.count||e.total||0)+"\n                                "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                            ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])]):t._e()})),0)])})),0)]):t._e()})),t._v(" "),s("div",{staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[t._v("\n                    Всего\n                    "),s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"всего водителей"}},[t._v("Кол-во: "+t._s(t.reports.total.drivers_count||0))]),t._v(" "),s("span",[t._v("Стоимость: "+t._s(t.reports.total.price||0)+"₽")])])]),t._v(" "),s("div",{staticClass:"report__cards medic"},t._l(t.reports.total.types,(function(e,a){return s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,a){return s("div",{key:a,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(a)+"\n                            "),s("span",[t._v("кол-во: "+t._s(e.count||0))])]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                        ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2)})),0)])],2):t._e()])}),[],!1,null,"b3c28c56",null).exports},3391:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ReportJournalOther",props:["data"],data:function(){return{show:!1}},methods:{getTotal:function(t){var e=0;for(var s in t)"number"==typeof t[s]?e+=t[s]:t[s].sum?e+=t[s].sum:e+=Number.parseInt(t[s]);return e}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"report-group"},[s("div",{staticClass:"report__title"},[t._v("\n        Услуги без реестров "+t._s(t.data?"":"не найдены")+"\n    ")]),t._v(" "),t.data?s("div",{staticClass:"report__item"},[s("div",{staticClass:"report__cards"},[t.data.company?s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                    Услуги компании\n                ")]),t._v(" "),t._l(t.data.company,(function(e,a,n){return s("div",{key:n,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                        "+t._s(a)+"\n                    ")]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                        "+t._s(e)+"₽\n                    ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",[t._v("Всего: "+t._s(t.getTotal(t.data.company)||0)+"₽")])])],2):t._e(),t._v(" "),t.data.drivers?s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                    Услуги водителей\n                ")]),t._v(" "),t._l(t.data.drivers,(function(e,a,n){return s("div",{key:n,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                        "+t._s(a)+"\n                    ")]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                        "+t._s(e)+"₽\n                    ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",[t._v("Всего: "+t._s(t.getTotal(t.data.company)||0)+"₽")])])],2):t._e(),t._v(" "),t.data.cars?s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                    Услуги автомобилей\n                ")]),t._v(" "),t._l(t.data.cars,(function(e,a,n){return s("div",{key:n,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                        "+t._s(a)+"\n                    ")]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                        "+t._s(e)+"₽\n                    ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",[t._v("Всего: "+t._s(t.getTotal(t.data.cars)||0)+"₽")])])],2):t._e()])]):t._e()])}),[],!1,null,null,null).exports},9890:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ReportJournalTech",props:["reports"],data:function(){return{show:!1}},methods:{getName:function(t){return"is_dop"===t?"Несогласованные осмотры":"bdd"===t?"БДД":"report_cart"===t?"Отчёты с карт":"pechat_pl"===t?"Печать ПЛ":t},getTotalCount:function(t){return t.reduce((function(t,e){return t+e.count}),0)},getTotalPrice:function(t){return t.reduce((function(t,e){return t+e.price}),0)}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"report-group"},[s("div",{staticClass:"report__title"},[t._v("\n        Техосмотры за период\n        "+t._s(0===t.reports.data.length?"не найдены":"")+"\n    ")]),t._v(" "),0!==t.reports.data.length?s("div",[t._l(t.reports.data,(function(e,a){return s("div",{key:a,staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("div",[s("span",{staticClass:"text-muted"},[t._v(t._s(a||"Неизвестный автомобиль"))]),t._v(" "),e.type_auto?s("span",{staticClass:"text-muted"},[t._v(t._s(e.type_auto))]):t._e()]),t._v("\n                    "+t._s(e.car_gos_number)+"\n                    "),s("div",{staticClass:"report__pvs mt-1"},[t._v(t._s(e.pv_id||"Пункты выпуска не найдены"))])])]),t._v(" "),s("div",{staticClass:"report__cards"},t._l(e.types,(function(e,a){return s("div",{key:a,staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,a){return s("div",{key:a,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(a)+"\n                        ")]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                            "),e.discount?s("span",[t._v(t._s(e.discount)+"%")]):t._e()])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2)})),0)])})),t._v(" "),s("div",{staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[t._v("\n                    Всего\n                    "),s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"всего автомобилей"}},[t._v("Кол-во: "+t._s(t.reports.total.cars_count||0))]),t._v(" "),s("span",[t._v("Стоимость: "+t._s(t.reports.total.price||0)+"₽")])])]),t._v(" "),s("div",{staticClass:"report__cards"},t._l(t.reports.total.types,(function(e,a){return s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,a){return s("div",{key:a,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(a)+"\n                            "),s("span",[t._v("кол-во "+t._s(e.count||0))])]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                        ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),"is_dop"!==a?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2)})),0)])],2):t._e()])}),[],!1,null,"05a406c2",null).exports},682:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>r});var a=s(3723);const n={name:"ReportJournalTechOther",props:["reports"],data:function(){return{show:!1,months:a.e}},methods:{getName:function(t){return"is_dop"===t?"Несогласованные осмотры":"bdd"===t?"БДД":"report_cart"===t?"Отчёты с карт":"pechat_pl"===t?"Печать ПЛ":t}}};const r=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"report-group"},[s("div",{staticClass:"report__title"},[t._v("\n        Техосмотры за другие периоды\n        "+t._s(0===t.reports.data.length?"не найдены":"")+"\n    ")]),t._v(" "),0!==t.reports.data.length?s("div",[t._l(t.reports.data,(function(e,a){return s("div",{key:a,staticClass:"report__item mt-3"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("span",{staticClass:"text-muted"},[t._v(t._s(e.year))]),t._v(" "+t._s(t.months[e.month-1])+"\n                ")])]),t._v(" "),s("div",{staticClass:"card p-2",staticStyle:{"border-radius":"10px"}},t._l(e.reports,(function(e,a){return s("div",{key:a,staticClass:"d-flex"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[s("div",[s("span",{staticClass:"text-muted"},[t._v(t._s(a||"Неизвестный автомобиль"))]),t._v(" "),e.type_auto?s("span",{staticClass:"text-muted"},[t._v(t._s(e.type_auto))]):t._e()]),t._v("\n                            "+t._s(e.car_gos_number)+"\n                        ")]),t._v(" "),s("div",{staticClass:"report__pvs mt-1"},[t._v(t._s(e.pv_id||"Пункты выпуска не найдены"))])]),t._v(" "),s("div",{staticClass:"report__cards"},t._l(e.types,(function(e,a){return s("div",{key:a,staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                                "+t._s(t.getName(a))+"\n                            ")]),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                                Всего осмотров:\n                                "+t._s(e.count||e.total||0)+"\n                                "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                            ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])])})),0)])})),0)])})),t._v(" "),s("div",{staticClass:"report__item mt-2"},[s("div",{staticClass:"report__item-title"},[s("div",{staticClass:"report__name"},[t._v("\n                    Всего\n                    "),s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"всего автомобилей"}},[t._v("Кол-во: "+t._s(t.reports.total.cars_count||0))]),t._v(" "),s("span",[t._v("Стоимость: "+t._s(t.reports.total.price||0)+"₽")])])]),t._v(" "),s("div",{staticClass:"report__cards"},t._l(t.reports.total.types,(function(e,a){return s("div",{staticClass:"report__card"},[s("div",{staticClass:"report__card-title"},[t._v("\n                        "+t._s(t.getName(a))+"\n                    ")]),t._v(" "),t._l(e.services,(function(e,a){return s("div",{key:a,staticClass:"report__card-item"},[s("div",{staticClass:"report__card-item-name"},[t._v("\n                            "+t._s(a)+"\n                            "),s("span",[t._v("кол-во: "+t._s(e.count||0))])]),t._v(" "),s("div",{staticClass:"report__card-item-price"},[t._v("\n                            "+t._s(e.price)+"₽\n                        ")])])})),t._v(" "),s("div",{staticClass:"report__footer"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"все / несогласованные"}},[t._v("\n                            Всего осмотров:\n                            "+t._s(e.count||e.total||0)+"\n                            "+t._s(e.count_dop?"/ "+e.count_dop:"")+"\n                        ")]),t._v(" "),e.price?s("span",[t._v("Общая стоимость: "+t._s(e.price)+"₽")]):t._e()])],2)})),0)])],2):t._e()])}),[],!1,null,"7e0939c8",null).exports},1882:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"Total",props:["data"],data:function(){return{}},computed:{total:function(){var t=0;for(var e in this.data)if("message"!==e)if("other"!==e)t+=parseInt(this.data[e].total.price);else for(var s in this.data[e].company)t+=parseInt(this.data[e].company[s]);return t}},methods:{}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.data?s("div",{},[s("b-row",{staticClass:"mt-5"},[s("b-col",{staticClass:"text-right"},[s("p",[t._v("\n                Итого по договору: "+t._s(t.total)+"₽\n            ")])])],1)],1):t._e()}),[],!1,null,"a2338176",null).exports},4769:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>v});var a=s(7757),n=s.n(a),r=s(6455),i=s.n(r),o=s(682),l=s(3391),c=s(4078),d=s(3871),u=s(9890),p=s(1882);function f(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const m={name:"company-service-refactoring",props:["default_company","client_company","client"],components:{ReportJournalTechOther:o.default,ReportJournalOther:l.default,ReportJournalMedic:d.default,ReportJournalTech:u.default,Total:p.default,ReportJournalMedicOther:c.default},data:function(){return{loading:!1,loadingExport:!1,company:null,client:!1,companies:[],month:null,company_id:0,contracts:[],contracts_options:[],permissions:{export:!0,create:!0},result:[],temporary:[]}},methods:{getReport:function(){var t,e=this;return(t=n().mark((function t(){var s,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loading=!0,s=e.contracts.length,a=0,e.contracts.forEach((function(t,n){axios.get("/api/reports/contract/journal_v2",{params:{company_id:e.company_id,contracts_ids:[e.contracts[n].id],month:e.month}}).then((function(t){var s=t.data;e.contracts[n].total=s,e.contracts[n].medics=s.medics,e.contracts[n].tech=s.techs,e.contracts[n].medics_other=s.medics_other,e.contracts[n].techs_other=s.techs_other,e.contracts[n].other=s.other,e.contracts[n].visible_result=!0,s.message.length&&0===n&&i().fire({icon:"error",title:"Упсс...",text:s.message})})).finally((function(){++a===s&&(e.loading=!1)}))}));case 4:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){f(r,a,n,i,o,"next",t)}function o(t){f(r,a,n,i,o,"throw",t)}i(void 0)}))})()},searchCompany:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";axios.get("/api/companies/find",{params:{search:e}}).then((function(e){var s=e.data;s.forEach((function(t){t.name="[ID:".concat(t.hash_id,"][ИНН:").concat(t.inn,"] ").concat(t.name)})),t.companies=s}))},searchServices:function(){var t=this;this.loading=!0,this.contracts=[],this.contracts_options=[],axios.get("/report/getContractsForCompany_v2",{params:{id:this.company_id}}).then((function(e){var s=e.data;t.contracts=s,t.contracts_options=s})).finally((function(){t.loading=!1}))},getTotalContractSum:function(t){var e=0;for(var s in t)"other"!==s&&"message"!==s&&(e+=t[s].services.price);return e}},mounted:function(){this.searchCompany();var t=new Date,e=t.getMonth()>9?t.getMonth():"0"+t.getMonth();this.month=t.getFullYear()+"-"+e,this.client_company?(this.companies.push(this.client_company.name),this.company=this.client_company,this.company_id=this.client_company.hash_id,this.client=!0):this.default_company&&(this.companies.push(this.default_company),this.company=this.default_company,this.company_id=this.default_company.hash_id,this.report())},watch:{company:function(t){0!=this.company_id?this.searchServices():this.loading=!0}}};const v=(0,s(1900).Z)(m,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("div",{},[s("div",{staticClass:"card mb-4",staticStyle:{"overflow-x":"inherit"}},[s("h5",{staticClass:"card-header"},[t._v("Выбор информации")]),t._v(" "),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-8"},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[t._v("Компании ")]),t._v(" "),s("multiselect",{staticClass:"is-invalid",attrs:{disabled:t.client,options:t.companies,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите компанию",label:"name"},on:{"search-change":t.searchCompany,select:function(e){return t.company_id=e.hash_id}},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"form-group col-lg-2"},[s("label",{staticClass:"mb-1",attrs:{for:"company"}},[t._v("Договор")]),t._v(" "),s("multiselect",{attrs:{options:t.contracts_options,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите договор",label:"name","track-by":"name","preselect-first":!0,selectLabel:"Enter чтобы выбрать",deselectLabel:"Enter чтобы отменить",selectedLabel:"Выбрано"},model:{value:t.contracts,callback:function(e){t.contracts=e},expression:"contracts"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")])])],1),t._v(" "),s("div",{staticClass:"form-group col-lg-2"},[s("label",{staticClass:"mb-1",attrs:{for:"date_from"}},[t._v("Период:")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.month,expression:"month"}],ref:"month",staticClass:"form-control form-date",attrs:{type:"month",required:"",id:"month",name:"month"},domProps:{value:t.month},on:{input:function(e){e.target.composing||(t.month=e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-lg-12"},[t.permissions.create?s("button",{staticClass:"btn btn-info",attrs:{type:"submit",disabled:t.loading},on:{click:t.getReport}},[t.loading?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v("\n                            Сформировать отчет\n                        ")]):t._e(),t._v(" "),s("a",{staticClass:"btn btn-danger",attrs:{href:"?"}},[t._v("Сбросить")])])]),t._v(" "),t.company?s("b-row",[s("b-col",[s("span",[t._v("\n                        Отчёт сформирован по:\n                    ")]),t._v(" "),s("b-button",{attrs:{variant:"danger",href:"/elements/Company?filter=1&id="+t.company.id,target:"_blank"}},[t._v("\n                            "+t._s(t.company.name)+"\n                        ")])],1)],1):t._e()],1)]),t._v(" "),t._l(t.contracts,(function(e,a){return s("div",[e.visible_result?s("div",{staticClass:"my-3"},[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:"collapse-"+a,expression:"'collapse-' + index"}],staticClass:"mb-2",attrs:{variant:"primary"}},[t._v(t._s(e.name)+"\n                ")]),t._v(" "),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-"+a}},[s("b-card",[s("ReportJournalMedic",{ref:"reportsMedic",refInFor:!0,attrs:{reports:e.medics}}),t._v(" "),s("ReportJournalTech",{ref:"reportsTech",refInFor:!0,staticClass:"mt-5",attrs:{reports:e.tech}}),t._v(" "),s("ReportJournalMedicOther",{ref:"reportsMedicOther",refInFor:!0,staticClass:"mt-5",attrs:{reports:e.medics_other}}),t._v(" "),s("ReportJournalTechOther",{ref:"reportsTechOther",refInFor:!0,staticClass:"mt-5",attrs:{reports:e.techs_other}}),t._v(" "),s("ReportJournalOther",{ref:"reportsOther",refInFor:!0,staticClass:"mt-5",attrs:{data:e.other}}),t._v(" "),s("Total",{ref:"total",refInFor:!0,attrs:{data:e.total}})],1)],1)],1):t._e()])}))],2)])}),[],!1,null,"bcd90074",null).exports},3886:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>o});function a(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function n(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?a(Object(s),!0).forEach((function(e){r(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const i={name:"logs-filter",props:{filter:{type:Object,required:!0},terminalsOptions:{type:Array,required:!0},typesOptions:{type:Array,required:!0},pointsOptions:{type:Array,required:!0},versionsOptions:{type:Array,required:!0}},emits:["update:filter","apply","reset"],methods:{handleFilterUpdate:function(t,e){var s=n(n({},this.filter),{},r({},t,e));this.$emit("update:filter",s)},handleApply:function(){this.$emit("apply")},handleReset:function(){this.$emit("reset")}}};const o=(0,s(1900).Z)(i,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Терминалы")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.terminals,options:t.terminalsOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("terminals",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("ПВ")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.points,options:t.pointsOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("points",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Тип ошибки")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.types,options:t.typesOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("types",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Версия")]),t._v(" "),s("multiselect",{attrs:{value:t.filter.versions,options:t.versionsOptions,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Выберите несколько значений","track-by":"id",label:"text",multiple:""},on:{input:function(e){return t.handleFilterUpdate("versions",e)}}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Результатов не найдено")]),t._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v("Список пуст")])])],1)]),t._v(" "),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Дата получения с")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.created_at_start},on:{input:function(e){return t.handleFilterUpdate("created_at_start",e)}}})],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Дата получения по")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.created_at_end},on:{input:function(e){return t.handleFilterUpdate("created_at_end",e)}}})],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Дата возникновения с")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.happened_at_start},on:{input:function(e){return t.handleFilterUpdate("happened_at_start",e)}}})],1),t._v(" "),s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("Дата возникновения по")]),t._v(" "),s("b-form-datepicker",{staticClass:"mb-2",attrs:{value:t.filter.happened_at_end},on:{input:function(e){return t.handleFilterUpdate("happened_at_end",e)}}})],1)]),t._v(" "),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12 col-lg-6 col-xl-3"},[s("label",{staticClass:"mb-1"},[t._v("UUID")]),t._v(" "),s("b-form-input",{attrs:{value:t.filter.uuid,size:"sm",placeholder:"Введите значение"},on:{input:function(e){return t.handleFilterUpdate("uuid",e)}}})],1)]),t._v(" "),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"d-flex"},[s("b-button",{staticClass:"mr-2",attrs:{variant:"success",size:"sm"},on:{click:t.handleApply}},[t._v("\n                    Поиск\n                ")]),t._v(" "),s("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:t.handleReset}},[t._v("\n                    Сбросить\n                ")])],1)])])])}),[],!1,null,"90e39d16",null).exports},4947:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>_});var a=s(7757),n=s.n(a),r=s(3886),i=s(6579),o=s(6455),l=s.n(o);function c(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function d(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){c(r,a,n,i,o,"next",t)}function o(t){c(r,a,n,i,o,"throw",t)}i(void 0)}))}}const u={name:"logs-index",components:{LogsTable:i.default,LogsFilter:r.default},data:function(){return{pageSetup:window.PAGE_SETUP,showCrashDataModal:!1,crashData:null,filter:{terminals:[],points:[],types:[],versions:[],uuid:null,happened_at_start:null,happened_at_end:null,created_at_start:null,created_at_end:null},items:[],page:1,total:1,limit:100}},methods:{reload:function(){var t=this;return d(n().mark((function e(){var s,a,r,i,o,c,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.post(t.pageSetup.tableDataUrl,{limit:t.limit,page:t.page,filter:{uuid:null!==(s=t.filter.uuid)&&void 0!==s?s:null,happened_at_start:null!==(a=t.filter.happened_at_start)&&void 0!==a?a:null,happened_at_end:null!==(r=t.filter.happened_at_end)&&void 0!==r?r:null,created_at_start:null!==(i=t.filter.created_at_start)&&void 0!==i?i:null,created_at_end:null!==(o=t.filter.created_at_end)&&void 0!==o?o:null,terminals:t.filter.terminals.map((function(t){return t.id})),points:t.filter.points.map((function(t){return t.id})),types:t.filter.types.map((function(t){return t.id})),versions:t.filter.versions.map((function(t){return t.id}))}});case 3:c=e.sent,d=c.data,t.total=d.total,t.items=d.data.map((function(e){var s;return e.type=null!==(s=t.pageSetup.typesMap[e.type])&&void 0!==s?s:e.type,e})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0.message),l().fire({title:"Ошибка",text:"Ошибка при загрузке данных",icon:"error"});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},handleApply:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resetPageOrReload();case 2:case"end":return e.stop()}}),e)})))()},handleReset:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.filter={terminals:[],points:[],types:[],versions:[],uuid:null,happened_at_start:null,happened_at_end:null,created_at_start:null,created_at_end:null},e.next=3,t.resetPageOrReload();case 3:case"end":return e.stop()}}),e)})))()},resetPageOrReload:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.page){e.next=5;break}return e.next=3,t.reload();case 3:e.next=6;break;case 5:t.page=1;case 6:case"end":return e.stop()}}),e)})))()},showCrashData:function(t){this.showCrashDataModal=!0,this.crashData=t},resetCrashDataModal:function(){this.showCrashDataModal=!1,this.crashData=null}},mounted:function(){var t=this;return d(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)})))()},watch:{page:function(){this.reload()},limit:function(){this.resetPageOrReload()}}};var p=s(3379),f=s.n(p),m=s(7188),v={insert:"head",singleton:!1};f()(m.Z,v);m.Z.locals;const _=(0,s(1900).Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("logs-filter",{staticStyle:{"margin-bottom":"25px"},attrs:{filter:t.filter,"terminals-options":t.pageSetup.terminalsOptions,"types-options":t.pageSetup.typesOptions,"points-options":t.pageSetup.pointsOptions,"versions-options":t.pageSetup.versionsOptions},on:{"update:filter":function(e){t.filter=e},apply:t.handleApply,reset:t.handleReset}})],1)])])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"card table-card"},[s("div",{staticClass:"card-body"},[s("logs-table",{staticStyle:{"margin-top":"25px"},attrs:{items:t.items,page:t.page,limit:t.limit,total:t.total},on:{"update:page":function(e){t.page=e},"update:limit":function(e){t.limit=e},showCrashData:t.showCrashData}})],1)])])]),t._v(" "),s("b-modal",{attrs:{title:"Детали ошибки",size:"xl",scrollable:"","hide-footer":""},on:{hidden:t.resetCrashDataModal},model:{value:t.showCrashDataModal,callback:function(e){t.showCrashDataModal=e},expression:"showCrashDataModal"}},[s("p",[t._v("\n            "+t._s(t.crashData)+"\n        ")])])],1)}),[],!1,null,"7ece5de9",null).exports},6579:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});const a={name:"logs-table",components:{UuidCell:s(4876).default},props:{items:{type:Array,required:!0},total:{type:Number,required:!0},page:{type:Number,required:!0},limit:{type:Number,required:!0}},emits:["update:page","update:limit","showCrashData"],data:function(){return{limits:[25,50,100],fields:[{key:"uuid",label:"UUID",class:"text-left"},{key:"terminal",label:"Терминал",class:"text-left"},{key:"point",label:"ПВ",class:"text-left"},{key:"created_at",label:"Дата, время получения",class:"text-left"},{key:"happened_at",label:"Дата, время возникновения",class:"text-left"},{key:"type",label:"Тип отказа",class:"text-left"},{key:"version",label:"Версия",class:"text-left"},{key:"data",label:"Детали",class:"text-left"}]}},methods:{handleChangePage:function(t){this.$emit("update:page",t)},handleChangeLimit:function(t){this.$emit("update:limit",+t.target.value)},handleShowDetailsClick:function(t){this.$emit("showCrashData",t)}}};var n=s(3379),r=s.n(n),i=s(8333),o={insert:"head",singleton:!1};r()(i.Z,o);i.Z.locals;const l=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"d-flex align-items-center mb-4"},[s("span",[t._v("Показывать")]),t._v(" "),s("select",{staticClass:"ml-2 mr-2",domProps:{value:t.limit},on:{input:t.handleChangeLimit}},t._l(t.limits,(function(e,a){return s("option",{domProps:{value:e}},[t._v(t._s(e))])})),0),t._v(" "),s("span",[t._v("записей")])]),t._v(" "),s("b-table",{attrs:{fields:t.fields,items:t.items,"head-variant":"light",striped:"",responsive:"",bordered:""},scopedSlots:t._u([{key:"cell(uuid)",fn:function(t){var e=t.item;return[s("uuid-cell",{attrs:{uuid:e.uuid}})]}},{key:"cell(data)",fn:function(e){var a=e.item;return[a.data?s("b-button",{attrs:{variant:"success",size:"sm"},on:{click:function(e){return t.handleShowDetailsClick(a.data)}}},[s("i",{staticClass:"fa fa-info"})]):t._e()]}}])}),t._v(" "),s("b-pagination",{attrs:{value:t.page,"total-rows":t.total,"per-page":t.limit},on:{input:t.handleChangePage}})],1)}),[],!1,null,"18d34de1",null).exports},6163:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"model-searcher-table",props:{items:{type:Array,required:!0}},data:function(){return{fields:[{key:"id",label:"ID",class:"text-left"},{key:"hash_id",label:"HASH ID",class:"text-left"},{key:"model_type",label:"Модель",class:"text-left"},{key:"name",label:"Наименование",class:"text-left"}]}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("b-table",{staticClass:"mt-2",attrs:{fields:t.fields,items:t.items,"head-variant":"light",striped:"",responsive:"",bordered:""}})}),[],!1,null,"3154a722",null).exports},3250:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d});var a=s(7757),n=s.n(a),r=s(6163),i=s(6455),o=s.n(i);function l(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}const c={name:"model-searcher",components:{ModelSearcherTable:r.default},data:function(){return{pageSetup:window.PAGE_SETUP.MODEL_SEARCHER,identifier:"",loading:!1,items:[]}},methods:{updateIdentifier:function(t){this.identifier=t},loadData:function(){var t,e=this;return(t=n().mark((function t(){var s,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,e.items=[],t.next=5,axios.post(e.pageSetup.tableDataUrl,{identifier:e.identifier});case 5:s=t.sent,a=s.data,e.items=a,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),o().fire({title:"Ошибка",text:"Ошибка при загрузке данных",icon:"error"});case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){l(r,a,n,i,o,"next",t)}function o(t){l(r,a,n,i,o,"throw",t)}i(void 0)}))})()},reset:function(){this.identifier="",this.items=[]}},computed:{searchAvailable:function(){return!this.loading&&0!==this.identifier.trim().length}}};const d=(0,s(1900).Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"ID"}},[s("b-form-input",{attrs:{value:t.identifier},on:{input:t.updateIdentifier}}),t._v(" "),s("b-input-group-append",[s("b-button",{attrs:{variant:"outline-success",disabled:!t.searchAvailable},on:{click:t.loadData}},[t._v("Найти\n                ")]),t._v(" "),s("b-button",{attrs:{variant:"outline-danger",disabled:!t.searchAvailable},on:{click:t.reset}},[t._v("Очистить\n                ")])],1)],1)],1),t._v(" "),s("div",{staticClass:"col-12"},[s("model-searcher-table",{directives:[{name:"show",rawName:"v-show",value:t.items,expression:"items"}],attrs:{items:t.items}})],1)])}),[],!1,null,"2e04b424",null).exports},2453:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>n});const a={name:"ButtonWithPending",props:{pending:{type:Boolean,required:!0},description:{type:String,required:!1,default:"Применить"},loadingDescription:{type:String,required:!1,default:"Применение..."}}};const n=(0,s(1900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{attrs:{disabled:t.pending},on:{click:function(e){return t.$emit("click")}}},[t.pending?[s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}),t._v(" "),t._t("loading")]:t._e(),t._v(" "),t.pending?t._e():[t._t("default")]],2)}),[],!1,null,"1686da22",null).exports},3506:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d});var a=s(7757),n=s.n(a),r=s(492);function i(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}var o=new(s(1550).Q),l=["00:00:00","00:30:00","01:00:00","01:30:00","02:00:00","02:30:00","03:00:00","03:30:00","04:00:00","04:30:00","05:00:00","05:30:00","06:00:00","06:30:00","07:00:00","07:30:00","08:00:00","08:30:00","09:00:00","09:30:00","10:00:00","10:30:00","11:00:00","11:30:00","12:00:00","12:30:00","13:00:00","13:30:00","14:00:00","14:30:00","15:00:00","15:30:00","16:00:00","16:30:00","17:00:00","17:30:00","18:00:00","18:30:00","19:00:00","19:30:00","20:00:00","20:30:00","21:00:00","21:30:00","22:00:00","22:30:00","23:00:00","23:30:00"];const c={components:{LineChart:r.default},props:["pv_id","date_from","date_to","type_anketa"],data:function(){return{data:[],data2:[],chartInit:!1,datacollection:{labels:l,datasets:[{label:"Сумма по дате осмотра",borderColor:"#e30000",backgroundColor:"transparent",data:new Array(l.length).fill(0)},{label:"Сумма по дате создания",borderColor:"#4545db",backgroundColor:"transparent",data:new Array(l.length).fill(0)}]}}},mounted:function(){var t,e=this;return(t=n().mark((function t(){var s,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.datacollection.labels,t.next=4,o.getGraphReport({pv_id:e.pv_id,date_from:e.date_from,date_to:e.date_to,type_anketa:e.type_anketa});case 4:a=t.sent,e.data=a.reports,e.data2=a.reports2,e.data.forEach((function(t,a){var n=new Date("2021-11-25 "+t.date.replace(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/g,"").trim());s.forEach((function(t,a){var r=new Date("2021-11-25 "+t),i=new Date("2021-11-25 "+(s[a+1]?s[a+1]:s[0]));n>=r&&n<i&&e.datacollection.datasets[0].data[a+1]++}))})),e.data2.forEach((function(t,a){var n=new Date("2021-11-25 "+t.created_at.replace(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/g,"").trim());s.forEach((function(t,a){var r=new Date("2021-11-25 "+t),i=new Date("2021-11-25 "+(s[a+1]?s[a+1]:s[0]));n>=r&&n<i&&e.datacollection.datasets[1].data[a+1]++}))})),e.chartInit=!0;case 10:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function o(t){i(r,a,n,o,l,"next",t)}function l(t){i(r,a,n,o,l,"throw",t)}o(void 0)}))})()}};const d=(0,s(1900).Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chart"},[t.chartInit?s("line-chart",{attrs:{options:{maintainAspectRatio:!1},chartData:t.datacollection}}):s("div",{staticClass:"col-md-12"},[t._v("Ожидайте, график формируется... (если данных много, загрузка может занять до 5 минут)")])],1)}),[],!1,null,null,null).exports},2948:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var a=s(2453),n=s(3203);const r={name:"ExportElementButton",components:{ButtonWithPending:a.default},props:{exportUrl:{type:String,required:!0}},data:function(){return{pending:!1}},methods:{handleExportClick:function(){var t=this;this.pending=!0,axios.post(this.exportUrl).then((function(t){var e=t.data;window.location.href=e.url})).catch((function(t){var e=t.response;400!==e.status?(console.error(e),n.Z.error("Ошибка сервера!")):n.Z.error(e.data.message)})).finally((function(){t.pending=!1}))}}};const i=(0,s(1900).Z)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-with-pending",{staticClass:"btn btn-sm btn-success",attrs:{pending:t.pending},on:{click:t.handleExportClick},scopedSlots:t._u([{key:"default",fn:function(){return[t._v("\n        Экспортировать "),s("i",{staticClass:"fa fa-file-excel-o"})]},proxy:!0},{key:"loading",fn:function(){return[t._v("\n        Экспортирование... "),s("i",{staticClass:"fa fa-file-excel-o"})]},proxy:!0}])})}),[],!1,null,"22b3ca0a",null).exports},492:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var a=s(6663),n=a.tA.reactiveProp;const r={extends:a.x1,mixins:[n],props:["chartData","options"],mounted:function(){this.renderChart(this.chartData,this.options)}};const i=(0,s(1900).Z)(r,undefined,undefined,!1,null,null,null).exports},3442:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>c});var a=s(3203);const n={name:"ExportModal",components:{ButtonWithPending:s(2453).default},props:{exportUrl:{type:String,required:!0}},data:function(){return{pending:!1,showError:!1}},methods:{handleExportClick:function(){var t=this,e=$("#export_company_select").val();if(null==e)return this.showError=!0,void setTimeout((function(){t.showError=!1}),5e3);this.pending=!0,axios.post(this.exportUrl,{company_id:e}).then((function(t){var e=t.data;window.location.href=e.url})).catch((function(t){var e=t.response;400!==e.status?(console.error(e),a.Z.error("Ошибка сервера!")):a.Z.error(e.data.message)})).finally((function(){t.pending=!1}))}},mounted:function(){this.importResult=null}};var r=s(3379),i=s.n(r),o=s(3122),l={insert:"head",singleton:!1};i()(o.Z,l);o.Z.locals;const c=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{on:{submit:function(e){return e.preventDefault(),t.handleExportClick(e)}}},[s("div",{staticClass:"modal-body"},[t.showError?s("div",{staticClass:"alert alert-danger"},[s("strong",[t._v("Ошибка валидации!")]),t._v(" Компания для экспорта обязательна для заполнения.\n        ")]):t._e(),t._v(" "),t._t("default")],2),t._v(" "),s("div",{staticClass:"modal-footer"},[s("button-with-pending",{staticClass:"btn btn-sm btn-success",attrs:{type:"submit",pending:t.pending},scopedSlots:t._u([{key:"default",fn:function(){return[t._v("\n                Экспортировать\n            ")]},proxy:!0},{key:"loading",fn:function(){return[t._v("\n                Экспортирование...\n            ")]},proxy:!0}])}),t._v(" "),s("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("Закрыть")])],1)])}),[],!1,null,"2dcb38e0",null).exports},2216:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>r});var a=s(3203);const n={name:"ImportModal",components:{ButtonWithPending:s(2453).default},props:{type:{required:!0,type:String},importUrl:{required:!0,type:String}},data:function(){return{file:null,pending:!1,importResult:null}},methods:{handleSubmit:function(){var t=this;this.pending=!0;var e=new FormData;e.append("file",this.file),e.append("type",this.type);axios.post(this.importUrl,e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){t.importResult=e.data,a.Z.success("Импорт завершен успешно!")})).catch((function(t){console.error(t),a.Z.error("Ошибка сервера!")})).finally((function(){t.pending=!1}))}},mounted:function(){this.importResult=null}};const r=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[s("div",{staticClass:"modal-body"},[t.importResult?s("div",{staticClass:"alert",class:{"alert-success":!this.importResult.hasError,"alert-danger":this.importResult.hasError}},[t._v("\n            Импорт завершен! "),s("br"),t._v("\n            Всего строк: "),s("b",[t._v(t._s(t.importResult.allRows))]),t._v(". "),s("br"),t._v("\n            Записано: "),s("b",[t._v(t._s(t.importResult.acceptedRows))]),t._v(". "),s("br"),t._v("\n            Ошибочных: "),s("b",[t._v(t._s(t.importResult.errorRows))]),t._v(". "),s("br"),t._v(" "),t.importResult.hasError?s("a",{attrs:{href:this.importResult.errorFileUrl}},[t._v("Файл с ошибками.")]):t._e()]):t._e(),t._v(" "),t._t("default"),t._v(" "),s("div",{staticClass:"form-group"},[s("b-form-file",{attrs:{state:Boolean(t.file),placeholder:"Выберите файл для импорта...","drop-placeholder":"Перенесите файл сюда...",accept:".xls,.xlsx","browse-text":"Просмотр",required:""},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1)],2),t._v(" "),s("div",{staticClass:"modal-footer"},[s("button-with-pending",{staticClass:"btn btn-sm btn-success",attrs:{type:"submit",pending:t.pending},scopedSlots:t._u([{key:"default",fn:function(){return[t._v("\n                Импортировать\n            ")]},proxy:!0},{key:"loading",fn:function(){return[t._v("\n                Импортирование...\n            ")]},proxy:!0}])}),t._v(" "),s("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("Закрыть")])],1)])}),[],!1,null,"43d4e20c",null).exports},5763:(t,e,s)=>{var a={"./components/admin/prompt/AdminPromptDeleteModal.vue":410,"./components/admin/prompt/AdminPromptEditModal.vue":5868,"./components/admin/prompt/AdminPromptIndex.vue":1120,"./components/admin/prompt/AdminPromptRestoreModal.vue":4490,"./components/admin/stamp/AdminStampCreateModal.vue":4945,"./components/admin/stamp/AdminStampDeleteModal.vue":4517,"./components/admin/stamp/AdminStampEditModal.vue":8566,"./components/admin/stamp/AdminStampIndex.vue":550,"./components/admin/stamp/AdminStampRestoreModal.vue":3009,"./components/admin/users/AdminRolesIndex.vue":5223,"./components/admin/users/AdminTerminalsIndex.vue":5022,"./components/admin/users/AdminUsersIndex.vue":6852,"./components/admin/users/components/UserPvsList.vue":5786,"./components/admin/users/ui/DevicesInput.vue":3676,"./components/common/uuid-cell.vue":4876,"./components/contract/contract-create.vue":5925,"./components/contract/contract-filters.vue":8365,"./components/contract/contract-index.vue":4227,"./components/contract/contract-table.vue":4323,"./components/logs/logs-filter.vue":3062,"./components/logs/logs-index.vue":934,"./components/logs/logs-modal-table.vue":1268,"./components/logs/logs-modal.vue":8534,"./components/logs/logs-table.vue":9374,"./components/pak/PakIndex.vue":7287,"./components/reports/dynamic/ReportDynamicIndex.vue":938,"./components/reports/journal/ReportJournalContract.vue":4025,"./components/reports/journal/ReportJournalIndex.vue":380,"./components/reports/journal/ReportJournalMedic.vue":2985,"./components/reports/journal/ReportJournalMedicOther.vue":1677,"./components/reports/journal/ReportJournalOther.vue":2566,"./components/reports/journal/ReportJournalTech.vue":8727,"./components/reports/journal/ReportJournalTechOther.vue":8609,"./components/reports/refactoring/ReportJournalMedic.vue":3871,"./components/reports/refactoring/ReportJournalMedicOther.vue":4078,"./components/reports/refactoring/ReportJournalOther.vue":3391,"./components/reports/refactoring/ReportJournalTech.vue":9890,"./components/reports/refactoring/ReportJournalTechOther.vue":682,"./components/reports/refactoring/Total.vue":1882,"./components/reports/refactoring/company-service-refactoring.vue":4769,"./components/sdpo-crash-logs/sdpo-crash-logs-filter.vue":3886,"./components/sdpo-crash-logs/sdpo-crash-logs-index.vue":4947,"./components/sdpo-crash-logs/sdpo-crash-logs-table.vue":6579,"./components/searcher/model-searcher-table.vue":6163,"./components/searcher/model-searcher.vue":3250,"./v-components/ButtonWithPending.vue":2453,"./v-components/Chart.vue":3506,"./v-components/ExportElementButton.vue":2948,"./v-components/LineChart.vue":492,"./v-components/import/ExportModal.vue":3442,"./v-components/import/ImportModal.vue":2216};function n(t){var e=r(t);return s(e)}function r(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=5763}},t=>{var e=e=>t(t.s=e);t.O(0,[170,898],(()=>(e(6099),e(5067))));t.O()}]);